'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = Page({
  data: {
    cards: [],
    totalAmount: 0,
    currentCard: {
      recharge_card_id: ''
    }
  },
  onLoad: function onLoad(options) {
    // console.log(options)
  },

  recharge: function recharge() {
    var app = getApp();
    var id = this.data.currentCard.recharge_card_id;
    if (!id) return wx.message('请选择充值卡');

    app.get('rechargeCard/buyRechargeCard/' + id).then(function (data) {
      var result = data.data.content;
      wx.requestPayment(Object.assign({}, result, {
        success: function success(res) {
          wx.navigateTo({
            url: '/pages/rechargeCard/myCard'
          });
        },
        fail: function fail(res) {
          console.log(res);
        }
      }));
    });
  },


  onShow: function onShow() {
    this.getCards();
    this.getTotalAmount();
  },

  //  查看充值协议
  goAgreement: function goAgreement() {
    wx.navigateTo({
      url: '/pages/h5/index?url=https%3A%2F%2Fapi.mdshijie.com%2Fagreement.html'
    });
  },
  chooseCard: function chooseCard(e) {
    var card = this.data.cards[e.currentTarget.dataset.index];
    this.setData({
      currentCard: card
    });
  },
  getTotalAmount: function getTotalAmount() {
    var _this = this;

    var app = getApp();
    app.get('rechargeCard/getMyRechargeCardTotalAmountSummery').then(function (data) {
      _this.setData({
        totalAmount: data.data.content / 1 || 0
      });
    });
  },


  getCards: function getCards() {
    var _this2 = this;

    var app = getApp();
    app.get('rechargeCard/list').then(function (data) {
      var result = data.data;
      _this2.setData({
        currentCard: result.content[0],
        cards: result.content
      });
    });
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4Lnd4cCJdLCJuYW1lcyI6WyJkYXRhIiwiY2FyZHMiLCJ0b3RhbEFtb3VudCIsImN1cnJlbnRDYXJkIiwicmVjaGFyZ2VfY2FyZF9pZCIsIm9uTG9hZCIsIm9wdGlvbnMiLCJyZWNoYXJnZSIsImFwcCIsImdldEFwcCIsImlkIiwid3giLCJtZXNzYWdlIiwiZ2V0IiwidGhlbiIsInJlc3VsdCIsImNvbnRlbnQiLCJyZXF1ZXN0UGF5bWVudCIsIk9iamVjdCIsImFzc2lnbiIsInN1Y2Nlc3MiLCJyZXMiLCJuYXZpZ2F0ZVRvIiwidXJsIiwiZmFpbCIsImNvbnNvbGUiLCJsb2ciLCJvblNob3ciLCJnZXRDYXJkcyIsImdldFRvdGFsQW1vdW50IiwiZ29BZ3JlZW1lbnQiLCJjaG9vc2VDYXJkIiwiZSIsImNhcmQiLCJjdXJyZW50VGFyZ2V0IiwiZGF0YXNldCIsImluZGV4Iiwic2V0RGF0YSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBY0lBLFFBQU07QUFDSkMsV0FBTyxFQURIO0FBRUpDLGlCQUFhLENBRlQ7QUFHSkMsaUJBQWE7QUFDWEMsd0JBQWtCO0FBRFA7QUFIVCxHO0FBT05DLFVBQVEsZ0JBQVVDLE9BQVYsRUFBbUI7QUFDekI7QUFDRCxHOztBQUVEQyxVLHNCQUFXO0FBQ1QsUUFBSUMsTUFBTUMsUUFBVjtBQUNBLFFBQU1DLEtBQUssS0FBS1YsSUFBTCxDQUFVRyxXQUFWLENBQXNCQyxnQkFBakM7QUFDQSxRQUFJLENBQUNNLEVBQUwsRUFDRSxPQUFPQyxHQUFHQyxPQUFILENBQVcsUUFBWCxDQUFQOztBQUVGSixRQUFJSyxHQUFKLG1DQUF3Q0gsRUFBeEMsRUFBOENJLElBQTlDLENBQW1ELGdCQUFRO0FBQ3pELFVBQUlDLFNBQVNmLEtBQUtBLElBQUwsQ0FBVWdCLE9BQXZCO0FBQ0FMLFNBQUdNLGNBQUgsQ0FBa0JDLE9BQU9DLE1BQVAsQ0FBYyxFQUFkLEVBQWtCSixNQUFsQixFQUEwQjtBQUMxQ0ssZUFEMEMsbUJBQ2xDQyxHQURrQyxFQUM3QjtBQUNYVixhQUFHVyxVQUFILENBQWM7QUFDWkMsaUJBQUs7QUFETyxXQUFkO0FBR0QsU0FMeUM7QUFNMUNDLFlBTjBDLGdCQU1yQ0gsR0FOcUMsRUFNaEM7QUFDUkksa0JBQVFDLEdBQVIsQ0FBWUwsR0FBWjtBQUNEO0FBUnlDLE9BQTFCLENBQWxCO0FBVUQsS0FaRDtBQWFELEc7OztBQUVETSxVQUFRLGtCQUFZO0FBQ2xCLFNBQUtDLFFBQUw7QUFDQSxTQUFLQyxjQUFMO0FBQ0QsRzs7QUFFRDtBQUNBQyxhLHlCQUFjO0FBQ1puQixPQUFHVyxVQUFILENBQWM7QUFDWkMsV0FBSztBQURPLEtBQWQ7QUFHRCxHO0FBRURRLFksc0JBQVdDLEMsRUFBRztBQUNaLFFBQU1DLE9BQU8sS0FBS2pDLElBQUwsQ0FBVUMsS0FBVixDQUFnQitCLEVBQUVFLGFBQUYsQ0FBZ0JDLE9BQWhCLENBQXdCQyxLQUF4QyxDQUFiO0FBQ0EsU0FBS0MsT0FBTCxDQUFhO0FBQ1hsQyxtQkFBYThCO0FBREYsS0FBYjtBQUdELEc7QUFFREosZ0IsNEJBQWlCO0FBQUE7O0FBQ2YsUUFBSXJCLE1BQU1DLFFBQVY7QUFDQUQsUUFBSUssR0FBSixDQUFRLGtEQUFSLEVBQTREQyxJQUE1RCxDQUFpRSxnQkFBUTtBQUN2RSxZQUFLdUIsT0FBTCxDQUFhO0FBQ1huQyxxQkFBY0YsS0FBS0EsSUFBTCxDQUFVZ0IsT0FBVixHQUFtQixDQUFwQixJQUEyQjtBQUQ3QixPQUFiO0FBR0QsS0FKRDtBQUtELEc7OztBQUVEWSxZQUFVLG9CQUFZO0FBQUE7O0FBQ3BCLFFBQUlwQixNQUFNQyxRQUFWO0FBQ0FELFFBQUlLLEdBQUosQ0FBUSxtQkFBUixFQUE2QkMsSUFBN0IsQ0FBa0MsZ0JBQVE7QUFDeEMsVUFBSUMsU0FBU2YsS0FBS0EsSUFBbEI7QUFDQSxhQUFLcUMsT0FBTCxDQUFhO0FBQ1hsQyxxQkFBYVksT0FBT0MsT0FBUCxDQUFlLENBQWYsQ0FERjtBQUVYZixlQUFPYyxPQUFPQztBQUZILE9BQWI7QUFJRCxLQU5EO0FBT0QiLCJmaWxlIjoiaW5kZXgud3hwIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQge1xuICAgIGNvbmZpZzoge1xuICAgICAgbmF2aWdhdGlvbkJhclRpdGxlVGV4dDogJ+aIkeimgeWFheWAvCcsXG4gICAgICBuYXZpZ2F0aW9uQmFyQmFja2dyb3VuZENvbG9yOiAnI0U4RThFOCcsXG4gICAgICBuYXZpZ2F0aW9uQmFyVGV4dFN0eWxlOiAnYmxhY2snLFxuICAgICAgdXNpbmdDb21wb25lbnRzOiB7XG4gICAgICAgICd3eGMtZGlhbG9nJzogJ0BtaW51aS93eGMtZGlhbG9nJyxcbiAgICAgICAgJ3d4Yy1hYm5vcic6ICdAbWludWkvd3hjLWFibm9yJyxcbiAgICAgICAgJ3d4Yy1lbGlwJzogJ0BtaW51aS93eGMtZWxpcCcsXG4gICAgICAgICd3eGMtZmxleCc6ICdAbWludWkvd3hjLWZsZXgnLFxuICAgICAgICAnd3hjLWljb24nOiAnQG1pbnVpL3d4Yy1pY29uJyxcbiAgICAgICAgJ3d4Yy1hdmF0YXInOiAnQG1pbnVpL3d4Yy1hdmF0YXInLFxuICAgICAgfVxuICAgIH0sXG4gICAgZGF0YToge1xuICAgICAgY2FyZHM6IFtdLFxuICAgICAgdG90YWxBbW91bnQ6IDAsXG4gICAgICBjdXJyZW50Q2FyZDoge1xuICAgICAgICByZWNoYXJnZV9jYXJkX2lkOiAnJ1xuICAgICAgfSxcbiAgICB9LFxuICAgIG9uTG9hZDogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKG9wdGlvbnMpXG4gICAgfSxcblxuICAgIHJlY2hhcmdlKCkge1xuICAgICAgbGV0IGFwcCA9IGdldEFwcCgpXG4gICAgICBjb25zdCBpZCA9IHRoaXMuZGF0YS5jdXJyZW50Q2FyZC5yZWNoYXJnZV9jYXJkX2lkXG4gICAgICBpZiAoIWlkKVxuICAgICAgICByZXR1cm4gd3gubWVzc2FnZSgn6K+36YCJ5oup5YWF5YC85Y2hJylcblxuICAgICAgYXBwLmdldChgcmVjaGFyZ2VDYXJkL2J1eVJlY2hhcmdlQ2FyZC8ke2lkfWApLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgIGxldCByZXN1bHQgPSBkYXRhLmRhdGEuY29udGVudFxuICAgICAgICB3eC5yZXF1ZXN0UGF5bWVudChPYmplY3QuYXNzaWduKHt9LCByZXN1bHQsIHtcbiAgICAgICAgICBzdWNjZXNzKHJlcykge1xuICAgICAgICAgICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICAgICAgICAgIHVybDogJy9wYWdlcy9yZWNoYXJnZUNhcmQvbXlDYXJkJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZhaWwocmVzKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpXG4gICAgICAgICAgfVxuICAgICAgICB9KSlcbiAgICAgIH0pXG4gICAgfSxcblxuICAgIG9uU2hvdzogZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5nZXRDYXJkcygpXG4gICAgICB0aGlzLmdldFRvdGFsQW1vdW50KClcbiAgICB9LFxuXG4gICAgLy8gIOafpeeci+WFheWAvOWNj+iurlxuICAgIGdvQWdyZWVtZW50KCkge1xuICAgICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICAgIHVybDogJy9wYWdlcy9oNS9pbmRleD91cmw9aHR0cHMlM0ElMkYlMkZhcGkubWRzaGlqaWUuY29tJTJGYWdyZWVtZW50Lmh0bWwnXG4gICAgICB9KVxuICAgIH0sXG5cbiAgICBjaG9vc2VDYXJkKGUpIHtcbiAgICAgIGNvbnN0IGNhcmQgPSB0aGlzLmRhdGEuY2FyZHNbZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaW5kZXhdXG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICBjdXJyZW50Q2FyZDogY2FyZFxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgZ2V0VG90YWxBbW91bnQoKSB7XG4gICAgICBsZXQgYXBwID0gZ2V0QXBwKClcbiAgICAgIGFwcC5nZXQoJ3JlY2hhcmdlQ2FyZC9nZXRNeVJlY2hhcmdlQ2FyZFRvdGFsQW1vdW50U3VtbWVyeScpLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgdG90YWxBbW91bnQ6IChkYXRhLmRhdGEuY29udGVudCAvMSApIHx8IDBcbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgfSxcblxuICAgIGdldENhcmRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgYXBwID0gZ2V0QXBwKClcbiAgICAgIGFwcC5nZXQoJ3JlY2hhcmdlQ2FyZC9saXN0JykudGhlbihkYXRhID0+IHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IGRhdGEuZGF0YVxuICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgIGN1cnJlbnRDYXJkOiByZXN1bHQuY29udGVudFswXSxcbiAgICAgICAgICBjYXJkczogcmVzdWx0LmNvbnRlbnRcbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgfSxcbiAgfSJdfQ==