'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
var upload = require('../../common/upload.js');

exports.default = Page({
  data: {
    pet_class_id_index: '',
    sexs: ['公', '母'],
    babys: ['是', '否'],
    classs: [{
      key: 1,
      name: '加菲'
    }, {
      key: 2,
      name: '波斯'
    }],
    pet: {
      pet_pic_url: '',
      pet_pic: '',
      pet_name: '',
      pet_class_id: '',
      pet_class_name: '',
      pet_sex: '',
      pet_sex_id: '',
      pet_will_have_baby: '',
      pet_will_have_baby_id: '',
      birthday: ''
    },
    pet_id: 0,
    isEdit: false,
    pets: []
  },
  onLoad: function onLoad(options) {
    var _this = this;

    var pet_id = (options.id || 0) / 1 || 0;
    this.setData({
      pet_id: pet_id,
      isEdit: !!pet_id
    }, function () {
      return _this.getClasss();
    });
  },

  chooseImage: function chooseImage() {
    var _this2 = this;

    upload(getApp()).then(function (data) {
      // data = json.jsonDecode(data)
      if (data.status == 0) return getApp().showToast('上传失败,请重试');

      var pic = data.data.content;
      debugger;
      _this2.setData({
        'pet.pet_pic_url': pic.url,
        'pet.pet_pic': pic.pic
      });
    });
  },
  getClasss: function getClasss() {
    var _this3 = this;

    getApp().get('pet/getPetClass').then(function (data) {
      var classs = data.data.content.map(function (item) {
        return {
          key: item.pet_class_id / 1,
          name: item.pet_class_name
        };
      });

      _this3.setData({
        classs: classs
      });
    }).then(function () {
      return _this3.getDetail();
    });
  },
  getDetail: function getDetail() {
    var _this4 = this;

    var self = this;

    if (this.data.isEdit) {
      getApp().get('pet/one?pet_id=' + this.data.pet_id).then(function (data) {
        var pet = data.data.content;

        pet.pet_id = pet.pet_id / 1;
        pet.pet_will_have_baby_id = pet.pet_will_have_baby_id / 1;
        pet.pet_class_id = pet.pet_class_id / 1;
        pet.pet_sex_id = pet.pet_sex_id / 1;

        var pet_class_id_index = _this4.data.classs.findIndex(function (item) {
          return item.key == pet.pet_class_id;
        });

        self.setData({
          pet_class_id_index: pet_class_id_index,
          pet: pet
        });
      });
    }
  },


  onShow: function onShow() {
    // this.getPets()
  },

  bindChangeName: function bindChangeName(e) {
    var k = e.detail.value;
    this.setData({
      'pet.pet_name': k
    });
  },
  deletePet: function deletePet() {
    var dialogComponent = this.data.lastComponent = this.selectComponent('.wxc-cancel-pet');
    dialogComponent && dialogComponent.show();
  },
  cancelDeletePet: function cancelDeletePet() {
    var dialogComponent = this.data.lastComponent = this.selectComponent('.wxc-cancel-pet');
    dialogComponent && dialogComponent.hide();
  },
  confirmDeletePet: function confirmDeletePet() {
    getApp().post('pet/removePet', {
      pet_id: this.data.pet_id
    }).then(function (data) {
      wx.navigateBack();
    });
  },
  bindChangeClass: function bindChangeClass(e) {
    var k = e.detail.value;
    var v = this.data.classs[k];
    this.setData({
      'pet_class_id_index': k,
      'pet.pet_class_id': v['key'],
      'pet.pet_class_name': v['name']
    });
  },
  bindChangeSex: function bindChangeSex(e) {
    var k = e.detail.value;
    var v = this.data.sexs[k];
    this.setData({
      'pet.pet_sex': v,
      'pet.pet_sex_id': k
    });
  },
  bindChangeBaby: function bindChangeBaby(e) {
    var k = e.detail.value;
    var v = this.data.babys[k];
    this.setData({
      'pet.pet_will_have_baby': v,
      'pet.pet_will_have_baby_id': k
    });
  },
  bindChangeDate: function bindChangeDate(e) {
    var k = e.detail.value;
    this.setData({
      'pet.birthday': k
    });
  },
  addPet: function addPet() {
    var app = getApp();
    var url = 'pet/createPet';
    if (this.data.isEdit) url = 'pet/updatePet?pet_id=' + this.data.pet_id;

    var pet = this.data.pet;
    if (!pet.pet_name.trim()) {
      return app.showToast('请输入宠物昵称');
    }

    if (!pet.pet_class_id) {
      return app.showToast('请选择宠物种类');
    }

    if (!pet.pet_sex_id) {
      return app.showToast('请选择性别');
    }

    if (!pet.pet_will_have_baby_id) {
      return app.showToast('请选择宠物是否绝育');
    }

    if (!pet.birthday) {
      return app.showToast('请选择宠物生日');
    }

    app.post(url, this.data.pet).then(function (data) {
      wx.navigateBack();
    });
  },


  getPets: function getPets() {
    var _this5 = this;

    var app = getApp();
    app.get('pet/findMyPets').then(function (data) {
      var result = data.data;
      _this5.setData({
        pets: result.content
      });
    });
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZvcm0ud3hwIl0sIm5hbWVzIjpbInVwbG9hZCIsInJlcXVpcmUiLCJkYXRhIiwicGV0X2NsYXNzX2lkX2luZGV4Iiwic2V4cyIsImJhYnlzIiwiY2xhc3NzIiwia2V5IiwibmFtZSIsInBldCIsInBldF9waWNfdXJsIiwicGV0X3BpYyIsInBldF9uYW1lIiwicGV0X2NsYXNzX2lkIiwicGV0X2NsYXNzX25hbWUiLCJwZXRfc2V4IiwicGV0X3NleF9pZCIsInBldF93aWxsX2hhdmVfYmFieSIsInBldF93aWxsX2hhdmVfYmFieV9pZCIsImJpcnRoZGF5IiwicGV0X2lkIiwiaXNFZGl0IiwicGV0cyIsIm9uTG9hZCIsIm9wdGlvbnMiLCJpZCIsInNldERhdGEiLCJnZXRDbGFzc3MiLCJjaG9vc2VJbWFnZSIsImdldEFwcCIsInRoZW4iLCJzdGF0dXMiLCJzaG93VG9hc3QiLCJwaWMiLCJjb250ZW50IiwidXJsIiwiZ2V0IiwibWFwIiwiaXRlbSIsImdldERldGFpbCIsInNlbGYiLCJmaW5kSW5kZXgiLCJvblNob3ciLCJiaW5kQ2hhbmdlTmFtZSIsImUiLCJrIiwiZGV0YWlsIiwidmFsdWUiLCJkZWxldGVQZXQiLCJkaWFsb2dDb21wb25lbnQiLCJsYXN0Q29tcG9uZW50Iiwic2VsZWN0Q29tcG9uZW50Iiwic2hvdyIsImNhbmNlbERlbGV0ZVBldCIsImhpZGUiLCJjb25maXJtRGVsZXRlUGV0IiwicG9zdCIsInd4IiwibmF2aWdhdGVCYWNrIiwiYmluZENoYW5nZUNsYXNzIiwidiIsImJpbmRDaGFuZ2VTZXgiLCJiaW5kQ2hhbmdlQmFieSIsImJpbmRDaGFuZ2VEYXRlIiwiYWRkUGV0IiwiYXBwIiwidHJpbSIsImdldFBldHMiLCJyZXN1bHQiXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsSUFBTUEsU0FBU0MsUUFBUSx3QkFBUixDQUFmOzs7QUFnQklDLFFBQU07QUFDSkMsd0JBQW9CLEVBRGhCO0FBRUpDLFVBQU0sQ0FBQyxHQUFELEVBQU0sR0FBTixDQUZG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K0MsSUFBSWpDLFNBQUosQ0FBYyxXQUFkLENBQVA7QUFDRDs7QUFHRCxRQUFJLENBQUN2QixJQUFJVSxRQUFULEVBQW1CO0FBQ2pCLGFBQU84QyxJQUFJakMsU0FBSixDQUFjLFNBQWQsQ0FBUDtBQUNEOztBQUVEaUMsUUFBSVQsSUFBSixDQUFTckIsR0FBVCxFQUFjLEtBQUtqQyxJQUFMLENBQVVPLEdBQXhCLEVBQTZCcUIsSUFBN0IsQ0FBa0MsZ0JBQVE7QUFDeEMyQixTQUFHQyxZQUFIO0FBQ0QsS0FGRDtBQUdELEc7OztBQUVEUyxXQUFTLG1CQUFZO0FBQUE7O0FBQ25CLFFBQUlGLE1BQU1wQyxRQUFWO0FBQ0FvQyxRQUFJN0IsR0FBSixDQUFRLGdCQUFSLEVBQTBCTixJQUExQixDQUErQixnQkFBUTtBQUNyQyxVQUFJc0MsU0FBU2xFLEtBQUtBLElBQWxCO0FBQ0EsYUFBS3dCLE9BQUwsQ0FBYTtBQUNYSixjQUFNOEMsT0FBT2xDO0FBREYsT0FBYjtBQUdELEtBTEQ7QUFNRCIsImZpbGUiOiJmb3JtLnd4cCIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHVwbG9hZCA9IHJlcXVpcmUoJy4uLy4uL2NvbW1vbi91cGxvYWQnKVxuXG4gIGV4cG9ydCBkZWZhdWx0IHtcbiAgICBjb25maWc6IHtcbiAgICAgIG5hdmlnYXRpb25CYXJUaXRsZVRleHQ6ICflrqDniannrqHnkIYnLFxuICAgICAgbmF2aWdhdGlvbkJhckJhY2tncm91bmRDb2xvcjogJyNmZmZmZmYnLFxuICAgICAgbmF2aWdhdGlvbkJhclRleHRTdHlsZTogJ2JsYWNrJyxcbiAgICAgIHVzaW5nQ29tcG9uZW50czoge1xuICAgICAgICAnd3hjLWRpYWxvZyc6ICdAbWludWkvd3hjLWRpYWxvZycsXG4gICAgICAgICd3eGMtYWJub3InOiAnQG1pbnVpL3d4Yy1hYm5vcicsXG4gICAgICAgICd3eGMtZWxpcCc6ICdAbWludWkvd3hjLWVsaXAnLFxuICAgICAgICAnd3hjLWZsZXgnOiAnQG1pbnVpL3d4Yy1mbGV4JyxcbiAgICAgICAgJ3d4Yy1pY29uJzogJ0BtaW51aS93eGMtaWNvbicsXG4gICAgICAgICd3eGMtYXZhdGFyJzogJ0BtaW51aS93eGMtYXZhdGFyJyxcbiAgICAgIH1cbiAgICB9LFxuICAgIGRhdGE6IHtcbiAgICAgIHBldF9jbGFzc19pZF9pbmRleDogJycsXG4gICAgICBzZXhzOiBbJ+WFrCcsICfmr40nXSxcbiAgICAgIGJhYnlzOiBbJ+aYrycsICflkKYnXSxcbiAgICAgIGNsYXNzczogW3tcbiAgICAgICAga2V5OiAxLFxuICAgICAgICBuYW1lOiAn5Yqg6I+yJ1xuICAgICAgfSx7XG4gICAgICAgIGtleTogMixcbiAgICAgICAgbmFtZTogJ+azouaWrydcbiAgICAgIH1dLFxuICAgICAgcGV0OiB7XG4gICAgICAgIHBldF9waWNfdXJsOiAnJyxcbiAgICAgICAgcGV0X3BpYzogJycsXG4gICAgICAgIHBldF9uYW1lOiAnJyxcbiAgICAgICAgcGV0X2NsYXNzX2lkOiAnJyxcbiAgICAgICAgcGV0X2NsYXNzX25hbWU6ICcnLFxuICAgICAgICBwZXRfc2V4OiAnJyxcbiAgICAgICAgcGV0X3NleF9pZDogJycsXG4gICAgICAgIHBldF93aWxsX2hhdmVfYmFieTogJycsXG4gICAgICAgIHBldF93aWxsX2hhdmVfYmFieV9pZDogJycsXG4gICAgICAgIGJpcnRoZGF5OiAnJ1xuICAgICAgfSxcbiAgICAgIHBldF9pZDogMCxcbiAgICAgIGlzRWRpdDogZmFsc2UsXG4gICAgICBwZXRzOiBbXSxcbiAgICB9LFxuICAgIG9uTG9hZDogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgIGNvbnN0IHBldF9pZCA9IChvcHRpb25zLmlkIHx8IDApIC8gMSB8fCAwXG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICBwZXRfaWQsXG4gICAgICAgIGlzRWRpdDogISFwZXRfaWRcbiAgICAgIH0sICgpID0+IHRoaXMuZ2V0Q2xhc3NzKCkpXG4gICAgfSxcblxuXHRjaG9vc2VJbWFnZSgpIHtcblx0XHR1cGxvYWQoZ2V0QXBwKCkpLnRoZW4oZGF0YSA9PiB7XG5cdFx0XHQvLyBkYXRhID0ganNvbi5qc29uRGVjb2RlKGRhdGEpXG5cdFx0XHRpZiAoZGF0YS5zdGF0dXMgPT0gMClcblx0XHRcdFx0cmV0dXJuIGdldEFwcCgpLnNob3dUb2FzdCgn5LiK5Lyg5aSx6LSlLOivt+mHjeivlScpXG5cbiAgICAgIGNvbnN0IHBpYyA9IGRhdGEuZGF0YS5jb250ZW50XG4gICAgICBkZWJ1Z2dlclxuXHRcdFx0dGhpcy5zZXREYXRhKHtcblx0XHRcdFx0J3BldC5wZXRfcGljX3VybCc6IHBpYy51cmwsXG5cdFx0XHRcdCdwZXQucGV0X3BpYyc6IHBpYy5waWMsXG5cdFx0XHR9KVxuXHRcdH0pXG5cdH0sXG5cbiAgICBnZXRDbGFzc3MoKSB7XG4gICAgICBnZXRBcHAoKS5nZXQoJ3BldC9nZXRQZXRDbGFzcycpLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgIGNvbnN0IGNsYXNzcyA9IGRhdGEuZGF0YS5jb250ZW50Lm1hcChpdGVtID0+IHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAga2V5OiBpdGVtLnBldF9jbGFzc19pZCAvIDEsXG4gICAgICAgICAgICBuYW1lOiBpdGVtLnBldF9jbGFzc19uYW1lXG4gICAgICAgICAgfVxuICAgICAgICB9KVxuXG4gICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgY2xhc3NzXG4gICAgICAgIH0pXG4gICAgICB9KS50aGVuKCgpID0+IHRoaXMuZ2V0RGV0YWlsKCkpXG4gICAgfSxcblxuICAgIGdldERldGFpbCgpIHtcbiAgICAgIGNvbnN0IHNlbGYgPSB0aGlzXG5cbiAgICAgIGlmICh0aGlzLmRhdGEuaXNFZGl0KSB7XG4gICAgICAgIGdldEFwcCgpLmdldCgncGV0L29uZT9wZXRfaWQ9JyArIHRoaXMuZGF0YS5wZXRfaWQpLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgICAgY29uc3QgcGV0ID0gZGF0YS5kYXRhLmNvbnRlbnRcblxuICAgICAgICAgIHBldC5wZXRfaWQgPSBwZXQucGV0X2lkIC8gMVxuICAgICAgICAgIHBldC5wZXRfd2lsbF9oYXZlX2JhYnlfaWQgPSBwZXQucGV0X3dpbGxfaGF2ZV9iYWJ5X2lkIC8gMVxuICAgICAgICAgIHBldC5wZXRfY2xhc3NfaWQgPSBwZXQucGV0X2NsYXNzX2lkIC8gMVxuICAgICAgICAgIHBldC5wZXRfc2V4X2lkID0gcGV0LnBldF9zZXhfaWQgLyAxXG5cbiAgICAgICAgICBjb25zdCBwZXRfY2xhc3NfaWRfaW5kZXggPSB0aGlzLmRhdGEuY2xhc3NzLmZpbmRJbmRleChpdGVtID0+IGl0ZW0ua2V5ID09IHBldC5wZXRfY2xhc3NfaWQpXG5cbiAgICAgICAgICBzZWxmLnNldERhdGEoe1xuICAgICAgICAgICAgcGV0X2NsYXNzX2lkX2luZGV4LFxuICAgICAgICAgICAgcGV0XG4gICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgb25TaG93OiBmdW5jdGlvbiAoKSB7XG4gICAgICAvLyB0aGlzLmdldFBldHMoKVxuICAgIH0sXG5cbiAgICBiaW5kQ2hhbmdlTmFtZShlKSB7XG4gICAgICBjb25zdCBrID0gZS5kZXRhaWwudmFsdWVcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICdwZXQucGV0X25hbWUnOiBrXG4gICAgICB9KVxuICAgIH0sXG5cbiAgICBkZWxldGVQZXQoKSB7XG4gICAgICBsZXQgZGlhbG9nQ29tcG9uZW50ID0gdGhpcy5kYXRhLmxhc3RDb21wb25lbnQgPSB0aGlzLnNlbGVjdENvbXBvbmVudCgnLnd4Yy1jYW5jZWwtcGV0JylcbiAgICAgIGRpYWxvZ0NvbXBvbmVudCAmJiBkaWFsb2dDb21wb25lbnQuc2hvdygpO1xuICAgIH0sXG5cbiAgICBjYW5jZWxEZWxldGVQZXQoKSB7XG4gICAgICBsZXQgZGlhbG9nQ29tcG9uZW50ID0gdGhpcy5kYXRhLmxhc3RDb21wb25lbnQgPSB0aGlzLnNlbGVjdENvbXBvbmVudCgnLnd4Yy1jYW5jZWwtcGV0JylcbiAgICAgIGRpYWxvZ0NvbXBvbmVudCAmJiBkaWFsb2dDb21wb25lbnQuaGlkZSgpO1xuICAgIH0sXG5cbiAgICBjb25maXJtRGVsZXRlUGV0KCkge1xuICAgICAgZ2V0QXBwKCkucG9zdCgncGV0L3JlbW92ZVBldCcsIHtcbiAgICAgICAgcGV0X2lkOiB0aGlzLmRhdGEucGV0X2lkXG4gICAgICB9KS50aGVuKGRhdGEgPT4ge1xuICAgICAgICB3eC5uYXZpZ2F0ZUJhY2soKVxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgYmluZENoYW5nZUNsYXNzKGUpIHtcbiAgICAgIGNvbnN0IGsgPSBlLmRldGFpbC52YWx1ZVxuICAgICAgY29uc3QgdiA9IHRoaXMuZGF0YS5jbGFzc3Nba11cbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICdwZXRfY2xhc3NfaWRfaW5kZXgnOiBrLFxuICAgICAgICAncGV0LnBldF9jbGFzc19pZCc6IHZbJ2tleSddLFxuICAgICAgICAncGV0LnBldF9jbGFzc19uYW1lJzogdlsnbmFtZSddLFxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgYmluZENoYW5nZVNleChlKSB7XG4gICAgICBjb25zdCBrID0gZS5kZXRhaWwudmFsdWVcbiAgICAgIGNvbnN0IHYgPSB0aGlzLmRhdGEuc2V4c1trXVxuICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgJ3BldC5wZXRfc2V4JzogdixcbiAgICAgICAgJ3BldC5wZXRfc2V4X2lkJzogayxcbiAgICAgIH0pXG4gICAgfSxcblxuXG4gICAgYmluZENoYW5nZUJhYnkoZSkge1xuICAgICAgY29uc3QgayA9IGUuZGV0YWlsLnZhbHVlXG4gICAgICBjb25zdCB2ID0gdGhpcy5kYXRhLmJhYnlzW2tdXG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAncGV0LnBldF93aWxsX2hhdmVfYmFieSc6IHYsXG4gICAgICAgICdwZXQucGV0X3dpbGxfaGF2ZV9iYWJ5X2lkJzogayxcbiAgICAgIH0pXG4gICAgfSxcblxuICAgIGJpbmRDaGFuZ2VEYXRlKGUpIHtcbiAgICAgIGNvbnN0IGsgPSBlLmRldGFpbC52YWx1ZVxuICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgJ3BldC5iaXJ0aGRheSc6IGtcbiAgICAgIH0pXG4gICAgfSxcblxuICAgIGFkZFBldCgpIHtcbiAgICAgIGxldCBhcHAgPSBnZXRBcHAoKVxuICAgICAgbGV0IHVybCA9ICdwZXQvY3JlYXRlUGV0J1xuICAgICAgaWYgKHRoaXMuZGF0YS5pc0VkaXQpXG4gICAgICAgIHVybCA9ICdwZXQvdXBkYXRlUGV0P3BldF9pZD0nICsgdGhpcy5kYXRhLnBldF9pZFxuXG4gICAgICBjb25zdCBwZXQgPSB0aGlzLmRhdGEucGV0XG4gICAgICBpZiAoIXBldC5wZXRfbmFtZS50cmltKCkpIHtcbiAgICAgICAgcmV0dXJuIGFwcC5zaG93VG9hc3QoJ+ivt+i+k+WFpeWuoOeJqeaYteensCcpXG4gICAgICB9XG5cbiAgICAgIGlmICghcGV0LnBldF9jbGFzc19pZCkge1xuICAgICAgICByZXR1cm4gYXBwLnNob3dUb2FzdCgn6K+36YCJ5oup5a6g54mp56eN57G7JylcbiAgICAgIH1cblxuICAgICAgaWYgKCFwZXQucGV0X3NleF9pZCkge1xuICAgICAgICByZXR1cm4gYXBwLnNob3dUb2FzdCgn6K+36YCJ5oup5oCn5YirJylcbiAgICAgIH1cblxuICAgICAgaWYgKCFwZXQucGV0X3dpbGxfaGF2ZV9iYWJ5X2lkKSB7XG4gICAgICAgIHJldHVybiBhcHAuc2hvd1RvYXN0KCfor7fpgInmi6nlrqDnianmmK/lkKbnu53ogrInKVxuICAgICAgfVxuXG5cbiAgICAgIGlmICghcGV0LmJpcnRoZGF5KSB7XG4gICAgICAgIHJldHVybiBhcHAuc2hvd1RvYXN0KCfor7fpgInmi6nlrqDniannlJ/ml6UnKVxuICAgICAgfVxuXG4gICAgICBhcHAucG9zdCh1cmwsIHRoaXMuZGF0YS5wZXQpLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgIHd4Lm5hdmlnYXRlQmFjaygpXG4gICAgICB9KVxuICAgIH0sXG5cbiAgICBnZXRQZXRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgYXBwID0gZ2V0QXBwKClcbiAgICAgIGFwcC5nZXQoJ3BldC9maW5kTXlQZXRzJykudGhlbihkYXRhID0+IHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IGRhdGEuZGF0YVxuICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgIHBldHM6IHJlc3VsdC5jb250ZW50XG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgIH0sXG4gIH0iXX0=