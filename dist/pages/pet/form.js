'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
var upload = require('../../common/upload.js');

exports.default = Page({
  data: {
    pet_class_id_index: '',
    sexs: ['公', '母'],
    babys: ['是', '否'],
    classs: [{
      key: 1,
      name: '加菲'
    }, {
      key: 2,
      name: '波斯'
    }],
    pet: {
      pet_pic_url: '',
      pet_pic: '',
      pet_name: '',
      pet_class_id: '',
      pet_class_name: '',
      pet_sex: '',
      pet_sex_id: '',
      pet_will_have_baby: '',
      pet_will_have_baby_id: '',
      birthday: ''
    },
    pet_id: 0,
    isEdit: false,
    pets: []
  },
  onLoad: function onLoad(options) {
    var _this = this;

    var pet_id = (options.id || 0) / 1 || 0;
    this.setData({
      pet_id: pet_id,
      isEdit: !!pet_id
    }, function () {
      return _this.getClasss();
    });
  },

  chooseImage: function chooseImage() {
    var _this2 = this;

    upload(getApp()).then(function (data) {
      // data = json.jsonDecode(data)
      if (data.status == 0) return getApp().showToast('上传失败,请重试');

      var pic = data.data.content;
      debugger;
      _this2.setData({
        'pet.pet_pic_url': pic.url,
        'pet.pet_pic': pic.pic
      });
    });
  },
  getClasss: function getClasss() {
    var _this3 = this;

    getApp().get('pet/getPetClass').then(function (data) {
      var classs = data.data.content.map(function (item) {
        return {
          key: item.pet_class_id / 1,
          name: item.pet_class_name
        };
      });

      _this3.setData({
        classs: classs
      });
    }).then(function () {
      return _this3.getDetail();
    });
  },
  getDetail: function getDetail() {
    var _this4 = this;

    var self = this;

    if (this.data.isEdit) {
      getApp().get('pet/one?pet_id=' + this.data.pet_id).then(function (data) {
        var pet = data.data.content;

        pet.pet_id = pet.pet_id / 1;
        pet.pet_will_have_baby_id = pet.pet_will_have_baby_id / 1;
        pet.pet_class_id = pet.pet_class_id / 1;
        pet.pet_sex_id = pet.pet_sex_id / 1;

        var pet_class_id_index = _this4.data.classs.findIndex(function (item) {
          return item.key == pet.pet_class_id;
        });

        self.setData({
          pet_class_id_index: pet_class_id_index,
          pet: pet
        });
      });
    }
  },


  onShow: function onShow() {
    // this.getPets()
  },

  bindChangeName: function bindChangeName(e) {
    var k = e.detail.value;
    this.setData({
      'pet.pet_name': k
    });
  },
  deletePet: function deletePet() {
    var dialogComponent = this.data.lastComponent = this.selectComponent('.wxc-cancel-pet');
    dialogComponent && dialogComponent.show();
  },
  cancelDeletePet: function cancelDeletePet() {
    var dialogComponent = this.data.lastComponent = this.selectComponent('.wxc-cancel-pet');
    dialogComponent && dialogComponent.hide();
  },
  confirmDeletePet: function confirmDeletePet() {
    getApp().post('pet/removePet', {
      pet_id: this.data.pet_id
    }).then(function (data) {
      wx.navigateBack();
    });
  },
  bindChangeClass: function bindChangeClass(e) {
    var k = e.detail.value;
    var v = this.data.classs[k];
    this.setData({
      'pet_class_id_index': k,
      'pet.pet_class_id': v['key'],
      'pet.pet_class_name': v['name']
    });
  },
  bindChangeSex: function bindChangeSex(e) {
    var k = e.detail.value;
    var v = this.data.sexs[k];
    this.setData({
      'pet.pet_sex': v,
      'pet.pet_sex_id': k
    });
  },
  bindChangeBaby: function bindChangeBaby(e) {
    var k = e.detail.value;
    var v = this.data.babys[k];
    this.setData({
      'pet.pet_will_have_baby': v,
      'pet.pet_will_have_baby_id': k
    });
  },
  bindChangeDate: function bindChangeDate(e) {
    var k = e.detail.value;
    this.setData({
      'pet.birthday': k
    });
  },
  addPet: function addPet() {
    var app = getApp();
    var url = 'pet/createPet';
    if (this.data.isEdit) url = 'pet/updatePet?pet_id=' + this.data.pet_id;

    app.post(url, this.data.pet).then(function (data) {
      wx.navigateBack();
    });
  },


  getPets: function getPets() {
    var _this5 = this;

    var app = getApp();
    app.get('pet/findMyPets').then(function (data) {
      var result = data.data;
      _this5.setData({
        pets: result.content
      });
    });
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZvcm0ud3hwIl0sIm5hbWVzIjpbInVwbG9hZCIsInJlcXVpcmUiLCJkYXRhIiwicGV0X2NsYXNzX2lkX2luZGV4Iiwic2V4cyIsImJhYnlzIiwiY2xhc3NzIiwia2V5IiwibmFtZSIsInBldCIsInBldF9waWNfdXJsIiwicGV0X3BpYyIsInBldF9uYW1lIiwicGV0X2NsYXNzX2lkIiwicGV0X2NsYXNzX25hbWUiLCJwZXRfc2V4IiwicGV0X3NleF9pZCIsInBldF93aWxsX2hhdmVfYmFieSIsInBldF93aWxsX2hhdmVfYmFieV9pZCIsImJpcnRoZGF5IiwicGV0X2lkIiwiaXNFZGl0IiwicGV0cyIsIm9uTG9hZCIsIm9wdGlvbnMiLCJpZCIsInNldERhdGEiLCJnZXRDbGFzc3MiLCJjaG9vc2VJbWFnZSIsImdldEFwcCIsInRoZW4iLCJzdGF0dXMiLCJzaG93VG9hc3QiLCJwaWMiLCJjb250ZW50IiwidXJsIiwiZ2V0IiwibWFwIiwiaXRlbSIsImdldERldGFpbCIsInNlbGYiLCJmaW5kSW5kZXgiLCJvblNob3ciLCJiaW5kQ2hhbmdlTmFtZSIsImUiLCJrIiwiZGV0YWlsIiwidmFsdWUiLCJkZWxldGVQZXQiLCJkaWFsb2dDb21wb25lbnQiLCJsYXN0Q29tcG9uZW50Iiwic2VsZWN0Q29tcG9uZW50Iiwic2hvdyIsImNhbmNlbERlbGV0ZVBldCIsImhpZGUiLCJjb25maXJtRGVsZXRlUGV0IiwicG9zdCIsInd4IiwibmF2aWdhdGVCYWNrIiwiYmluZENoYW5nZUNsYXNzIiwidiIsImJpbmRDaGFuZ2VTZXgiLCJiaW5kQ2hhbmdlQmFieSIsImJpbmRDaGFuZ2VEYXRlIiwiYWRkUGV0IiwiYXBwIiwiZ2V0UGV0cyIsInJlc3VsdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxJQUFNQSxTQUFTQyxRQUFRLHdCQUFSLENBQWY7OztBQWdCSUMsUUFBTTtBQUNKQyx3QkFBb0IsRUFEaEI7QUFFSkMsVUFBTSxDQUFDLEdBQUQsRUFBTSxHQUFOLENBRkY7QUFHSkMs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dXJjZXNDb250ZW50IjpbImNvbnN0IHVwbG9hZCA9IHJlcXVpcmUoJy4uLy4uL2NvbW1vbi91cGxvYWQnKVxuXG4gIGV4cG9ydCBkZWZhdWx0IHtcbiAgICBjb25maWc6IHtcbiAgICAgIG5hdmlnYXRpb25CYXJUaXRsZVRleHQ6ICflrqDniannrqHnkIYnLFxuICAgICAgbmF2aWdhdGlvbkJhckJhY2tncm91bmRDb2xvcjogJyNmZmZmZmYnLFxuICAgICAgbmF2aWdhdGlvbkJhclRleHRTdHlsZTogJ2JsYWNrJyxcbiAgICAgIHVzaW5nQ29tcG9uZW50czoge1xuICAgICAgICAnd3hjLWRpYWxvZyc6ICdAbWludWkvd3hjLWRpYWxvZycsXG4gICAgICAgICd3eGMtYWJub3InOiAnQG1pbnVpL3d4Yy1hYm5vcicsXG4gICAgICAgICd3eGMtZWxpcCc6ICdAbWludWkvd3hjLWVsaXAnLFxuICAgICAgICAnd3hjLWZsZXgnOiAnQG1pbnVpL3d4Yy1mbGV4JyxcbiAgICAgICAgJ3d4Yy1pY29uJzogJ0BtaW51aS93eGMtaWNvbicsXG4gICAgICAgICd3eGMtYXZhdGFyJzogJ0BtaW51aS93eGMtYXZhdGFyJyxcbiAgICAgIH1cbiAgICB9LFxuICAgIGRhdGE6IHtcbiAgICAgIHBldF9jbGFzc19pZF9pbmRleDogJycsXG4gICAgICBzZXhzOiBbJ+WFrCcsICfmr40nXSxcbiAgICAgIGJhYnlzOiBbJ+aYrycsICflkKYnXSxcbiAgICAgIGNsYXNzczogW3tcbiAgICAgICAga2V5OiAxLFxuICAgICAgICBuYW1lOiAn5Yqg6I+yJ1xuICAgICAgfSx7XG4gICAgICAgIGtleTogMixcbiAgICAgICAgbmFtZTogJ+azouaWrydcbiAgICAgIH1dLFxuICAgICAgcGV0OiB7XG4gICAgICAgIHBldF9waWNfdXJsOiAnJyxcbiAgICAgICAgcGV0X3BpYzogJycsXG4gICAgICAgIHBldF9uYW1lOiAnJyxcbiAgICAgICAgcGV0X2NsYXNzX2lkOiAnJyxcbiAgICAgICAgcGV0X2NsYXNzX25hbWU6ICcnLFxuICAgICAgICBwZXRfc2V4OiAnJyxcbiAgICAgICAgcGV0X3NleF9pZDogJycsXG4gICAgICAgIHBldF93aWxsX2hhdmVfYmFieTogJycsXG4gICAgICAgIHBldF93aWxsX2hhdmVfYmFieV9pZDogJycsXG4gICAgICAgIGJpcnRoZGF5OiAnJ1xuICAgICAgfSxcbiAgICAgIHBldF9pZDogMCxcbiAgICAgIGlzRWRpdDogZmFsc2UsXG4gICAgICBwZXRzOiBbXSxcbiAgICB9LFxuICAgIG9uTG9hZDogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgIGNvbnN0IHBldF9pZCA9IChvcHRpb25zLmlkIHx8IDApIC8gMSB8fCAwXG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICBwZXRfaWQsXG4gICAgICAgIGlzRWRpdDogISFwZXRfaWRcbiAgICAgIH0sICgpID0+IHRoaXMuZ2V0Q2xhc3NzKCkpXG4gICAgfSxcblxuXHRjaG9vc2VJbWFnZSgpIHtcblx0XHR1cGxvYWQoZ2V0QXBwKCkpLnRoZW4oZGF0YSA9PiB7XG5cdFx0XHQvLyBkYXRhID0ganNvbi5qc29uRGVjb2RlKGRhdGEpXG5cdFx0XHRpZiAoZGF0YS5zdGF0dXMgPT0gMClcblx0XHRcdFx0cmV0dXJuIGdldEFwcCgpLnNob3dUb2FzdCgn5LiK5Lyg5aSx6LSlLOivt+mHjeivlScpXG5cbiAgICAgIGNvbnN0IHBpYyA9IGRhdGEuZGF0YS5jb250ZW50XG4gICAgICBkZWJ1Z2dlclxuXHRcdFx0dGhpcy5zZXREYXRhKHtcblx0XHRcdFx0J3BldC5wZXRfcGljX3VybCc6IHBpYy51cmwsXG5cdFx0XHRcdCdwZXQucGV0X3BpYyc6IHBpYy5waWMsXG5cdFx0XHR9KVxuXHRcdH0pXG5cdH0sXG5cbiAgICBnZXRDbGFzc3MoKSB7XG4gICAgICBnZXRBcHAoKS5nZXQoJ3BldC9nZXRQZXRDbGFzcycpLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgIGNvbnN0IGNsYXNzcyA9IGRhdGEuZGF0YS5jb250ZW50Lm1hcChpdGVtID0+IHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAga2V5OiBpdGVtLnBldF9jbGFzc19pZCAvIDEsXG4gICAgICAgICAgICBuYW1lOiBpdGVtLnBldF9jbGFzc19uYW1lXG4gICAgICAgICAgfVxuICAgICAgICB9KVxuXG4gICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgY2xhc3NzXG4gICAgICAgIH0pXG4gICAgICB9KS50aGVuKCgpID0+IHRoaXMuZ2V0RGV0YWlsKCkpXG4gICAgfSxcblxuICAgIGdldERldGFpbCgpIHtcbiAgICAgIGNvbnN0IHNlbGYgPSB0aGlzXG5cbiAgICAgIGlmICh0aGlzLmRhdGEuaXNFZGl0KSB7XG4gICAgICAgIGdldEFwcCgpLmdldCgncGV0L29uZT9wZXRfaWQ9JyArIHRoaXMuZGF0YS5wZXRfaWQpLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgICAgY29uc3QgcGV0ID0gZGF0YS5kYXRhLmNvbnRlbnRcblxuICAgICAgICAgIHBldC5wZXRfaWQgPSBwZXQucGV0X2lkIC8gMVxuICAgICAgICAgIHBldC5wZXRfd2lsbF9oYXZlX2JhYnlfaWQgPSBwZXQucGV0X3dpbGxfaGF2ZV9iYWJ5X2lkIC8gMVxuICAgICAgICAgIHBldC5wZXRfY2xhc3NfaWQgPSBwZXQucGV0X2NsYXNzX2lkIC8gMVxuICAgICAgICAgIHBldC5wZXRfc2V4X2lkID0gcGV0LnBldF9zZXhfaWQgLyAxXG5cbiAgICAgICAgICBjb25zdCBwZXRfY2xhc3NfaWRfaW5kZXggPSB0aGlzLmRhdGEuY2xhc3NzLmZpbmRJbmRleChpdGVtID0+IGl0ZW0ua2V5ID09IHBldC5wZXRfY2xhc3NfaWQpXG5cbiAgICAgICAgICBzZWxmLnNldERhdGEoe1xuICAgICAgICAgICAgcGV0X2NsYXNzX2lkX2luZGV4LFxuICAgICAgICAgICAgcGV0XG4gICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgb25TaG93OiBmdW5jdGlvbiAoKSB7XG4gICAgICAvLyB0aGlzLmdldFBldHMoKVxuICAgIH0sXG5cbiAgICBiaW5kQ2hhbmdlTmFtZShlKSB7XG4gICAgICBjb25zdCBrID0gZS5kZXRhaWwudmFsdWVcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICdwZXQucGV0X25hbWUnOiBrXG4gICAgICB9KVxuICAgIH0sXG5cbiAgICBkZWxldGVQZXQoKSB7XG4gICAgICBsZXQgZGlhbG9nQ29tcG9uZW50ID0gdGhpcy5kYXRhLmxhc3RDb21wb25lbnQgPSB0aGlzLnNlbGVjdENvbXBvbmVudCgnLnd4Yy1jYW5jZWwtcGV0JylcbiAgICAgIGRpYWxvZ0NvbXBvbmVudCAmJiBkaWFsb2dDb21wb25lbnQuc2hvdygpO1xuICAgIH0sXG5cbiAgICBjYW5jZWxEZWxldGVQZXQoKSB7XG4gICAgICBsZXQgZGlhbG9nQ29tcG9uZW50ID0gdGhpcy5kYXRhLmxhc3RDb21wb25lbnQgPSB0aGlzLnNlbGVjdENvbXBvbmVudCgnLnd4Yy1jYW5jZWwtcGV0JylcbiAgICAgIGRpYWxvZ0NvbXBvbmVudCAmJiBkaWFsb2dDb21wb25lbnQuaGlkZSgpO1xuICAgIH0sXG5cbiAgICBjb25maXJtRGVsZXRlUGV0KCkge1xuICAgICAgZ2V0QXBwKCkucG9zdCgncGV0L3JlbW92ZVBldCcsIHtcbiAgICAgICAgcGV0X2lkOiB0aGlzLmRhdGEucGV0X2lkXG4gICAgICB9KS50aGVuKGRhdGEgPT4ge1xuICAgICAgICB3eC5uYXZpZ2F0ZUJhY2soKVxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgYmluZENoYW5nZUNsYXNzKGUpIHtcbiAgICAgIGNvbnN0IGsgPSBlLmRldGFpbC52YWx1ZVxuICAgICAgY29uc3QgdiA9IHRoaXMuZGF0YS5jbGFzc3Nba11cbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICdwZXRfY2xhc3NfaWRfaW5kZXgnOiBrLFxuICAgICAgICAncGV0LnBldF9jbGFzc19pZCc6IHZbJ2tleSddLFxuICAgICAgICAncGV0LnBldF9jbGFzc19uYW1lJzogdlsnbmFtZSddLFxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgYmluZENoYW5nZVNleChlKSB7XG4gICAgICBjb25zdCBrID0gZS5kZXRhaWwudmFsdWVcbiAgICAgIGNvbnN0IHYgPSB0aGlzLmRhdGEuc2V4c1trXVxuICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgJ3BldC5wZXRfc2V4JzogdixcbiAgICAgICAgJ3BldC5wZXRfc2V4X2lkJzogayxcbiAgICAgIH0pXG4gICAgfSxcblxuXG4gICAgYmluZENoYW5nZUJhYnkoZSkge1xuICAgICAgY29uc3QgayA9IGUuZGV0YWlsLnZhbHVlXG4gICAgICBjb25zdCB2ID0gdGhpcy5kYXRhLmJhYnlzW2tdXG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAncGV0LnBldF93aWxsX2hhdmVfYmFieSc6IHYsXG4gICAgICAgICdwZXQucGV0X3dpbGxfaGF2ZV9iYWJ5X2lkJzogayxcbiAgICAgIH0pXG4gICAgfSxcblxuICAgIGJpbmRDaGFuZ2VEYXRlKGUpIHtcbiAgICAgIGNvbnN0IGsgPSBlLmRldGFpbC52YWx1ZVxuICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgJ3BldC5iaXJ0aGRheSc6IGtcbiAgICAgIH0pXG4gICAgfSxcblxuICAgIGFkZFBldCgpIHtcbiAgICAgIGxldCBhcHAgPSBnZXRBcHAoKVxuICAgICAgbGV0IHVybCA9ICdwZXQvY3JlYXRlUGV0J1xuICAgICAgaWYgKHRoaXMuZGF0YS5pc0VkaXQpXG4gICAgICAgIHVybCA9ICdwZXQvdXBkYXRlUGV0P3BldF9pZD0nICsgdGhpcy5kYXRhLnBldF9pZFxuXG4gICAgICBhcHAucG9zdCh1cmwsIHRoaXMuZGF0YS5wZXQpLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgIHd4Lm5hdmlnYXRlQmFjaygpXG4gICAgICB9KVxuICAgIH0sXG5cbiAgICBnZXRQZXRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgYXBwID0gZ2V0QXBwKClcbiAgICAgIGFwcC5nZXQoJ3BldC9maW5kTXlQZXRzJykudGhlbihkYXRhID0+IHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IGRhdGEuZGF0YVxuICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgIHBldHM6IHJlc3VsdC5jb250ZW50XG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgIH0sXG4gIH0iXX0=