'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = Page({
  data: {
    '__code__': {
      readme: ''
    },

    accountAmount: 0, // 账户余额
    amount: 0,
    orderType: '',
    orderId: '',
    lastComponent: '',
    formId: '',
    lastIndex: '',
    orderList: [],
    payType: '',
    beauticianCode: '',
    couponCode: ''
  },
  onLoad: function onLoad(options) {
    // console.log(options)
  },
  onShow: function onShow() {
    this.getOrderList();
  },
  getOrderList: function getOrderList() {
    var _this = this;

    var app = getApp();
    app.get('center/order', { order_status: 1 }).then(function (data) {
      var result = data.data;
      result.content.forEach(function (item) {
        return item.appointment_end_time = _this._realDay(item.appointment_day, item.appointment_end_time);
      });
      _this.setData({
        orderList: result.content
      });
    });
  },
  payOffline: function payOffline() {
    var _this2 = this;

    var app = getApp();
    if (this.data.payType === 'cash') {
      if (this.data.beauticianCode.trim().length === 0) {
        wx.showToast({
          title: '管家工号不能为空',
          icon: 'none'
        });

        return;
      }
    }

    // 团购
    if (this.data.payType === 'group') {
      if (!this.data.couponCode.match(/^\d{10}$/) && !this.data.couponCode.match(/^\d{12}$/)) {
        wx.showToast({
          title: '券号输入错误,券号位数为10位或者12位',
          icon: 'none'
        });

        return;
      }
    }

    app.post('center/completeOrder/' + this.data.orderId, {
      type: this.data.payType,
      beautician_code: this.data.beauticianCode, coupon_code: this.data.couponCode
    }).then(function () {
      _this2.getOrderList();
      _this2.cancel();
    }).catch(function (error) {
      wx.showToast({
        title: error.detail || '支付失败，请重试',
        duration: 2000,
        icon: 'none'
      });
    });
  },

  payOnline: function payOnline() {
    var _this3 = this;

    var app = getApp();
    app.get('order/pay/' + this.data.orderNo).then(function (data) {
      var result = data.data;
      var self = _this3;
      var payParams = {
        'success': function success(res) {

          wx.showToast({
            title: '支付成功,等待数据确认，请稍等...',
            duration: 3000,
            icon: 'none'
          });

          self.cancel();

          setTimeout(function (x) {
            return self.getOrderList();
          }, 2000);
        },
        'fail': function fail(res) {
          wx.showToast({
            title: '支付失败, 请重试...',
            duration: 2000,
            icon: 'none'
          });
        }
      };

      Object.assign(payParams, result.content);

      wx.requestPayment(payParams);
    }).catch(function (error) {
      wx.showToast({
        title: error.detail || '支付失败，请重试',
        duration: 2000,
        icon: 'none'
      });
    });
  },

  // 余额支付
  payRecharge: function payRecharge() {
    var app = getApp();
    var self = this;

    app.get('RechargeCard/rechargePayment/' + this.data.orderNo).then(function (data) {
      wx.showToast({
        title: '支付成功,等待数据确认，请稍等...',
        duration: 3000,
        icon: 'none'
      });

      self.cancel();

      setTimeout(function (x) {
        return self.getOrderList();
      }, 2000);
    }).catch(function (error) {
      wx.showToast({
        title: error.detail || '支付失败，请重试',
        duration: 2000,
        icon: 'none'
      });
    });
  },


  cash: function cash(event) {
    var id = event.currentTarget.dataset.id;
    this.setData({
      payType: 'cash',
      orderId: id
    });
    var dialogComponent = this.data.lastComponent = this.selectComponent('.wxc-cash');
    dialogComponent && dialogComponent.show();
  },
  handlerBeautician: function handlerBeautician(event) {
    var value = event.detail.value;
    this.setData({
      beauticianCode: value
    });
  },
  handlerCouponCode: function handlerCouponCode(event) {
    var value = event.detail.value;
    this.setData({
      couponCode: value
    });
  },

  scan: function scan(event) {
    var id = event.currentTarget.dataset.id;
    this.setData({
      payType: 'scan',
      orderId: id
    });
    var dialogComponent = this.data.lastComponent = this.selectComponent('.wxc-scan');
    dialogComponent && dialogComponent.show();
  },
  groupBy: function groupBy(event) {
    var id = event.currentTarget.dataset.id;
    this.setData({
      payType: 'group',
      orderId: id
    });
    var dialogComponent = this.data.lastComponent = this.selectComponent('.wxc-group');
    dialogComponent && dialogComponent.show();
  },

  // 在线支付
  online: function online(event) {
    var orderNo = event.currentTarget.dataset.id;
    var amount = event.currentTarget.dataset.amount / 1;
    this.setData({
      payType: 'online',
      orderNo: orderNo,
      amount: amount
    });
    var dialogComponent = this.data.lastComponent = this.selectComponent('.wxc-online');
    dialogComponent && dialogComponent.show();
  },

  // 余额支付弹窗
  rechargePayment: function rechargePayment(event) {
    var _this4 = this;

    // 查询账户余额
    var app = getApp();
    var orderNo = event.currentTarget.dataset.id;
    var amount = event.currentTarget.dataset.amount / 1;

    app.get('rechargeCard/getMyRechargeCardTotalAmount/' + orderNo).then(function (data) {
      var accountAmount = data.data.content.amount;
      var realPaymentAmount = data.data.content.real_pay_amount;
      if (accountAmount <= 0) {
        return wx.message('账户余额为0，不能支付');
      }

      if (amount > accountAmount) {
        return wx.message('\u8D26\u6237\u4F59\u989D\u4E3A:\uFFE5' + accountAmount + '\uFF0C\u4F59\u989D\u4E0D\u8DB3\uFF0C\u4E0D\u80FD\u652F\u4ED8');
      }

      _this4.setData({
        accountAmount: accountAmount
      }, function () {
        _this4.setData({
          payType: 'recharge',
          orderNo: orderNo,
          amount: realPaymentAmount
        });

        var dialogComponent = _this4.data.lastComponent = _this4.selectComponent('.wxc-recharge');
        dialogComponent && dialogComponent.show();
      });
    });
  },

  cancel: function cancel() {
    this.data.lastComponent.hide();

    this.setData({
      amount: 0,
      orderType: '',
      orderId: '',
      lastComponent: '',
      formId: '',
      lastIndex: '',
      payType: '',
      beauticianCode: '',
      couponCode: ''
    });
  },

  cancelOrderConfirm: function cancelOrderConfirm() {
    var _this5 = this;

    var app = getApp();
    var formId = this.data.formId;
    var orderId = this.data.orderId;
    var index = this.data.lastIndex;

    app.get('center/cancelOrder/' + orderId, { formId: formId }).then(function (data) {
      var orderList = _this5.data.orderList;
      orderList[index].order_status = 2;
      _this5.cancel();
    }).catch(function (error) {
      wx.showToast({
        title: error.detail
      });
    });
  },
  cancelOrder: function cancelOrder(event) {

    var dialogComponent = this.data.lastComponent = this.selectComponent('.wxc-cancel-order');
    dialogComponent && dialogComponent.show();

    var formId = event.detail.formId;
    var orderId = event.detail.target.dataset.id;
    var index = event.detail.target.dataset.index;
    this.setData({
      formId: formId,
      orderId: orderId,
      lastIndex: index
    });
  },
  _realDay: function _realDay(day, value) {
    try {
      var _day = day + ' ' + value;
      _day = _day.replace(/-/g, '/');
      var date = new Date(_day).getTime() + 30 * 60 * 1000;
      date = new Date(date);
      var minute = date.getMinutes();
      if (minute.toString().length == 1) minute += '0';

      // console.log(value)
      // console.log(day)
      return date.getHours() + ':' + minute + ':00';
    } catch (e) {
      return value;
    }
  }

});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4Lnd4cCJdLCJuYW1lcyI6WyJkYXRhIiwiYWNjb3VudEFtb3VudCIsImFtb3VudCIsIm9yZGVyVHlwZSIsIm9yZGVySWQiLCJsYXN0Q29tcG9uZW50IiwiZm9ybUlkIiwibGFzdEluZGV4Iiwib3JkZXJMaXN0IiwicGF5VHlwZSIsImJlYXV0aWNpYW5Db2RlIiwiY291cG9uQ29kZSIsIm9uTG9hZCIsIm9wdGlvbnMiLCJvblNob3ciLCJnZXRPcmRlckxpc3QiLCJhcHAiLCJnZXRBcHAiLCJnZXQiLCJvcmRlcl9zdGF0dXMiLCJ0aGVuIiwicmVzdWx0IiwiY29udGVudCIsImZvckVhY2giLCJpdGVtIiwiYXBwb2ludG1lbnRfZW5kX3RpbWUiLCJfcmVhbERheSIsImFwcG9pbnRtZW50X2RheSIsInNldERhdGEiLCJwYXlPZmZsaW5lIiwidHJpbSIsImxlbmd0aCIsInd4Iiwic2hvd1RvYXN0IiwidGl0bGUiLCJpY29uIiwibWF0Y2giLCJwb3N0IiwidHlwZSIsImJlYXV0aWNpYW5fY29kZSIsImNvdXBvbl9jb2RlIiwiY2FuY2VsIiwiY2F0Y2giLCJlcnJvciIsImRldGFpbCIsImR1cmF0aW9uIiwicGF5T25saW5lIiwib3JkZXJObyIsInNlbGYiLCJwYXlQYXJhbXMiLCJyZXMiLCJzZXRUaW1lb3V0IiwiT2JqZWN0IiwiYXNzaWduIiwicmVxdWVzdFBheW1lbnQiLCJwYXlSZWNoYXJnZSIsImNhc2giLCJldmVudCIsImlkIiwiY3VycmVudFRhcmdldCIsImRhdGFzZXQiLCJkaWFsb2dDb21wb25lbnQiLCJzZWxlY3RDb21wb25lbnQiLCJzaG93IiwiaGFuZGxlckJlYXV0aWNpYW4iLCJ2YWx1ZSIsImhhbmRsZXJDb3Vwb25Db2RlIiwic2NhbiIsImdyb3VwQnkiLCJvbmxpbmUiLCJyZWNoYXJnZVBheW1lbnQiLCJyZWFsUGF5bWVudEFtb3VudCIsInJlYWxfcGF5X2Ftb3VudCIsIm1lc3NhZ2UiLCJoaWRlIiwiY2FuY2VsT3JkZXJDb25maXJtIiwiaW5kZXgiLCJjYW5jZWxPcmRlciIsInRhcmdldCIsImRheSIsIl9kYXkiLCJyZXBsYWNlIiwiZGF0ZSIsIkRhdGUiLCJnZXRUaW1lIiwibWludXRlIiwiZ2V0TWludXRlcyIsInRvU3RyaW5nIiwiZ2V0SG91cnMiLCJlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFXSUEsUUFBTTtBQUFBO0FBQUE7QUFBQTs7QUFDSkMsbUJBQWUsQ0FEWCxFQUNjO0FBQ2xCQyxZQUFRLENBRko7QUFHSkMsZUFBVyxFQUhQO0FBSUpDLGFBQVMsRUFKTDtBQUtKQyxtQkFBZSxFQUxYO0FBTUpDLFlBQVEsRUFOSjtBQU9KQyxlQUFXLEVBUFA7QUFRSkMsZUFBVyxFQVJQO0FBU0pDLGFBQVMsRUFUTDtBQVVKQyxvQkFBZ0IsRUFWWjtBQVdKQyxnQkFBWTtBQVhSLEc7QUFhTkMsVUFBUSxnQkFBVUMsT0FBVixFQUFtQjtBQUN6QjtBQUNELEc7QUFDREMsVUFBUSxrQkFBWTtBQUNsQixTQUFLQyxZQUFMO0FBQ0QsRztBQUNEQSxnQkFBYyx3QkFBWTtBQUFBOztBQUN4QixRQUFJQyxNQUFNQyxRQUFWO0FBQ0FELFFBQUlFLEdBQUosQ0FBUSxjQUFSLEVBQXdCLEVBQUNDLGNBQWMsQ0FBZixFQUF4QixFQUEyQ0MsSUFBM0MsQ0FBZ0QsZ0JBQVE7QUFDdEQsVUFBSUMsU0FBU3JCLEtBQUtBLElBQWxCO0FBQ0FxQixhQUFPQyxPQUFQLENBQWVDLE9BQWYsQ0FBdUI7QUFBQSxlQUFRQyxLQUFLQyxvQkFBTCxHQUE0QixNQUFLQyxRQUFMLENBQWNGLEtBQUtHLGVBQW5CLEVBQW9DSCxLQUFLQyxvQkFBekMsQ0FBcEM7QUFBQSxPQUF2QjtBQUNBLFlBQUtHLE9BQUwsQ0FBYTtBQUNYcEIsbUJBQVdhLE9BQU9DO0FBRFAsT0FBYjtBQUdELEtBTkQ7QUFPRCxHO0FBQ0RPLGNBQVksc0JBQVk7QUFBQTs7QUFDdEIsUUFBSWIsTUFBTUMsUUFBVjtBQUNBLFFBQUksS0FBS2pCLElBQUwsQ0FBVVMsT0FBVixLQUFzQixNQUExQixFQUFrQztBQUNo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WWQsS0FBdkI7QUFDQWUsYUFBT0EsS0FBS0MsT0FBTCxDQUFhLElBQWIsRUFBbUIsR0FBbkIsQ0FBUDtBQUNBLFVBQUlDLE9BQVEsSUFBSUMsSUFBSixDQUFTSCxJQUFULENBQUQsQ0FBaUJJLE9BQWpCLEtBQTZCLEtBQUssRUFBTCxHQUFVLElBQWxEO0FBQ0FGLGFBQVEsSUFBSUMsSUFBSixDQUFTRCxJQUFULENBQVI7QUFDQSxVQUFJRyxTQUFTSCxLQUFLSSxVQUFMLEVBQWI7QUFDQSxVQUFJRCxPQUFPRSxRQUFQLEdBQWtCeEQsTUFBbEIsSUFBNEIsQ0FBaEMsRUFDRXNELFVBQVUsR0FBVjs7QUFFRjtBQUNBO0FBQ0EsYUFBT0gsS0FBS00sUUFBTCxLQUFrQixHQUFsQixHQUF3QkgsTUFBeEIsR0FBaUMsS0FBeEM7QUFDRCxLQVpELENBWUUsT0FBT0ksQ0FBUCxFQUFVO0FBQ1YsYUFBT3hCLEtBQVA7QUFDRDtBQUNGIiwiZmlsZSI6ImluZGV4Lnd4cCIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IHtcbiAgICBjb25maWc6IHtcbiAgICAgIG5hdmlnYXRpb25CYXJUaXRsZVRleHQ6ICfkubDljZUnLFxuICAgICAgbmF2aWdhdGlvbkJhckJhY2tncm91bmRDb2xvcjogJyNFOEU4RTgnLFxuICAgICAgbmF2aWdhdGlvbkJhclRleHRTdHlsZTogJ2JsYWNrJyxcbiAgICAgIHVzaW5nQ29tcG9uZW50czoge1xuICAgICAgICAnd3hjLWRpYWxvZyc6ICdAbWludWkvd3hjLWRpYWxvZycsXG4gICAgICAgICd3eGMtYWJub3InOiAnQG1pbnVpL3d4Yy1hYm5vcicsXG4gICAgICAgICd3eGMtZWxpcCc6ICdAbWludWkvd3hjLWVsaXAnLFxuICAgICAgfVxuICAgIH0sXG4gICAgZGF0YToge1xuICAgICAgYWNjb3VudEFtb3VudDogMCwgLy8g6LSm5oi35L2Z6aKdXG4gICAgICBhbW91bnQ6IDAsXG4gICAgICBvcmRlclR5cGU6ICcnLFxuICAgICAgb3JkZXJJZDogJycsXG4gICAgICBsYXN0Q29tcG9uZW50OiAnJyxcbiAgICAgIGZvcm1JZDogJycsXG4gICAgICBsYXN0SW5kZXg6ICcnLFxuICAgICAgb3JkZXJMaXN0OiBbXSxcbiAgICAgIHBheVR5cGU6ICcnLFxuICAgICAgYmVhdXRpY2lhbkNvZGU6ICcnLFxuICAgICAgY291cG9uQ29kZTogJydcbiAgICB9LFxuICAgIG9uTG9hZDogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKG9wdGlvbnMpXG4gICAgfSxcbiAgICBvblNob3c6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuZ2V0T3JkZXJMaXN0KClcbiAgICB9LFxuICAgIGdldE9yZGVyTGlzdDogZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IGFwcCA9IGdldEFwcCgpXG4gICAgICBhcHAuZ2V0KCdjZW50ZXIvb3JkZXInLCB7b3JkZXJfc3RhdHVzOiAxfSkudGhlbihkYXRhID0+IHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IGRhdGEuZGF0YVxuICAgICAgICByZXN1bHQuY29udGVudC5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5hcHBvaW50bWVudF9lbmRfdGltZSA9IHRoaXMuX3JlYWxEYXkoaXRlbS5hcHBvaW50bWVudF9kYXksIGl0ZW0uYXBwb2ludG1lbnRfZW5kX3RpbWUpKVxuICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgIG9yZGVyTGlzdDogcmVzdWx0LmNvbnRlbnRcbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgfSxcbiAgICBwYXlPZmZsaW5lOiBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgYXBwID0gZ2V0QXBwKClcbiAgICAgIGlmICh0aGlzLmRhdGEucGF5VHlwZSA9PT0gJ2Nhc2gnKSB7XG4gICAgICAgIGlmICh0aGlzLmRhdGEuYmVhdXRpY2lhbkNvZGUudHJpbSgpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgICB0aXRsZTogJ+euoeWutuW3peWPt+S4jeiDveS4uuepuicsXG4gICAgICAgICAgICBpY29uOiAnbm9uZSdcbiAgICAgICAgICB9KVxuXG4gICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8g5Zui6LStXG4gICAgICBpZiAodGhpcy5kYXRhLnBheVR5cGUgPT09ICdncm91cCcpIHtcbiAgICAgICAgaWYgKCF0aGlzLmRhdGEuY291cG9uQ29kZS5tYXRjaCgvXlxcZHsxMH0kLykgJiYgIXRoaXMuZGF0YS5jb3Vwb25Db2RlLm1hdGNoKC9eXFxkezEyfSQvKSkge1xuICAgICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgICB0aXRsZTogJ+WIuOWPt+i+k+WFpemUmeivryzliLjlj7fkvY3mlbDkuLoxMOS9jeaIluiAhTEy5L2NJyxcbiAgICAgICAgICAgIGljb246ICdub25lJ1xuICAgICAgICAgIH0pXG5cbiAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuICAgICAgfVxuXG5cbiAgICAgIGFwcC5wb3N0KGBjZW50ZXIvY29tcGxldGVPcmRlci8ke3RoaXMuZGF0YS5vcmRlcklkfWAsIHtcbiAgICAgICAgdHlwZTogdGhpcy5kYXRhLnBheVR5cGUsXG4gICAgICAgIGJlYXV0aWNpYW5fY29kZTogdGhpcy5kYXRhLmJlYXV0aWNpYW5Db2RlLCBjb3Vwb25fY29kZTogdGhpcy5kYXRhLmNvdXBvbkNvZGVcbiAgICAgIH0pLnRoZW4oKCkgPT4ge1xuICAgICAgICB0aGlzLmdldE9yZGVyTGlzdCgpXG4gICAgICAgIHRoaXMuY2FuY2VsKClcbiAgICAgIH0pXG4gICAgICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICAgIHRpdGxlOiBlcnJvci5kZXRhaWwgfHwgJ+aUr+S7mOWksei0pe+8jOivt+mHjeivlScsXG4gICAgICAgICAgICBkdXJhdGlvbjogMjAwMCxcbiAgICAgICAgICAgIGljb246ICdub25lJ1xuICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgfSxcblxuICAgIHBheU9ubGluZTogZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IGFwcCA9IGdldEFwcCgpXG4gICAgICBhcHAuZ2V0KGBvcmRlci9wYXkvJHt0aGlzLmRhdGEub3JkZXJOb31gKVxuICAgICAgICAudGhlbihkYXRhID0+IHtcbiAgICAgICAgICBsZXQgcmVzdWx0ID0gZGF0YS5kYXRhXG4gICAgICAgICAgbGV0IHNlbGYgPSB0aGlzXG4gICAgICAgICAgbGV0IHBheVBhcmFtcyA9IHtcbiAgICAgICAgICAgICdzdWNjZXNzJzogZnVuY3Rpb24gKHJlcykge1xuXG4gICAgICAgICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgICAgICAgdGl0bGU6ICfmlK/ku5jmiJDlip8s562J5b6F5pWw5o2u56Gu6K6k77yM6K+356iN562JLi4uJyxcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogMzAwMCxcbiAgICAgICAgICAgICAgICBpY29uOiAnbm9uZSdcbiAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICBzZWxmLmNhbmNlbCgpXG5cbiAgICAgICAgICAgICAgc2V0VGltZW91dCh4ID0+IHNlbGYuZ2V0T3JkZXJMaXN0KCksIDIwMDApXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJ2ZhaWwnOiBmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgICAgICAgdGl0bGU6ICfmlK/ku5jlpLHotKUsIOivt+mHjeivlS4uLicsXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IDIwMDAsXG4gICAgICAgICAgICAgICAgaWNvbjogJ25vbmUnXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgT2JqZWN0LmFzc2lnbihwYXlQYXJhbXMsIHJlc3VsdC5jb250ZW50KVxuXG4gICAgICAgICAgd3gucmVxdWVzdFBheW1lbnQocGF5UGFyYW1zKVxuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgICB0aXRsZTogZXJyb3IuZGV0YWlsIHx8ICfmlK/ku5jlpLHotKXvvIzor7fph43or5UnLFxuICAgICAgICAgICAgZHVyYXRpb246IDIwMDAsXG4gICAgICAgICAgICBpY29uOiAnbm9uZSdcbiAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH0sXG5cbiAgICAvLyDkvZnpop3mlK/ku5hcbiAgICBwYXlSZWNoYXJnZSgpIHtcbiAgICAgIGxldCBhcHAgPSBnZXRBcHAoKVxuICAgICAgY29uc3Qgc2VsZiA9IHRoaXNcblxuICAgICAgYXBwLmdldChgUmVjaGFyZ2VDYXJkL3JlY2hhcmdlUGF5bWVudC8ke3RoaXMuZGF0YS5vcmRlck5vfWApXG4gICAgICAgIC50aGVuKGRhdGEgPT4ge1xuICAgICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgICAgICAgdGl0bGU6ICfmlK/ku5jmiJDlip8s562J5b6F5pWw5o2u56Gu6K6k77yM6K+356iN562JLi4uJyxcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogMzAwMCxcbiAgICAgICAgICAgICAgICBpY29uOiAnbm9uZSdcbiAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICBzZWxmLmNhbmNlbCgpXG5cbiAgICAgICAgICAgICAgc2V0VGltZW91dCh4ID0+IHNlbGYuZ2V0T3JkZXJMaXN0KCksIDIwMDApXG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICAgIHRpdGxlOiBlcnJvci5kZXRhaWwgfHwgJ+aUr+S7mOWksei0pe+8jOivt+mHjeivlScsXG4gICAgICAgICAgICBkdXJhdGlvbjogMjAwMCxcbiAgICAgICAgICAgIGljb246ICdub25lJ1xuICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgfSxcblxuXG4gICAgY2FzaDogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBsZXQgaWQgPSBldmVudC5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaWRcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIHBheVR5cGU6ICdjYXNoJyxcbiAgICAgICAgb3JkZXJJZDogaWQsXG4gICAgICB9KVxuICAgICAgbGV0IGRpYWxvZ0NvbXBvbmVudCA9IHRoaXMuZGF0YS5sYXN0Q29tcG9uZW50ID0gdGhpcy5zZWxlY3RDb21wb25lbnQoJy53eGMtY2FzaCcpXG4gICAgICBkaWFsb2dDb21wb25lbnQgJiYgZGlhbG9nQ29tcG9uZW50LnNob3coKTtcbiAgICB9LFxuICAgIGhhbmRsZXJCZWF1dGljaWFuOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGxldCB2YWx1ZSA9IGV2ZW50LmRldGFpbC52YWx1ZVxuICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgYmVhdXRpY2lhbkNvZGU6IHZhbHVlXG4gICAgICB9KVxuICAgIH0sXG4gICAgaGFuZGxlckNvdXBvbkNvZGU6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgbGV0IHZhbHVlID0gZXZlbnQuZGV0YWlsLnZhbHVlXG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICBjb3Vwb25Db2RlOiB2YWx1ZVxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgc2NhbjogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBsZXQgaWQgPSBldmVudC5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaWRcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIHBheVR5cGU6ICdzY2FuJyxcbiAgICAgICAgb3JkZXJJZDogaWRcbiAgICAgIH0pXG4gICAgICBsZXQgZGlhbG9nQ29tcG9uZW50ID0gdGhpcy5kYXRhLmxhc3RDb21wb25lbnQgPSB0aGlzLnNlbGVjdENvbXBvbmVudCgnLnd4Yy1zY2FuJylcbiAgICAgIGRpYWxvZ0NvbXBvbmVudCAmJiBkaWFsb2dDb21wb25lbnQuc2hvdygpO1xuICAgIH0sXG4gICAgZ3JvdXBCeTogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBsZXQgaWQgPSBldmVudC5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaWRcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIHBheVR5cGU6ICdncm91cCcsXG4gICAgICAgIG9yZGVySWQ6IGlkXG4gICAgICB9KVxuICAgICAgbGV0IGRpYWxvZ0NvbXBvbmVudCA9IHRoaXMuZGF0YS5sYXN0Q29tcG9uZW50ID0gdGhpcy5zZWxlY3RDb21wb25lbnQoJy53eGMtZ3JvdXAnKVxuICAgICAgZGlhbG9nQ29tcG9uZW50ICYmIGRpYWxvZ0NvbXBvbmVudC5zaG93KCk7XG4gICAgfSxcblxuICAgIC8vIOWcqOe6v+aUr+S7mFxuICAgIG9ubGluZTogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBsZXQgb3JkZXJObyA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pZFxuICAgICAgbGV0IGFtb3VudCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZGF0YXNldC5hbW91bnQgLyAxXG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICBwYXlUeXBlOiAnb25saW5lJyxcbiAgICAgICAgb3JkZXJObzogb3JkZXJObyxcbiAgICAgICAgYW1vdW50OiBhbW91bnQsXG4gICAgICB9KVxuICAgICAgbGV0IGRpYWxvZ0NvbXBvbmVudCA9IHRoaXMuZGF0YS5sYXN0Q29tcG9uZW50ID0gdGhpcy5zZWxlY3RDb21wb25lbnQoJy53eGMtb25saW5lJylcbiAgICAgIGRpYWxvZ0NvbXBvbmVudCAmJiBkaWFsb2dDb21wb25lbnQuc2hvdygpO1xuICAgIH0sXG5cbiAgICAvLyDkvZnpop3mlK/ku5jlvLnnqpdcbiAgICByZWNoYXJnZVBheW1lbnQ6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgLy8g5p+l6K+i6LSm5oi35L2Z6aKdXG4gICAgICBsZXQgYXBwID0gZ2V0QXBwKClcbiAgICAgIGxldCBvcmRlck5vID0gZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0LmlkXG4gICAgICBsZXQgYW1vdW50ID0gZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0LmFtb3VudCAvIDFcblxuICAgICAgYXBwLmdldChgcmVjaGFyZ2VDYXJkL2dldE15UmVjaGFyZ2VDYXJkVG90YWxBbW91bnQvJHtvcmRlck5vfWApLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgIGNvbnN0IGFjY291bnRBbW91bnQgPSBkYXRhLmRhdGEuY29udGVudC5hbW91bnRcbiAgICAgICAgY29uc3QgcmVhbFBheW1lbnRBbW91bnQgPSBkYXRhLmRhdGEuY29udGVudC5yZWFsX3BheV9hbW91bnRcbiAgICAgICAgaWYgKGFjY291bnRBbW91bnQgPD0gMCkge1xuICAgICAgICAgIHJldHVybiB3eC5tZXNzYWdlKCfotKbmiLfkvZnpop3kuLow77yM5LiN6IO95pSv5LuYJylcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChhbW91bnQgPiBhY2NvdW50QW1vdW50KSB7XG4gICAgICAgICAgcmV0dXJuIHd4Lm1lc3NhZ2UoYOi0puaIt+S9memineS4ujrvv6Uke2FjY291bnRBbW91bnR977yM5L2Z6aKd5LiN6Laz77yM5LiN6IO95pSv5LuYYClcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgYWNjb3VudEFtb3VudFxuICAgICAgICB9LCAoKSA9PiB7XG4gICAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICAgIHBheVR5cGU6ICdyZWNoYXJnZScsXG4gICAgICAgICAgICBvcmRlck5vOiBvcmRlck5vLFxuICAgICAgICAgICAgYW1vdW50OiByZWFsUGF5bWVudEFtb3VudCxcbiAgICAgICAgICB9KVxuXG4gICAgICAgICAgbGV0IGRpYWxvZ0NvbXBvbmVudCA9IHRoaXMuZGF0YS5sYXN0Q29tcG9uZW50ID0gdGhpcy5zZWxlY3RDb21wb25lbnQoJy53eGMtcmVjaGFyZ2UnKVxuICAgICAgICAgIGRpYWxvZ0NvbXBvbmVudCAmJiBkaWFsb2dDb21wb25lbnQuc2hvdygpO1xuICAgICAgICB9KVxuICAgICAgfSlcbiAgICAgIFxuICAgIH0sXG5cblxuICAgIGNhbmNlbDogZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5kYXRhLmxhc3RDb21wb25lbnQuaGlkZSgpO1xuXG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICBhbW91bnQ6IDAsXG4gICAgICAgIG9yZGVyVHlwZTogJycsXG4gICAgICAgIG9yZGVySWQ6ICcnLFxuICAgICAgICBsYXN0Q29tcG9uZW50OiAnJyxcbiAgICAgICAgZm9ybUlkOiAnJyxcbiAgICAgICAgbGFzdEluZGV4OiAnJyxcbiAgICAgICAgcGF5VHlwZTogJycsXG4gICAgICAgIGJlYXV0aWNpYW5Db2RlOiAnJyxcbiAgICAgICAgY291cG9uQ29kZTogJydcbiAgICAgIH0pXG4gICAgfSxcblxuICAgIGNhbmNlbE9yZGVyQ29uZmlybTogZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IGFwcCA9IGdldEFwcCgpXG4gICAgICBsZXQgZm9ybUlkID0gdGhpcy5kYXRhLmZvcm1JZFxuICAgICAgbGV0IG9yZGVySWQgPSB0aGlzLmRhdGEub3JkZXJJZFxuICAgICAgbGV0IGluZGV4ID0gdGhpcy5kYXRhLmxhc3RJbmRleFxuXG4gICAgICBhcHAuZ2V0KCdjZW50ZXIvY2FuY2VsT3JkZXIvJyArIG9yZGVySWQsIHtmb3JtSWQ6IGZvcm1JZH0pXG4gICAgICAgIC50aGVuKGRhdGEgPT4ge1xuICAgICAgICAgIGxldCBvcmRlckxpc3QgPSB0aGlzLmRhdGEub3JkZXJMaXN0XG4gICAgICAgICAgb3JkZXJMaXN0W2luZGV4XS5vcmRlcl9zdGF0dXMgPSAyXG4gICAgICAgICAgdGhpcy5jYW5jZWwoKVxuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgICB0aXRsZTogZXJyb3IuZGV0YWlsXG4gICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9LFxuICAgIGNhbmNlbE9yZGVyOiBmdW5jdGlvbiAoZXZlbnQpIHtcblxuICAgICAgbGV0IGRpYWxvZ0NvbXBvbmVudCA9IHRoaXMuZGF0YS5sYXN0Q29tcG9uZW50ID0gdGhpcy5zZWxlY3RDb21wb25lbnQoJy53eGMtY2FuY2VsLW9yZGVyJylcbiAgICAgIGRpYWxvZ0NvbXBvbmVudCAmJiBkaWFsb2dDb21wb25lbnQuc2hvdygpO1xuXG4gICAgICBsZXQgZm9ybUlkID0gZXZlbnQuZGV0YWlsLmZvcm1JZFxuICAgICAgbGV0IG9yZGVySWQgPSBldmVudC5kZXRhaWwudGFyZ2V0LmRhdGFzZXQuaWRcbiAgICAgIGxldCBpbmRleCA9IGV2ZW50LmRldGFpbC50YXJnZXQuZGF0YXNldC5pbmRleFxuICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgZm9ybUlkOiBmb3JtSWQsXG4gICAgICAgIG9yZGVySWQ6IG9yZGVySWQsXG4gICAgICAgIGxhc3RJbmRleDogaW5kZXhcbiAgICAgIH0pXG4gICAgfSxcbiAgICBfcmVhbERheTogZnVuY3Rpb24gKGRheSwgdmFsdWUpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHZhciBfZGF5ID0gZGF5ICsgJyAnICsgdmFsdWVcbiAgICAgICAgX2RheSA9IF9kYXkucmVwbGFjZSgvLS9nLCAnLycpXG4gICAgICAgIGxldCBkYXRlID0gKG5ldyBEYXRlKF9kYXkpKS5nZXRUaW1lKCkgKyAzMCAqIDYwICogMTAwMFxuICAgICAgICBkYXRlID0gKG5ldyBEYXRlKGRhdGUpKVxuICAgICAgICBsZXQgbWludXRlID0gZGF0ZS5nZXRNaW51dGVzKClcbiAgICAgICAgaWYgKG1pbnV0ZS50b1N0cmluZygpLmxlbmd0aCA9PSAxKVxuICAgICAgICAgIG1pbnV0ZSArPSAnMCdcblxuICAgICAgICAvLyBjb25zb2xlLmxvZyh2YWx1ZSlcbiAgICAgICAgLy8gY29uc29sZS5sb2coZGF5KVxuICAgICAgICByZXR1cm4gZGF0ZS5nZXRIb3VycygpICsgJzonICsgbWludXRlICsgJzowMCdcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlXG4gICAgICB9XG4gICAgfVxuXG4gIH0iXX0=