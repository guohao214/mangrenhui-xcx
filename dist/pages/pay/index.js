'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = Page({
  data: {
    '__code__': {
      readme: ''
    },

    amount: 0,
    orderType: '',
    orderId: '',
    lastComponent: '',
    formId: '',
    lastIndex: '',
    orderList: [],
    payType: '',
    beauticianCode: '',
    couponCode: ''
  },
  onLoad: function onLoad(options) {
    // console.log(options)
  },
  onShow: function onShow() {
    this.getOrderList();
  },
  getOrderList: function getOrderList() {
    var _this = this;

    var app = getApp();
    app.get('center/order', { order_status: 1 }).then(function (data) {
      var result = data.data;
      result.content.forEach(function (item) {
        return item.appointment_end_time = _this._realDay(item.appointment_day, item.appointment_end_time);
      });
      _this.setData({
        orderList: result.content
      });
    });
  },
  payOffline: function payOffline() {
    var _this2 = this;

    var app = getApp();
    if (this.data.payType === 'cash') {
      if (this.data.beauticianCode.trim().length === 0) {
        wx.showToast({
          title: '技师工号不能为空',
          icon: 'none'
        });

        return;
      }
    }

    // 团购
    if (this.data.payType === 'group') {
      if (!this.data.couponCode.match(/^\d{10}$/) && !this.data.couponCode.match(/^\d{12}$/)) {
        wx.showToast({
          title: '券号输入错误,券号位数为10位或者12位',
          icon: 'none'
        });

        return;
      }
    }

    app.post('center/completeOrder/' + this.data.orderId, {
      type: this.data.payType,
      beautician_code: this.data.beauticianCode, coupon_code: this.data.couponCode
    }).then(function () {
      _this2.getOrderList();
      _this2.cancel();
    }).catch(function (error) {
      wx.showToast({
        title: error.detail || '支付失败，请重试',
        duration: 2000,
        icon: 'none'
      });
    });
  },
  payOnline: function payOnline() {
    var _this3 = this;

    var app = getApp();
    app.get('order/pay/' + this.data.orderNo).then(function (data) {
      var result = data.data;
      var self = _this3;
      var payParams = {
        'success': function success(res) {

          wx.showToast({
            title: '支付成功,等待数据确认，请稍等...',
            duration: 3000,
            icon: 'none'
          });

          self.cancel();

          setTimeout(function (x) {
            return self.getOrderList();
          }, 2000);
        },
        'fail': function fail(res) {
          wx.showToast({
            title: '支付失败, 请重试...',
            duration: 2000,
            icon: 'none'
          });
        }
      };

      Object.assign(payParams, result.content);

      wx.requestPayment(payParams);
    }).catch(function (error) {
      wx.showToast({
        title: error.detail || '支付失败，请重试',
        duration: 2000,
        icon: 'none'
      });
    });
  },
  cash: function cash(event) {
    var id = event.currentTarget.dataset.id;
    this.setData({
      payType: 'cash',
      orderId: id
    });
    var dialogComponent = this.data.lastComponent = this.selectComponent('.wxc-cash');
    dialogComponent && dialogComponent.show();
  },
  handlerBeautician: function handlerBeautician(event) {
    var value = event.detail.value;
    this.setData({
      beauticianCode: value
    });
  },
  handlerCouponCode: function handlerCouponCode(event) {
    var value = event.detail.value;
    this.setData({
      couponCode: value
    });
  },
  scan: function scan(event) {
    var id = event.currentTarget.dataset.id;
    this.setData({
      payType: 'scan',
      orderId: id
    });
    var dialogComponent = this.data.lastComponent = this.selectComponent('.wxc-scan');
    dialogComponent && dialogComponent.show();
  },
  groupBy: function groupBy(event) {
    var id = event.currentTarget.dataset.id;
    this.setData({
      payType: 'group',
      orderId: id
    });
    var dialogComponent = this.data.lastComponent = this.selectComponent('.wxc-group');
    dialogComponent && dialogComponent.show();
  },
  online: function online(event) {
    var orderNo = event.currentTarget.dataset.id;
    var amount = event.currentTarget.dataset.amount;
    this.setData({
      payType: 'online',
      orderNo: orderNo,
      amount: amount
    });
    var dialogComponent = this.data.lastComponent = this.selectComponent('.wxc-online');
    dialogComponent && dialogComponent.show();
  },
  cancel: function cancel() {
    this.data.lastComponent.hide();

    this.setData({
      amount: 0,
      orderType: '',
      orderId: '',
      lastComponent: '',
      formId: '',
      lastIndex: '',
      payType: '',
      beauticianCode: '',
      couponCode: ''
    });
  },

  cancelOrderConfirm: function cancelOrderConfirm() {
    var _this4 = this;

    var app = getApp();
    var formId = this.data.formId;
    var orderId = this.data.orderId;
    var index = this.data.lastIndex;

    app.get('center/cancelOrder/' + orderId, { formId: formId }).then(function (data) {
      var orderList = _this4.data.orderList;
      orderList[index].order_status = 2;
      _this4.cancel();
    }).catch(function (error) {
      wx.showToast({
        title: error.detail
      });
    });
  },
  cancelOrder: function cancelOrder(event) {

    var dialogComponent = this.data.lastComponent = this.selectComponent('.wxc-cancel-order');
    dialogComponent && dialogComponent.show();

    var formId = event.detail.formId;
    var orderId = event.detail.target.dataset.id;
    var index = event.detail.target.dataset.index;
    this.setData({
      formId: formId,
      orderId: orderId,
      lastIndex: index
    });
  },
  _realDay: function _realDay(day, value) {
    try {
      var _day = day + ' ' + value;
      _day = _day.replace(/-/g, '/');
      var date = new Date(_day).getTime() + 30 * 60 * 1000;
      date = new Date(date);
      var minute = date.getMinutes();
      if (minute.toString().length == 1) minute += '0';

      // console.log(value)
      // console.log(day)
      return date.getHours() + ':' + minute + ':00';
    } catch (e) {
      return value;
    }
  }

});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4Lnd4cCJdLCJuYW1lcyI6WyJkYXRhIiwiYW1vdW50Iiwib3JkZXJUeXBlIiwib3JkZXJJZCIsImxhc3RDb21wb25lbnQiLCJmb3JtSWQiLCJsYXN0SW5kZXgiLCJvcmRlckxpc3QiLCJwYXlUeXBlIiwiYmVhdXRpY2lhbkNvZGUiLCJjb3Vwb25Db2RlIiwib25Mb2FkIiwib3B0aW9ucyIsIm9uU2hvdyIsImdldE9yZGVyTGlzdCIsImFwcCIsImdldEFwcCIsImdldCIsIm9yZGVyX3N0YXR1cyIsInRoZW4iLCJyZXN1bHQiLCJjb250ZW50IiwiZm9yRWFjaCIsIml0ZW0iLCJhcHBvaW50bWVudF9lbmRfdGltZSIsIl9yZWFsRGF5IiwiYXBwb2ludG1lbnRfZGF5Iiwic2V0RGF0YSIsInBheU9mZmxpbmUiLCJ0cmltIiwibGVuZ3RoIiwid3giLCJzaG93VG9hc3QiLCJ0aXRsZSIsImljb24iLCJtYXRjaCIsInBvc3QiLCJ0eXBlIiwiYmVhdXRpY2lhbl9jb2RlIiwiY291cG9uX2NvZGUiLCJjYW5jZWwiLCJjYXRjaCIsImVycm9yIiwiZGV0YWlsIiwiZHVyYXRpb24iLCJwYXlPbmxpbmUiLCJvcmRlck5vIiwic2VsZiIsInBheVBhcmFtcyIsInJlcyIsInNldFRpbWVvdXQiLCJPYmplY3QiLCJhc3NpZ24iLCJyZXF1ZXN0UGF5bWVudCIsImNhc2giLCJldmVudCIsImlkIiwiY3VycmVudFRhcmdldCIsImRhdGFzZXQiLCJkaWFsb2dDb21wb25lbnQiLCJzZWxlY3RDb21wb25lbnQiLCJzaG93IiwiaGFuZGxlckJlYXV0aWNpYW4iLCJ2YWx1ZSIsImhhbmRsZXJDb3Vwb25Db2RlIiwic2NhbiIsImdyb3VwQnkiLCJvbmxpbmUiLCJoaWRlIiwiY2FuY2VsT3JkZXJDb25maXJtIiwiaW5kZXgiLCJjYW5jZWxPcmRlciIsInRhcmdldCIsImRheSIsIl9kYXkiLCJyZXBsYWNlIiwiZGF0ZSIsIkRhdGUiLCJnZXRUaW1lIiwibWludXRlIiwiZ2V0TWludXRl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ZUFBTCxDQUFxQixtQkFBckIsQ0FBaEQ7QUFDQUQsdUJBQW1CQSxnQkFBZ0JFLElBQWhCLEVBQW5COztBQUVBLFFBQUl4RCxTQUFTa0QsTUFBTVosTUFBTixDQUFhdEMsTUFBMUI7QUFDQSxRQUFJRixVQUFVb0QsTUFBTVosTUFBTixDQUFhNkIsTUFBYixDQUFvQmQsT0FBcEIsQ0FBNEJGLEVBQTFDO0FBQ0EsUUFBSWMsUUFBUWYsTUFBTVosTUFBTixDQUFhNkIsTUFBYixDQUFvQmQsT0FBcEIsQ0FBNEJZLEtBQXhDO0FBQ0EsU0FBSzNDLE9BQUwsQ0FBYTtBQUNYdEIsY0FBUUEsTUFERztBQUVYRixlQUFTQSxPQUZFO0FBR1hHLGlCQUFXZ0U7QUFIQSxLQUFiO0FBS0QsRztBQUNEN0MsWUFBVSxrQkFBVWdELEdBQVYsRUFBZVYsS0FBZixFQUFzQjtBQUM5QixRQUFJO0FBQ0YsVUFBSVcsT0FBT0QsTUFBTSxHQUFOLEdBQVlWLEtBQXZCO0FBQ0FXLGFBQU9BLEtBQUtDLE9BQUwsQ0FBYSxJQUFiLEVBQW1CLEdBQW5CLENBQVA7QUFDQSxVQUFJQyxPQUFRLElBQUlDLElBQUosQ0FBU0gsSUFBVCxDQUFELENBQWlCSSxPQUFqQixLQUE2QixLQUFLLEVBQUwsR0FBVSxJQUFsRDtBQUNBRixhQUFRLElBQUlDLElBQUosQ0FBU0QsSUFBVCxDQUFSO0FBQ0EsVUFBSUcsU0FBU0gsS0FBS0ksVUFBTCxFQUFiO0FBQ0EsVUFBSUQsT0FBT0UsUUFBUCxHQUFrQm5ELE1BQWxCLElBQTRCLENBQWhDLEVBQ0VpRCxVQUFVLEdBQVY7O0FBRUY7QUFDQTtBQUNBLGFBQU9ILEtBQUtNLFFBQUwsS0FBa0IsR0FBbEIsR0FBd0JILE1BQXhCLEdBQWlDLEtBQXhDO0FBQ0QsS0FaRCxDQVlFLE9BQU9JLENBQVAsRUFBVTtBQUNWLGFBQU9wQixLQUFQO0FBQ0Q7QUFDRiIsImZpbGUiOiJpbmRleC53eHAiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCB7XG4gICAgY29uZmlnOiB7XG4gICAgICBuYXZpZ2F0aW9uQmFyVGl0bGVUZXh0OiAn5Lmw5Y2VJyxcbiAgICAgIG5hdmlnYXRpb25CYXJCYWNrZ3JvdW5kQ29sb3I6ICcjRkZEQ0U0JyxcbiAgICAgIHVzaW5nQ29tcG9uZW50czoge1xuICAgICAgICAnd3hjLWRpYWxvZyc6ICdAbWludWkvd3hjLWRpYWxvZycsXG4gICAgICAgICd3eGMtYWJub3InOiAnQG1pbnVpL3d4Yy1hYm5vcicsXG4gICAgICAgICd3eGMtZWxpcCc6ICdAbWludWkvd3hjLWVsaXAnLFxuICAgICAgfVxuICAgIH0sXG4gICAgZGF0YToge1xuICAgICAgYW1vdW50OiAwLFxuICAgICAgb3JkZXJUeXBlOiAnJyxcbiAgICAgIG9yZGVySWQ6ICcnLFxuICAgICAgbGFzdENvbXBvbmVudDogJycsXG4gICAgICBmb3JtSWQ6ICcnLFxuICAgICAgbGFzdEluZGV4OiAnJyxcbiAgICAgIG9yZGVyTGlzdDogW10sXG4gICAgICBwYXlUeXBlOiAnJyxcbiAgICAgIGJlYXV0aWNpYW5Db2RlOiAnJyxcbiAgICAgIGNvdXBvbkNvZGU6ICcnXG4gICAgfSxcbiAgICBvbkxvYWQ6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhvcHRpb25zKVxuICAgIH0sXG4gICAgb25TaG93OiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmdldE9yZGVyTGlzdCgpXG4gICAgfSxcbiAgICBnZXRPcmRlckxpc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBhcHAgPSBnZXRBcHAoKVxuICAgICAgYXBwLmdldCgnY2VudGVyL29yZGVyJywge29yZGVyX3N0YXR1czogMX0pLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgIGxldCByZXN1bHQgPSBkYXRhLmRhdGFcbiAgICAgICAgcmVzdWx0LmNvbnRlbnQuZm9yRWFjaChpdGVtID0+IGl0ZW0uYXBwb2ludG1lbnRfZW5kX3RpbWUgPSB0aGlzLl9yZWFsRGF5KGl0ZW0uYXBwb2ludG1lbnRfZGF5LCBpdGVtLmFwcG9pbnRtZW50X2VuZF90aW1lKSlcbiAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICBvcmRlckxpc3Q6IHJlc3VsdC5jb250ZW50XG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgIH0sXG4gICAgcGF5T2ZmbGluZTogZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IGFwcCA9IGdldEFwcCgpXG4gICAgICBpZiAodGhpcy5kYXRhLnBheVR5cGUgPT09ICdjYXNoJykge1xuICAgICAgICBpZiAodGhpcy5kYXRhLmJlYXV0aWNpYW5Db2RlLnRyaW0oKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICAgICAgdGl0bGU6ICfmioDluIjlt6Xlj7fkuI3og73kuLrnqbonLFxuICAgICAgICAgICAgaWNvbjogJ25vbmUnXG4gICAgICAgICAgfSlcblxuICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIOWboui0rVxuICAgICAgaWYgKHRoaXMuZGF0YS5wYXlUeXBlID09PSAnZ3JvdXAnKSB7XG4gICAgICAgIGlmICghdGhpcy5kYXRhLmNvdXBvbkNvZGUubWF0Y2goL15cXGR7MTB9JC8pICYmICF0aGlzLmRhdGEuY291cG9uQ29kZS5tYXRjaCgvXlxcZHsxMn0kLykpIHtcbiAgICAgICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICAgICAgdGl0bGU6ICfliLjlj7fovpPlhaXplJnor68s5Yi45Y+35L2N5pWw5Li6MTDkvY3miJbogIUxMuS9jScsXG4gICAgICAgICAgICBpY29uOiAnbm9uZSdcbiAgICAgICAgICB9KVxuXG4gICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cbiAgICAgIH1cblxuXG4gICAgICBhcHAucG9zdChgY2VudGVyL2NvbXBsZXRlT3JkZXIvJHt0aGlzLmRhdGEub3JkZXJJZH1gLCB7XG4gICAgICAgIHR5cGU6IHRoaXMuZGF0YS5wYXlUeXBlLFxuICAgICAgICBiZWF1dGljaWFuX2NvZGU6IHRoaXMuZGF0YS5iZWF1dGljaWFuQ29kZSwgY291cG9uX2NvZGU6IHRoaXMuZGF0YS5jb3Vwb25Db2RlXG4gICAgICB9KS50aGVuKCgpID0+IHtcbiAgICAgICAgdGhpcy5nZXRPcmRlckxpc3QoKVxuICAgICAgICB0aGlzLmNhbmNlbCgpXG4gICAgICB9KVxuICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgICB0aXRsZTogZXJyb3IuZGV0YWlsIHx8ICfmlK/ku5jlpLHotKXvvIzor7fph43or5UnLFxuICAgICAgICAgICAgZHVyYXRpb246IDIwMDAsXG4gICAgICAgICAgICBpY29uOiAnbm9uZSdcbiAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH0sXG4gICAgcGF5T25saW5lOiBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgYXBwID0gZ2V0QXBwKClcbiAgICAgIGFwcC5nZXQoYG9yZGVyL3BheS8ke3RoaXMuZGF0YS5vcmRlck5vfWApXG4gICAgICAgIC50aGVuKGRhdGEgPT4ge1xuICAgICAgICAgIGxldCByZXN1bHQgPSBkYXRhLmRhdGFcbiAgICAgICAgICBsZXQgc2VsZiA9IHRoaXNcbiAgICAgICAgICBsZXQgcGF5UGFyYW1zID0ge1xuICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBmdW5jdGlvbiAocmVzKSB7XG5cbiAgICAgICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICAgICAgICB0aXRsZTogJ+aUr+S7mOaIkOWKnyznrYnlvoXmlbDmja7noa7orqTvvIzor7fnqI3nrYkuLi4nLFxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAzMDAwLFxuICAgICAgICAgICAgICAgIGljb246ICdub25lJ1xuICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgIHNlbGYuY2FuY2VsKClcblxuICAgICAgICAgICAgICBzZXRUaW1lb3V0KHggPT4gc2VsZi5nZXRPcmRlckxpc3QoKSwgMjAwMClcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAnZmFpbCc6IGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICAgICAgICB0aXRsZTogJ+aUr+S7mOWksei0pSwg6K+36YeN6K+VLi4uJyxcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogMjAwMCxcbiAgICAgICAgICAgICAgICBpY29uOiAnbm9uZSdcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICBPYmplY3QuYXNzaWduKHBheVBhcmFtcywgcmVzdWx0LmNvbnRlbnQpXG5cbiAgICAgICAgICB3eC5yZXF1ZXN0UGF5bWVudChwYXlQYXJhbXMpXG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICAgIHRpdGxlOiBlcnJvci5kZXRhaWwgfHwgJ+aUr+S7mOWksei0pe+8jOivt+mHjeivlScsXG4gICAgICAgICAgICBkdXJhdGlvbjogMjAwMCxcbiAgICAgICAgICAgIGljb246ICdub25lJ1xuICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgfSxcbiAgICBjYXNoOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGxldCBpZCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pZFxuICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgcGF5VHlwZTogJ2Nhc2gnLFxuICAgICAgICBvcmRlcklkOiBpZCxcbiAgICAgIH0pXG4gICAgICBsZXQgZGlhbG9nQ29tcG9uZW50ID0gdGhpcy5kYXRhLmxhc3RDb21wb25lbnQgPSB0aGlzLnNlbGVjdENvbXBvbmVudCgnLnd4Yy1jYXNoJylcbiAgICAgIGRpYWxvZ0NvbXBvbmVudCAmJiBkaWFsb2dDb21wb25lbnQuc2hvdygpO1xuICAgIH0sXG4gICAgaGFuZGxlckJlYXV0aWNpYW46IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgbGV0IHZhbHVlID0gZXZlbnQuZGV0YWlsLnZhbHVlXG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICBiZWF1dGljaWFuQ29kZTogdmFsdWVcbiAgICAgIH0pXG4gICAgfSxcbiAgICBoYW5kbGVyQ291cG9uQ29kZTogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBsZXQgdmFsdWUgPSBldmVudC5kZXRhaWwudmFsdWVcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIGNvdXBvbkNvZGU6IHZhbHVlXG4gICAgICB9KVxuICAgIH0sXG4gICAgc2NhbjogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBsZXQgaWQgPSBldmVudC5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaWRcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIHBheVR5cGU6ICdzY2FuJyxcbiAgICAgICAgb3JkZXJJZDogaWRcbiAgICAgIH0pXG4gICAgICBsZXQgZGlhbG9nQ29tcG9uZW50ID0gdGhpcy5kYXRhLmxhc3RDb21wb25lbnQgPSB0aGlzLnNlbGVjdENvbXBvbmVudCgnLnd4Yy1zY2FuJylcbiAgICAgIGRpYWxvZ0NvbXBvbmVudCAmJiBkaWFsb2dDb21wb25lbnQuc2hvdygpO1xuICAgIH0sXG4gICAgZ3JvdXBCeTogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBsZXQgaWQgPSBldmVudC5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaWRcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIHBheVR5cGU6ICdncm91cCcsXG4gICAgICAgIG9yZGVySWQ6IGlkXG4gICAgICB9KVxuICAgICAgbGV0IGRpYWxvZ0NvbXBvbmVudCA9IHRoaXMuZGF0YS5sYXN0Q29tcG9uZW50ID0gdGhpcy5zZWxlY3RDb21wb25lbnQoJy53eGMtZ3JvdXAnKVxuICAgICAgZGlhbG9nQ29tcG9uZW50ICYmIGRpYWxvZ0NvbXBvbmVudC5zaG93KCk7XG4gICAgfSxcbiAgICBvbmxpbmU6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgbGV0IG9yZGVyTm8gPSBldmVudC5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaWRcbiAgICAgIGxldCBhbW91bnQgPSBldmVudC5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuYW1vdW50XG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICBwYXlUeXBlOiAnb25saW5lJyxcbiAgICAgICAgb3JkZXJObzogb3JkZXJObyxcbiAgICAgICAgYW1vdW50OiBhbW91bnQsXG4gICAgICB9KVxuICAgICAgbGV0IGRpYWxvZ0NvbXBvbmVudCA9IHRoaXMuZGF0YS5sYXN0Q29tcG9uZW50ID0gdGhpcy5zZWxlY3RDb21wb25lbnQoJy53eGMtb25saW5lJylcbiAgICAgIGRpYWxvZ0NvbXBvbmVudCAmJiBkaWFsb2dDb21wb25lbnQuc2hvdygpO1xuICAgIH0sXG4gICAgY2FuY2VsOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmRhdGEubGFzdENvbXBvbmVudC5oaWRlKCk7XG5cbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIGFtb3VudDogMCxcbiAgICAgICAgb3JkZXJUeXBlOiAnJyxcbiAgICAgICAgb3JkZXJJZDogJycsXG4gICAgICAgIGxhc3RDb21wb25lbnQ6ICcnLFxuICAgICAgICBmb3JtSWQ6ICcnLFxuICAgICAgICBsYXN0SW5kZXg6ICcnLFxuICAgICAgICBwYXlUeXBlOiAnJyxcbiAgICAgICAgYmVhdXRpY2lhbkNvZGU6ICcnLFxuICAgICAgICBjb3Vwb25Db2RlOiAnJ1xuICAgICAgfSlcbiAgICB9LFxuXG4gICAgY2FuY2VsT3JkZXJDb25maXJtOiBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgYXBwID0gZ2V0QXBwKClcbiAgICAgIGxldCBmb3JtSWQgPSB0aGlzLmRhdGEuZm9ybUlkXG4gICAgICBsZXQgb3JkZXJJZCA9IHRoaXMuZGF0YS5vcmRlcklkXG4gICAgICBsZXQgaW5kZXggPSB0aGlzLmRhdGEubGFzdEluZGV4XG5cbiAgICAgIGFwcC5nZXQoJ2NlbnRlci9jYW5jZWxPcmRlci8nICsgb3JkZXJJZCwge2Zvcm1JZDogZm9ybUlkfSlcbiAgICAgICAgLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgICAgbGV0IG9yZGVyTGlzdCA9IHRoaXMuZGF0YS5vcmRlckxpc3RcbiAgICAgICAgICBvcmRlckxpc3RbaW5kZXhdLm9yZGVyX3N0YXR1cyA9IDJcbiAgICAgICAgICB0aGlzLmNhbmNlbCgpXG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICAgIHRpdGxlOiBlcnJvci5kZXRhaWxcbiAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH0sXG4gICAgY2FuY2VsT3JkZXI6IGZ1bmN0aW9uIChldmVudCkge1xuXG4gICAgICBsZXQgZGlhbG9nQ29tcG9uZW50ID0gdGhpcy5kYXRhLmxhc3RDb21wb25lbnQgPSB0aGlzLnNlbGVjdENvbXBvbmVudCgnLnd4Yy1jYW5jZWwtb3JkZXInKVxuICAgICAgZGlhbG9nQ29tcG9uZW50ICYmIGRpYWxvZ0NvbXBvbmVudC5zaG93KCk7XG5cbiAgICAgIGxldCBmb3JtSWQgPSBldmVudC5kZXRhaWwuZm9ybUlkXG4gICAgICBsZXQgb3JkZXJJZCA9IGV2ZW50LmRldGFpbC50YXJnZXQuZGF0YXNldC5pZFxuICAgICAgbGV0IGluZGV4ID0gZXZlbnQuZGV0YWlsLnRhcmdldC5kYXRhc2V0LmluZGV4XG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICBmb3JtSWQ6IGZvcm1JZCxcbiAgICAgICAgb3JkZXJJZDogb3JkZXJJZCxcbiAgICAgICAgbGFzdEluZGV4OiBpbmRleFxuICAgICAgfSlcbiAgICB9LFxuICAgIF9yZWFsRGF5OiBmdW5jdGlvbiAoZGF5LCB2YWx1ZSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgdmFyIF9kYXkgPSBkYXkgKyAnICcgKyB2YWx1ZVxuICAgICAgICBfZGF5ID0gX2RheS5yZXBsYWNlKC8tL2csICcvJylcbiAgICAgICAgbGV0IGRhdGUgPSAobmV3IERhdGUoX2RheSkpLmdldFRpbWUoKSArIDMwICogNjAgKiAxMDAwXG4gICAgICAgIGRhdGUgPSAobmV3IERhdGUoZGF0ZSkpXG4gICAgICAgIGxldCBtaW51dGUgPSBkYXRlLmdldE1pbnV0ZXMoKVxuICAgICAgICBpZiAobWludXRlLnRvU3RyaW5nKCkubGVuZ3RoID09IDEpXG4gICAgICAgICAgbWludXRlICs9ICcwJ1xuXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHZhbHVlKVxuICAgICAgICAvLyBjb25zb2xlLmxvZyhkYXkpXG4gICAgICAgIHJldHVybiBkYXRlLmdldEhvdXJzKCkgKyAnOicgKyBtaW51dGUgKyAnOjAwJ1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICByZXR1cm4gdmFsdWVcbiAgICAgIH1cbiAgICB9XG5cbiAgfSJdfQ==