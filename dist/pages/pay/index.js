'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = Page({
  data: {
    '__code__': {
      readme: ''
    },

    amount: 0,
    orderType: '',
    orderId: '',
    lastComponent: '',
    formId: '',
    lastIndex: '',
    orderList: [],
    payType: '',
    beauticianCode: '', // 技师工号
    couponCode: '' // 优惠券
  },
  onLoad: function onLoad(options) {
    // console.log(options)
  },
  onShow: function onShow() {
    this.getOrderList();
  },
  getOrderList: function getOrderList() {
    var _this = this;

    var app = getApp();
    app.get('center/order', { order_status: 1 }).then(function (data) {
      var result = data.data;
      result.content.forEach(function (item) {
        return item.appointment_end_time = _this._realDay(item.appointment_day, item.appointment_end_time);
      });
      _this.setData({
        orderList: result.content
      });
    });
  },
  payOffline: function payOffline() {
    var _this2 = this;

    var app = getApp();
    if (this.data.payType === 'cash') {
      if (this.data.beauticianCode.trim().length === 0) {
        wx.showToast({
          title: '技师工号不能为空',
          icon: 'none'
        });

        return;
      }
    }

    // 团购
    if (this.data.payType === 'group') {
      if (!this.data.couponCode.match(/^\d{10,12}$/)) {
        wx.showToast({
          title: '券号输入错误,券号位数为10位或者12位',
          icon: 'none'
        });

        return;
      }
    }

    app.post('center/completeOrder/' + this.data.orderId, {
      type: this.data.payType,
      beautician_code: this.data.beauticianCode, coupon_code: this.data.couponCode
    }).then(function () {
      _this2.getOrderList();
      _this2.data.lastComponent.hide();
      _this2.setData({
        orderId: '',
        orderNo: '',
        lastComponent: '',
        payType: '',
        beauticianCode: '', // 技师工号
        couponCode: '', // 优惠券,
        formId: '',
        lastIndex: ''
      });
    }).catch(function (error) {
      wx.showToast({
        title: error.detail || '支付失败，请重试',
        duration: 2000,
        icon: 'none'
      });
    });
  },
  payOnline: function payOnline() {
    var app = getApp();
    app.get('order/pay/' + this.data.orderNo).then(function (data) {
      var result = data.data;
      var payParams = {
        'success': function success(res) {
          var _this3 = this;

          wx.showToast({
            title: '支付成功,等待数据确认，请稍等...',
            duration: 3000,
            icon: 'none'
          });

          this.data.lastComponent.hide();

          this.setData({
            orderId: '',
            orderNo: '',
            lastComponent: '',
            payType: '',
            beauticianCode: '', // 技师工号
            couponCode: '', // 优惠券,
            formId: '',
            lastIndex: ''
          });

          setTimeout(function (x) {
            return _this3.getOrderList();
          }, 2000);
        },
        'fail': function fail(res) {
          wx.showToast({
            title: '支付失败, 请重试...',
            duration: 2000,
            icon: 'none'
          });
        }
      };

      Object.assign(payParams, result.content);

      wx.requestPayment(payParams);
    }).catch(function (error) {
      wx.showToast({
        title: error.detail || '支付失败，请重试',
        duration: 2000,
        icon: 'none'
      });
    });
  },
  cash: function cash(event) {
    var id = event.currentTarget.dataset.id;
    this.setData({
      payType: 'cash',
      orderId: id
    });
    var dialogComponent = this.data.lastComponent = this.selectComponent('.wxc-cash');
    dialogComponent && dialogComponent.show();
  },
  handlerBeautician: function handlerBeautician(event) {
    var value = event.detail.value;
    this.setData({
      beauticianCode: value
    });
  },
  handlerCouponCode: function handlerCouponCode(event) {
    var value = event.detail.value;
    this.setData({
      couponCode: value
    });
  },
  scan: function scan(event) {
    var id = event.currentTarget.dataset.id;
    this.setData({
      payType: 'scan',
      orderId: id
    });
    var dialogComponent = this.data.lastComponent = this.selectComponent('.wxc-scan');
    dialogComponent && dialogComponent.show();
  },
  groupBy: function groupBy(event) {
    var id = event.currentTarget.dataset.id;
    this.setData({
      payType: 'group',
      orderId: id
    });
    var dialogComponent = this.data.lastComponent = this.selectComponent('.wxc-group');
    dialogComponent && dialogComponent.show();
  },
  online: function online(event) {
    var orderNo = event.currentTarget.dataset.id;
    var amount = event.currentTarget.dataset.amount;
    this.setData({
      payType: 'online',
      orderNo: orderNo,
      amount: amount
    });
    var dialogComponent = this.data.lastComponent = this.selectComponent('.wxc-online');
    dialogComponent && dialogComponent.show();
  },
  cancel: function cancel() {
    this.data.lastComponent.hide();
  },

  cancelOrderConfirm: function cancelOrderConfirm() {
    var _this4 = this;

    var app = getApp();
    var formId = this.data.formId;
    var orderId = this.data.orderId;
    var index = this.data.lastIndex;

    app.get('center/cancelOrder/' + orderId, { formId: formId }).then(function (data) {
      _this4.data.lastComponent.hide();
      var orderList = _this4.data.orderList;
      orderList[index].order_status = 2;
      _this4.setData({
        orderList: orderList,
        orderId: '',
        orderNo: '',
        lastComponent: '',
        payType: '',
        beauticianCode: '', // 技师工号
        couponCode: '', // 优惠券,
        formId: ''
      });
    }).catch(function (error) {
      wx.showToast({
        title: error.detail
      });
    });
  },
  cancelOrder: function cancelOrder(event) {

    var dialogComponent = this.data.lastComponent = this.selectComponent('.wxc-cancel-order');
    dialogComponent && dialogComponent.show();

    var formId = event.detail.formId;
    var orderId = event.detail.target.dataset.id;
    var index = event.detail.target.dataset.index;
    this.setData({
      formId: formId,
      orderId: orderId,
      lastIndex: index
    });
  },
  _realDay: function _realDay(day, value) {
    try {
      var _day = day + ' ' + value;
      _day = _day.replace(/-/g, '/');
      var date = new Date(_day).getTime() + 30 * 60 * 1000;
      date = new Date(date);
      var minute = date.getMinutes();
      if (minute.toString().length == 1) minute += '0';

      // console.log(value)
      // console.log(day)
      return date.getHours() + ':' + minute + ':00';
    } catch (e) {
      return value;
    }
  }

});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4Lnd4cCJdLCJuYW1lcyI6WyJkYXRhIiwiYW1vdW50Iiwib3JkZXJUeXBlIiwib3JkZXJJZCIsImxhc3RDb21wb25lbnQiLCJmb3JtSWQiLCJsYXN0SW5kZXgiLCJvcmRlckxpc3QiLCJwYXlUeXBlIiwiYmVhdXRpY2lhbkNvZGUiLCJjb3Vwb25Db2RlIiwib25Mb2FkIiwib3B0aW9ucyIsIm9uU2hvdyIsImdldE9yZGVyTGlzdCIsImFwcCIsImdldEFwcCIsImdldCIsIm9yZGVyX3N0YXR1cyIsInRoZW4iLCJyZXN1bHQiLCJjb250ZW50IiwiZm9yRWFjaCIsIml0ZW0iLCJhcHBvaW50bWVudF9lbmRfdGltZSIsIl9yZWFsRGF5IiwiYXBwb2ludG1lbnRfZGF5Iiwic2V0RGF0YSIsInBheU9mZmxpbmUiLCJ0cmltIiwibGVuZ3RoIiwid3giLCJzaG93VG9hc3QiLCJ0aXRsZSIsImljb24iLCJtYXRjaCIsInBvc3QiLCJ0eXBlIiwiYmVhdXRpY2lhbl9jb2RlIiwiY291cG9uX2NvZGUiLCJoaWRlIiwib3JkZXJObyIsImNhdGNoIiwiZXJyb3IiLCJkZXRhaWwiLCJkdXJhdGlvbiIsInBheU9ubGluZSIsInBheVBhcmFtcyIsInJlcyIsInNldFRpbWVvdXQiLCJPYmplY3QiLCJhc3NpZ24iLCJyZXF1ZXN0UGF5bWVudCIsImNhc2giLCJldmVudCIsImlkIiwiY3VycmVudFRhcmdldCIsImRhdGFzZXQiLCJkaWFsb2dDb21wb25lbnQiLCJzZWxlY3RDb21wb25lbnQiLCJzaG93IiwiaGFuZGxlckJlYXV0aWNpYW4iLCJ2YWx1ZSIsImhhbmRsZXJDb3Vwb25Db2RlIiwic2NhbiIsImdyb3VwQnkiLCJvbmxpbmUiLCJjYW5jZWwiLCJjYW5jZWxPcmRlckNvbmZpcm0iLCJpbmRleCIsImNhbmNlbE9yZGVyIiwidGFyZ2V0IiwiZGF5IiwiX2RheSIsInJlcGxhY2UiLCJkYXRlIiwiRGF0ZSIsImdldFRpbWUiLCJtaW51dGUiLCJnZXRNaW51dGVzIiwidG9TdHJpbmciLCJnZXRIb3VycyIsImUiXSwibWFwcGluZ3MiOiI7Ozs7OztBQVFJQSxRQUFNO0FBQUE7QUFBQTtBQUFBOztBQUNKQyxZQUFRLENBREo7QUFFSkMsZUFBVyxFQUZQO0FBR0pDLGFBQVMsRUFITDtBQUlKQyxtQkFBZSxFQUpYO0FBS0pDLFlBQVEsRUFMSjtBQU1KQyxlQUFXLEVBTlA7QUFPSkMsZUFBVyxFQVBQO0FBUUpDLGFBQVMsRUFSTDtBQVNKQyxvQkFBZ0IsRUFUWixFQVNpQjtBQUNyQkMsZ0JBQVksRUFWUixDQVVpQjtBQVZqQixHO0FBWU5DLFVBQVEsZ0JBQVVDLE9BQVYsRUFBbUI7QUFDekI7QUFDRCxHO0FBQ0RDLFVBQVEsa0JBQVk7QUFDbEIsU0FBS0MsWUFBTDtBQUNELEc7QUFDREEsZ0JBQWMsd0JBQVk7QUFBQTs7QUFDeEIsUUFBSUMsTUFBTUMsUUFBVjtBQUNBRCxRQUFJRSxHQUFKLENBQVEsY0FBUixFQUF3QixFQUFFQyxjQUFjLENBQWhCLEVBQXhCLEVBQTRDQyxJQUE1QyxDQUFpRCxnQkFBUTtBQUN2RCxVQUFJQyxTQUFTcEIsS0FBS0EsSUFBbEI7QUFDQW9CLGFBQU9DLE9BQVAsQ0FBZUMsT0FBZixDQUF1QjtBQUFBLGVBQVFDLEtBQUtDLG9CQUFMLEdBQTRCLE1BQUtDLFFBQUwsQ0FBY0YsS0FBS0csZUFBbkIsRUFBb0NILEtBQUtDLG9CQUF6QyxDQUFwQztBQUFBLE9BQXZCO0FBQ0EsWUFBS0csT0FBTCxDQUFhO0FBQ1hwQixtQkFBV2EsT0FBT0M7QUFEUCxPQUFiO0FBR0QsS0FORDtBQU9ELEc7QUFDRE8sY0FBWSxzQkFBWTtBQUFBOztBQUN0QixRQUFJYixNQUFNQyxRQUFWO0FBQ0EsUUFBSSxLQUFLaEIsSUFBTCxDQUFVUSxPQUFWLEtBQXNCLE1BQTFCLEVBQWtDO0FBQ2hDLFVBQUksS0FBS1IsSUFBTCxDQUFVUyxjQUFWLENBQXlCb0IsSUFBekIsR0FBZ0NDLE1BQWhDLEtBQTJDLENBQS9DLEVBQWtEO0FBQ2hEQyxXQUFHQyxTQUFILENBQWE7QUFDWEMsaUJBQU8sVUFESTtBQUVYQyxnQkFBTTtBQUZLLFNBQWI7O0FBS0E7QUFDRDtBQUNGOztBQUVEO0FBQ0EsUUFBSSxLQUFLbEMsSUFBTCxDQUFVUSxPQUFWLEtBQXNCLE9BQTFCLEVBQW1DO0FBQ2pDLFVBQUksQ0FBQyxLQUFLUixJQUFMLENBQVVVLFVBQVYsQ0FBcUJ5QixLQUFyQixDQUEyQixhQUEzQixDQUFMLEVBQWdEO0FBQzlDSixXQUFHQyxTQUFILENBQWE7QUFDWEMsaUJBQU8sc0JBREk7QUFFWEMsZ0JBQU07QUFGSyxTQUFiOztBQUtBO0FBQ0Q7QUFDRjs7QUFHRG5CLFFBQUlxQixJQUFKLDJCQUFpQyxLQUFLcEMsSUFBTCxDQUFVRyxPQUEzQyxFQUFzRDtBQUNwRGtDLFlBQU0sS0FBS3JDLElBQUwsQ0FBVVEsT0FEb0M7QUFFcEQ4Qix1QkFBaUIsS0FBS3RDLElBQUwsQ0FBVVMsY0FGeUIsRUFFVDhCLGFBQWEsS0FBS3ZDLElBQUwsQ0FBVVU7QUFGZCxLQUF0RCxFQUdHUyxJQUhILENBR1EsWUFBTTtBQUNaLGFBQUtMLFlBQUw7QUFDQSxhQUFLZCxJQUFMLENBQVVJLGFBQVYsQ0FBd0JvQyxJQUF4QjtBQUNBLGFBQUtiLE9BQUwsQ0FBYTtBQUNYeEIsaUJBQVMsRUFERTtBQUVYc0MsaUJBQVMsRUFGRTtBQUdYckMsdUJBQWUsRUFISjtBQUlYSSxpQkFBUyxFQUpFO0FBS1hDLHdCQUFnQixFQUxMLEVBS1U7QUFDckJDLG9CQUFZLEVBTkQsRUFNVztBQUN0QkwsZ0JBQVEsRUFQRztBQVFYQyxtQkFBVztBQVJBLE9BQWI7QUFVRCxLQWhCRCxFQWlCR29DLEtBakJILENBaUJTLGlCQUFTO0FBQ2RYLFNBQUdDLFNBQUgsQ0FBYTtBQUNYQyxlQUFPVSxNQUFNQyxNQUFOLElBQWdCLFVBRFo7QUFFWEMsa0JBQVUsSUFGQztBQUdYWCxjQUFNO0FBSEssT0FBYjtBQUtELEtBdkJIO0FBd0JELEc7QUFDRFksYUFBVyxxQkFBWTtBQUNyQixRQUFJL0IsTUFBTUMsUUFBVjtBQUNBRCxRQUFJRSxHQUFKLGdCQUFxQixLQUFLakIsSUFBTCxDQUFVeUMsT0FBL0IsRUFDR3RCLElBREgsQ0FDUSxnQkFBUTtBQUNaLFVBQUlDLFNBQVNwQixLQUFLQSxJQUFsQjtBQUNBLFVBQUkrQyxZQUFZO0FBQ2QsbUJBQVcsaUJBQVVDLEdBQVYsRUFBZTtBQUFBOztBQUV4QmpCLGFBQUdDLFNBQUgsQ0FBYTtBQUNYQyxtQkFBTyxvQkFESTtBQUVYWSxzQkFBVSxJQUZDO0FBR1hYLGtCQUFNO0FBSEssV0FBYjs7QUFNQSxlQUFLbEMsSUFBTCxDQUFVSSxhQUFWLENBQXdCb0MsSUFBeEI7O0FBRUEsZUFBS2IsT0FBTCxDQUFhO0FBQ1h4QixxQkFBUyxFQURFO0FBRVhzQyxxQkFBUyxFQUZFO0FBR1hyQywyQkFBZSxFQUhKO0FBSVhJLHFCQUFTLEVBSkU7QUFLWEMsNEJBQWdCLEVBTEwsRUFLVTtBQUNyQkMsd0JBQVksRUFORCxFQU1XO0FBQ3RCTCxvQkFBUSxFQVBHO0FBUVhDLHVCQUFXO0FBUkEsV0FBYjs7QUFXQTJDLHFCQUFXO0FBQUEsbUJBQUssT0FBS25DLFlBQUwsRUFBTDtBQUFBLFdBQVgsRUFBcUMsSUFBckM7QUFDRCxTQXZCYTtBQXdCZCxnQkFBUSxjQUFVa0MsR0FBVixFQUFlO0FBQ3JCakIsYUFBR0MsU0FBSCxDQUFhO0FBQ1hDLG1CQUFPLGNBREk7QUFFWFksc0JBQVUsSUFGQztBQUdYWCxrQkFBTTtBQUhLLFdBQWI7QUFLRDtBQTlCYSxPQUFoQjs7QUFpQ0FnQixhQUFPQyxNQUFQLENBQWNKLFNBQWQsRUFBeUIzQixPQUFPQyxPQUFoQzs7QUFFQVUsU0FBR3FCLGNBQUgsQ0FBa0JMLFNBQWxCO0FBQ0QsS0F2Q0gsRUF3Q0dMLEtBeENILENBd0NTLGlCQUFTO0FBQ2RYLFNBQUdDLFNBQUgsQ0FBYTtBQUNYQyxlQUFPVSxNQUFNQyxNQUFOLElBQWdCLFVBRFo7QUFFWEMsa0JBQVUsSUFGQztBQUdYWCxjQUFNO0FBSEssT0FBYjtBQUtELEtBOUNIO0FBK0NELEc7QUFDRG1CLFFBQU0sY0FBVUMsS0FBVixFQUFpQjtBQUNyQixRQUFJQyxLQUFLRCxNQUFNRSxhQUFOLENBQW9CQyxPQUFwQixDQUE0QkYsRUFBckM7QUFDQSxTQUFLNUIsT0FBTCxDQUFhO0FBQ1huQixlQUFTLE1BREU7QUFFWEwsZUFBU29EO0FBRkUsS0FBYjtBQUlBLFFBQUlHLGtCQUFrQixLQUFLMUQsSUFBTCxDQUFVSSxhQUFWLEdBQTBCLEtBQUt1RCxlQUFMLENBQXFCLFdBQXJCLENBQWhEO0FBQ0FELHVCQUFtQkEsZ0JBQWdCRSxJQUFoQixFQUFuQjtBQUNELEc7QUFDREMscUJBQW1CLDJCQUFVUCxLQUFWLEVBQWlCO0FBQ2xDLFFBQUlRLFFBQVFSLE1BQU1WLE1BQU4sQ0FBYWtCLEtBQXpCO0FBQ0EsU0FBS25DLE9BQUwsQ0FBYTtBQUNYbEIsc0JBQWdCcUQ7QUFETCxLQUFiO0FBR0QsRztBQUNEQyxxQkFBbUIsMkJBQVVULEtBQVYsRUFBaUI7QUFDbEMsUUFBSVEsUUFBUVIsTUFBTVYsTUFBTixDQUFha0IsS0FBekI7QUFDQSxTQUFLbkMsT0FBTCxDQUFhO0FBQ1hqQixrQkFBWW9EO0FBREQsS0FBYjtBQUdELEc7QUFDREUsUUFBTSxjQUFVVixLQUFWLEVBQWlCO0FBQ3JCLFFBQUlDLEtBQUtELE1BQU1FLGFBQU4sQ0FBb0JDLE9BQXBCLENBQTRCRixFQUFyQztBQUNBLFNBQUs1QixPQUFMLENBQWE7QUFDWG5CLGVBQVMsTUFERTtBQUVYTCxlQUFTb0Q7QUFGRSxLQUFiO0FBSUEsUUFBSUcsa0JBQWtCLEtBQUsxRCxJQUFMLENBQVVJLGFBQVYsR0FBMEIsS0FBS3VELGVBQUwsQ0FBcUIsV0FBckIsQ0FBaEQ7QUFDQUQsdUJBQW1CQSxnQkFBZ0JFLElBQWhCLEVBQW5CO0FBQ0QsRztBQUNESyxXQUFTLGlCQUFVWCxLQUFWLEVBQWlCO0FBQ3hCLFFBQUlDLEtBQUtELE1BQU1FLGFBQU4sQ0FBb0JDLE9BQXBCLENBQTRCRixFQUFyQztBQUNBLFNBQUs1QixPQUFMLENBQWE7QUFDWG5CLGVBQVMsT0FERTtBQUVYTCxlQUFTb0Q7QUFGRSxLQUFiO0FBSUEsUUFBSUcsa0JBQWtCLEtBQUsxRCxJQUFMLENBQVVJLGFBQVYsR0FBMEIsS0FBS3VELGVBQUwsQ0FBcUIsWUFBckIsQ0FBaEQ7QUFDQUQsdUJBQW1CQSxnQkFBZ0JFLElBQWhCLEVBQW5CO0FBQ0QsRztBQUNETSxVQUFRLGdCQUFVWixLQUFWLEVBQWlCO0FBQ3ZCLFFBQUliLFVBQVVhLE1BQU1FLGFBQU4sQ0FBb0JDLE9BQXBCLENBQTRCRixFQUExQztBQUNBLFFBQUl0RCxTQUFTcUQsTUFBTUUsYUFBTixDQUFvQkMsT0FBcEIsQ0FBNEJ4RCxNQUF6QztBQUNBLFNBQUswQixPQUFMLENBQWE7QUFDWG5CLGVBQVMsUUFERTtBQUVYaUMsZUFBU0EsT0FGRTtBQUdYeEMsY0FBUUE7QUFIRyxLQUFiO0FBS0EsUUFBSXlELGtCQUFrQixLQUFLMUQsSUFBTCxDQUFVSSxhQUFWLEdBQTBCLEtBQUt1RCxlQUFMLENBQXFCLGFBQXJCLENBQWhEO0FBQ0FELHVCQUFtQkEsZ0JBQWdCRSxJQUFoQixFQUFuQjtBQUNELEc7QUFDRE8sVUFBUSxrQkFBWTtBQUNsQixTQUFLbkUsSUFBTCxDQUFVSSxhQUFWLENBQXdCb0MsSUFBeEI7QUFDRCxHOztBQUVENEIsc0JBQW9CLDhCQUFZO0FBQUE7O0FBQzlCLFFBQUlyRCxNQUFNQyxRQUFWO0FBQ0EsUUFBSVgsU0FBUyxLQUFLTCxJQUFMLENBQVVLLE1BQXZCO0FBQ0EsUUFBSUYsVUFBVSxLQUFLSCxJQUFMLENBQVVHLE9BQXhCO0FBQ0EsUUFBSWtFLFFBQVEsS0FBS3JFLElBQUwsQ0FBVU0sU0FBdEI7O0FBRUFTLFFBQUlFLEdBQUosQ0FBUSx3QkFBd0JkLE9BQWhDLEVBQXlDLEVBQUVFLFFBQVFBLE1BQVYsRUFBekMsRUFDR2MsSUFESCxDQUNRLGdCQUFRO0FBQ1osYUFBS25CLElBQUwsQ0FBVUksYUFBVixDQUF3Qm9DLElBQXhCO0FBQ0EsVUFBSWpDLFlBQVksT0FBS1AsSUFBTCxDQUFVTyxTQUExQjtBQUNBQSxnQkFBVThELEtBQVYsRUFBaUJuRCxZQUFqQixHQUFnQyxDQUFoQztBQUNBLGFBQUtTLE9BQUwsQ0FBYTtBQUNYcEIsbUJBQVdBLFNBREE7QUFFWEosaUJBQVMsRUFGRTtBQUdYc0MsaUJBQVMsRUFIRTtBQUlYckMsdUJBQWUsRUFKSjtBQUtYSSxpQkFBUyxFQUxFO0FBTVhDLHdCQUFnQixFQU5MLEVBTVU7QUFDckJDLG9CQUFZLEVBUEQsRUFPVztBQUN0QkwsZ0JBQVE7QUFSRyxPQUFiO0FBVUQsS0FmSCxFQWdCR3FDLEtBaEJILENBZ0JTLGlCQUFTO0FBQ2RYLFNBQUdDLFNBQUgsQ0FBYTtBQUNYQyxlQUFPVSxNQUFNQztBQURGLE9BQWI7QUFHRCxLQXBCSDtBQXFCRCxHO0FBQ0QwQixlQUFhLHFCQUFVaEIsS0FBVixFQUFpQjs7QUFFNUIsUUFBSUksa0JBQWtCLEtBQUsxRCxJQUFMLENBQVVJLGFBQVYsR0FBMEIsS0FBS3VELGVBQUwsQ0FBcUIsbUJBQXJCLENBQWhEO0FBQ0FELHVCQUFtQkEsZ0JBQWdCRSxJQUFoQixFQUFuQjs7QUFFQSxRQUFJdkQsU0FBU2lELE1BQU1WLE1BQU4sQ0FBYXZDLE1BQTFCO0FBQ0EsUUFBSUYsVUFBVW1ELE1BQU1WLE1BQU4sQ0FBYTJCLE1BQWIsQ0FBb0JkLE9BQXBCLENBQTRCRixFQUExQztBQUNBLFFBQUljLFFBQVFmLE1BQU1WLE1BQU4sQ0FBYTJCLE1BQWIsQ0FBb0JkLE9BQXBCLENBQTRCWSxLQUF4QztBQUNBLFNBQUsxQyxPQUFMLENBQWE7QUFDWHRCLGNBQVFBLE1BREc7QUFFWEYsZUFBU0EsT0FGRTtBQUdYRyxpQkFBVytEO0FBSEEsS0FBYjtBQUtELEc7QUFDRDVDLFlBQVUsa0JBQVUrQyxHQUFWLEVBQWVWLEtBQWYsRUFBc0I7QUFDOUIsUUFBSTtBQUNGLFVBQUlXLE9BQU9ELE1BQU0sR0FBTixHQUFZVixLQUF2QjtBQUNBVyxhQUFPQSxLQUFLQyxPQUFMLENBQWEsSUFBYixFQUFtQixHQUFuQixDQUFQO0FBQ0EsVUFBSUMsT0FBUSxJQUFJQyxJQUFKLENBQVNILElBQVQsQ0FBRCxDQUFpQkksT0FBakIsS0FBNkIsS0FBSyxFQUFMLEdBQVUsSUFBbEQ7QUFDQUYsYUFBUSxJQUFJQyxJQUFKLENBQVNELElBQVQsQ0FBUjtBQUNBLFVBQUlHLFNBQVNILEtBQUtJLFVBQUwsRUFBYjtBQUNBLFVBQUlELE9BQU9FLFFBQVAsR0FBa0JsRCxNQUFsQixJQUE0QixDQUFoQyxFQUNFZ0QsVUFBVSxHQUFWOztBQUVGO0FBQ0E7QUFDQSxhQUFPSCxLQUFLTSxRQUFMLEtBQWtCLEdBQWxCLEdBQXdCSCxNQUF4QixHQUFpQyxLQUF4QztBQUNELEtBWkQsQ0FZRSxPQUFPSSxDQUFQLEVBQVU7QUFDVixhQUFPcEIsS0FBUDtBQUNEO0FBQ0YiLCJmaWxlIjoiaW5kZXgud3hwIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQge1xuICAgIGNvbmZpZzoge1xuICAgICAgbmF2aWdhdGlvbkJhclRpdGxlVGV4dDogJ+aIkeeahOiuouWNlScsXG4gICAgICB1c2luZ0NvbXBvbmVudHM6IHtcbiAgICAgICAgJ3d4Yy1kaWFsb2cnOiAnQG1pbnVpL3d4Yy1kaWFsb2cnLFxuICAgICAgICAnd3hjLWFibm9yJzogJ0BtaW51aS93eGMtYWJub3InXG4gICAgICB9XG4gICAgfSxcbiAgICBkYXRhOiB7XG4gICAgICBhbW91bnQ6IDAsXG4gICAgICBvcmRlclR5cGU6ICcnLFxuICAgICAgb3JkZXJJZDogJycsXG4gICAgICBsYXN0Q29tcG9uZW50OiAnJyxcbiAgICAgIGZvcm1JZDogJycsXG4gICAgICBsYXN0SW5kZXg6ICcnLFxuICAgICAgb3JkZXJMaXN0OiBbXSxcbiAgICAgIHBheVR5cGU6ICcnLFxuICAgICAgYmVhdXRpY2lhbkNvZGU6ICcnLCAgLy8g5oqA5biI5bel5Y+3XG4gICAgICBjb3Vwb25Db2RlOiAnJyAgICAgICAvLyDkvJjmg6DliLhcbiAgICB9LFxuICAgIG9uTG9hZDogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKG9wdGlvbnMpXG4gICAgfSxcbiAgICBvblNob3c6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuZ2V0T3JkZXJMaXN0KClcbiAgICB9LFxuICAgIGdldE9yZGVyTGlzdDogZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IGFwcCA9IGdldEFwcCgpXG4gICAgICBhcHAuZ2V0KCdjZW50ZXIvb3JkZXInLCB7IG9yZGVyX3N0YXR1czogMX0pLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgIGxldCByZXN1bHQgPSBkYXRhLmRhdGFcbiAgICAgICAgcmVzdWx0LmNvbnRlbnQuZm9yRWFjaChpdGVtID0+IGl0ZW0uYXBwb2ludG1lbnRfZW5kX3RpbWUgPSB0aGlzLl9yZWFsRGF5KGl0ZW0uYXBwb2ludG1lbnRfZGF5LCBpdGVtLmFwcG9pbnRtZW50X2VuZF90aW1lKSlcbiAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICBvcmRlckxpc3Q6IHJlc3VsdC5jb250ZW50XG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgIH0sXG4gICAgcGF5T2ZmbGluZTogZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IGFwcCA9IGdldEFwcCgpXG4gICAgICBpZiAodGhpcy5kYXRhLnBheVR5cGUgPT09ICdjYXNoJykge1xuICAgICAgICBpZiAodGhpcy5kYXRhLmJlYXV0aWNpYW5Db2RlLnRyaW0oKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICAgICAgdGl0bGU6ICfmioDluIjlt6Xlj7fkuI3og73kuLrnqbonLFxuICAgICAgICAgICAgaWNvbjogJ25vbmUnXG4gICAgICAgICAgfSlcblxuICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIOWboui0rVxuICAgICAgaWYgKHRoaXMuZGF0YS5wYXlUeXBlID09PSAnZ3JvdXAnKSB7XG4gICAgICAgIGlmICghdGhpcy5kYXRhLmNvdXBvbkNvZGUubWF0Y2goL15cXGR7MTAsMTJ9JC8pKSB7XG4gICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICAgIHRpdGxlOiAn5Yi45Y+36L6T5YWl6ZSZ6K+vLOWIuOWPt+S9jeaVsOS4ujEw5L2N5oiW6ICFMTLkvY0nLFxuICAgICAgICAgICAgaWNvbjogJ25vbmUnXG4gICAgICAgICAgfSlcblxuICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG4gICAgICB9XG5cblxuICAgICAgYXBwLnBvc3QoYGNlbnRlci9jb21wbGV0ZU9yZGVyLyR7dGhpcy5kYXRhLm9yZGVySWR9YCwge1xuICAgICAgICB0eXBlOiB0aGlzLmRhdGEucGF5VHlwZSxcbiAgICAgICAgYmVhdXRpY2lhbl9jb2RlOiB0aGlzLmRhdGEuYmVhdXRpY2lhbkNvZGUsIGNvdXBvbl9jb2RlOiB0aGlzLmRhdGEuY291cG9uQ29kZVxuICAgICAgfSkudGhlbigoKSA9PiB7XG4gICAgICAgIHRoaXMuZ2V0T3JkZXJMaXN0KClcbiAgICAgICAgdGhpcy5kYXRhLmxhc3RDb21wb25lbnQuaGlkZSgpXG4gICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgb3JkZXJJZDogJycsXG4gICAgICAgICAgb3JkZXJObzogJycsXG4gICAgICAgICAgbGFzdENvbXBvbmVudDogJycsXG4gICAgICAgICAgcGF5VHlwZTogJycsXG4gICAgICAgICAgYmVhdXRpY2lhbkNvZGU6ICcnLCAgLy8g5oqA5biI5bel5Y+3XG4gICAgICAgICAgY291cG9uQ29kZTogJycsICAgICAgIC8vIOS8mOaDoOWIuCxcbiAgICAgICAgICBmb3JtSWQ6ICcnLFxuICAgICAgICAgIGxhc3RJbmRleDogJycsXG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgICB0aXRsZTogZXJyb3IuZGV0YWlsIHx8ICfmlK/ku5jlpLHotKXvvIzor7fph43or5UnLFxuICAgICAgICAgICAgZHVyYXRpb246IDIwMDAsXG4gICAgICAgICAgICBpY29uOiAnbm9uZSdcbiAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH0sXG4gICAgcGF5T25saW5lOiBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgYXBwID0gZ2V0QXBwKClcbiAgICAgIGFwcC5nZXQoYG9yZGVyL3BheS8ke3RoaXMuZGF0YS5vcmRlck5vfWApXG4gICAgICAgIC50aGVuKGRhdGEgPT4ge1xuICAgICAgICAgIGxldCByZXN1bHQgPSBkYXRhLmRhdGFcbiAgICAgICAgICBsZXQgcGF5UGFyYW1zID0ge1xuICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBmdW5jdGlvbiAocmVzKSB7XG5cbiAgICAgICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICAgICAgICB0aXRsZTogJ+aUr+S7mOaIkOWKnyznrYnlvoXmlbDmja7noa7orqTvvIzor7fnqI3nrYkuLi4nLFxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAzMDAwLFxuICAgICAgICAgICAgICAgIGljb246ICdub25lJ1xuICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgIHRoaXMuZGF0YS5sYXN0Q29tcG9uZW50LmhpZGUoKVxuXG4gICAgICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgICAgICAgb3JkZXJJZDogJycsXG4gICAgICAgICAgICAgICAgb3JkZXJObzogJycsXG4gICAgICAgICAgICAgICAgbGFzdENvbXBvbmVudDogJycsXG4gICAgICAgICAgICAgICAgcGF5VHlwZTogJycsXG4gICAgICAgICAgICAgICAgYmVhdXRpY2lhbkNvZGU6ICcnLCAgLy8g5oqA5biI5bel5Y+3XG4gICAgICAgICAgICAgICAgY291cG9uQ29kZTogJycsICAgICAgIC8vIOS8mOaDoOWIuCxcbiAgICAgICAgICAgICAgICBmb3JtSWQ6ICcnLFxuICAgICAgICAgICAgICAgIGxhc3RJbmRleDogJycsXG4gICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgc2V0VGltZW91dCh4ID0+IHRoaXMuZ2V0T3JkZXJMaXN0KCksIDIwMDApXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJ2ZhaWwnOiBmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgICAgICAgdGl0bGU6ICfmlK/ku5jlpLHotKUsIOivt+mHjeivlS4uLicsXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IDIwMDAsXG4gICAgICAgICAgICAgICAgaWNvbjogJ25vbmUnXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgT2JqZWN0LmFzc2lnbihwYXlQYXJhbXMsIHJlc3VsdC5jb250ZW50KVxuXG4gICAgICAgICAgd3gucmVxdWVzdFBheW1lbnQocGF5UGFyYW1zKVxuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgICB0aXRsZTogZXJyb3IuZGV0YWlsIHx8ICfmlK/ku5jlpLHotKXvvIzor7fph43or5UnLFxuICAgICAgICAgICAgZHVyYXRpb246IDIwMDAsXG4gICAgICAgICAgICBpY29uOiAnbm9uZSdcbiAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH0sXG4gICAgY2FzaDogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBsZXQgaWQgPSBldmVudC5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaWRcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIHBheVR5cGU6ICdjYXNoJyxcbiAgICAgICAgb3JkZXJJZDogaWQsXG4gICAgICB9KVxuICAgICAgbGV0IGRpYWxvZ0NvbXBvbmVudCA9IHRoaXMuZGF0YS5sYXN0Q29tcG9uZW50ID0gdGhpcy5zZWxlY3RDb21wb25lbnQoJy53eGMtY2FzaCcpXG4gICAgICBkaWFsb2dDb21wb25lbnQgJiYgZGlhbG9nQ29tcG9uZW50LnNob3coKTtcbiAgICB9LFxuICAgIGhhbmRsZXJCZWF1dGljaWFuOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGxldCB2YWx1ZSA9IGV2ZW50LmRldGFpbC52YWx1ZVxuICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgYmVhdXRpY2lhbkNvZGU6IHZhbHVlXG4gICAgICB9KVxuICAgIH0sXG4gICAgaGFuZGxlckNvdXBvbkNvZGU6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgbGV0IHZhbHVlID0gZXZlbnQuZGV0YWlsLnZhbHVlXG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICBjb3Vwb25Db2RlOiB2YWx1ZVxuICAgICAgfSlcbiAgICB9LFxuICAgIHNjYW46IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgbGV0IGlkID0gZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0LmlkXG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICBwYXlUeXBlOiAnc2NhbicsXG4gICAgICAgIG9yZGVySWQ6IGlkXG4gICAgICB9KVxuICAgICAgbGV0IGRpYWxvZ0NvbXBvbmVudCA9IHRoaXMuZGF0YS5sYXN0Q29tcG9uZW50ID0gdGhpcy5zZWxlY3RDb21wb25lbnQoJy53eGMtc2NhbicpXG4gICAgICBkaWFsb2dDb21wb25lbnQgJiYgZGlhbG9nQ29tcG9uZW50LnNob3coKTtcbiAgICB9LFxuICAgIGdyb3VwQnk6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgbGV0IGlkID0gZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0LmlkXG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICBwYXlUeXBlOiAnZ3JvdXAnLFxuICAgICAgICBvcmRlcklkOiBpZFxuICAgICAgfSlcbiAgICAgIGxldCBkaWFsb2dDb21wb25lbnQgPSB0aGlzLmRhdGEubGFzdENvbXBvbmVudCA9IHRoaXMuc2VsZWN0Q29tcG9uZW50KCcud3hjLWdyb3VwJylcbiAgICAgIGRpYWxvZ0NvbXBvbmVudCAmJiBkaWFsb2dDb21wb25lbnQuc2hvdygpO1xuICAgIH0sXG4gICAgb25saW5lOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGxldCBvcmRlck5vID0gZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0LmlkXG4gICAgICBsZXQgYW1vdW50ID0gZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0LmFtb3VudFxuICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgcGF5VHlwZTogJ29ubGluZScsXG4gICAgICAgIG9yZGVyTm86IG9yZGVyTm8sXG4gICAgICAgIGFtb3VudDogYW1vdW50LFxuICAgICAgfSlcbiAgICAgIGxldCBkaWFsb2dDb21wb25lbnQgPSB0aGlzLmRhdGEubGFzdENvbXBvbmVudCA9IHRoaXMuc2VsZWN0Q29tcG9uZW50KCcud3hjLW9ubGluZScpXG4gICAgICBkaWFsb2dDb21wb25lbnQgJiYgZGlhbG9nQ29tcG9uZW50LnNob3coKTtcbiAgICB9LFxuICAgIGNhbmNlbDogZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5kYXRhLmxhc3RDb21wb25lbnQuaGlkZSgpO1xuICAgIH0sXG5cbiAgICBjYW5jZWxPcmRlckNvbmZpcm06IGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBhcHAgPSBnZXRBcHAoKVxuICAgICAgbGV0IGZvcm1JZCA9IHRoaXMuZGF0YS5mb3JtSWRcbiAgICAgIGxldCBvcmRlcklkID0gdGhpcy5kYXRhLm9yZGVySWRcbiAgICAgIGxldCBpbmRleCA9IHRoaXMuZGF0YS5sYXN0SW5kZXhcblxuICAgICAgYXBwLmdldCgnY2VudGVyL2NhbmNlbE9yZGVyLycgKyBvcmRlcklkLCB7IGZvcm1JZDogZm9ybUlkfSlcbiAgICAgICAgLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgICAgdGhpcy5kYXRhLmxhc3RDb21wb25lbnQuaGlkZSgpXG4gICAgICAgICAgbGV0IG9yZGVyTGlzdCA9IHRoaXMuZGF0YS5vcmRlckxpc3RcbiAgICAgICAgICBvcmRlckxpc3RbaW5kZXhdLm9yZGVyX3N0YXR1cyA9IDJcbiAgICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgICAgb3JkZXJMaXN0OiBvcmRlckxpc3QsXG4gICAgICAgICAgICBvcmRlcklkOiAnJyxcbiAgICAgICAgICAgIG9yZGVyTm86ICcnLFxuICAgICAgICAgICAgbGFzdENvbXBvbmVudDogJycsXG4gICAgICAgICAgICBwYXlUeXBlOiAnJyxcbiAgICAgICAgICAgIGJlYXV0aWNpYW5Db2RlOiAnJywgIC8vIOaKgOW4iOW3peWPt1xuICAgICAgICAgICAgY291cG9uQ29kZTogJycgLCAgICAgIC8vIOS8mOaDoOWIuCxcbiAgICAgICAgICAgIGZvcm1JZDogJydcbiAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgICB0aXRsZTogZXJyb3IuZGV0YWlsXG4gICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9LFxuICAgIGNhbmNlbE9yZGVyOiBmdW5jdGlvbiAoZXZlbnQpIHtcblxuICAgICAgbGV0IGRpYWxvZ0NvbXBvbmVudCA9IHRoaXMuZGF0YS5sYXN0Q29tcG9uZW50ID0gdGhpcy5zZWxlY3RDb21wb25lbnQoJy53eGMtY2FuY2VsLW9yZGVyJylcbiAgICAgIGRpYWxvZ0NvbXBvbmVudCAmJiBkaWFsb2dDb21wb25lbnQuc2hvdygpO1xuXG4gICAgICBsZXQgZm9ybUlkID0gZXZlbnQuZGV0YWlsLmZvcm1JZFxuICAgICAgbGV0IG9yZGVySWQgPSBldmVudC5kZXRhaWwudGFyZ2V0LmRhdGFzZXQuaWRcbiAgICAgIGxldCBpbmRleCA9IGV2ZW50LmRldGFpbC50YXJnZXQuZGF0YXNldC5pbmRleFxuICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgZm9ybUlkOiBmb3JtSWQsXG4gICAgICAgIG9yZGVySWQ6IG9yZGVySWQsXG4gICAgICAgIGxhc3RJbmRleDogaW5kZXhcbiAgICAgIH0pXG4gICAgfSxcbiAgICBfcmVhbERheTogZnVuY3Rpb24gKGRheSwgdmFsdWUpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHZhciBfZGF5ID0gZGF5ICsgJyAnICsgdmFsdWVcbiAgICAgICAgX2RheSA9IF9kYXkucmVwbGFjZSgvLS9nLCAnLycpXG4gICAgICAgIGxldCBkYXRlID0gKG5ldyBEYXRlKF9kYXkpKS5nZXRUaW1lKCkgKyAzMCAqIDYwICogMTAwMFxuICAgICAgICBkYXRlID0gKG5ldyBEYXRlKGRhdGUpKVxuICAgICAgICBsZXQgbWludXRlID0gZGF0ZS5nZXRNaW51dGVzKClcbiAgICAgICAgaWYgKG1pbnV0ZS50b1N0cmluZygpLmxlbmd0aCA9PSAxKVxuICAgICAgICAgIG1pbnV0ZSArPSAnMCdcblxuICAgICAgICAvLyBjb25zb2xlLmxvZyh2YWx1ZSlcbiAgICAgICAgLy8gY29uc29sZS5sb2coZGF5KVxuICAgICAgICByZXR1cm4gZGF0ZS5nZXRIb3VycygpICsgJzonICsgbWludXRlICsgJzowMCdcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlXG4gICAgICB9XG4gICAgfVxuXG4gIH0iXX0=