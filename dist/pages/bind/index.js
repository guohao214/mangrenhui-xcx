'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = Page({
  data: {
    '__code__': {
      readme: ''
    },

    phone: '',
    smsCode: '',
    start: false,
    startText: '获取验证码',
    userInfo: ''
  },
  onLoad: function onLoad() {
    var self = this;
    wx.getUserInfo({
      success: function success(res) {
        var user = res.userInfo;
        self.setData({
          userInfo: user
        });
      },
      fail: function fail() {
        wx.openSetting({
          success: function success(res) {
            var authSetting = res.authSetting;
            if (authSetting && authSetting['scope.userInfo'] && authSetting['scope.userInfo'] === true) {
              wx.reLaunch({
                url: '/pages/bind/index'
              });
            }
          }
        });
      }
    });
  },
  handlerPhone: function handlerPhone(event) {
    var value = event.detail.value;
    this.setData({
      phone: value
    });
  },
  handlerSmsCode: function handlerSmsCode(event) {
    var value = event.detail.value;
    this.setData({
      smsCode: value
    });
  },
  login: function login() {
    var app = getApp();
    if (!this.data.smsCode || !/^\d{6}$/.test(this.data.smsCode)) {
      wx.showToast({
        title: '验证码错误',
        icon: 'none'
      });
      return;
    }

    app.get('bind/bindMe', { code: this.data.smsCode, phone: this.data.phone, user_info: this.data.userInfo }).then(function (data) {
      return setTimeout(function () {
        return wx.switchTab({
          url: '/pages/appointment/index'
        });
      }, 500);
    }).catch(function (error) {
      return wx.showToast({
        title: error.detail || '登录失败，请重试',
        icon: 'none'
      });
    });
  },
  sendCode: function sendCode() {
    var _this = this;

    var app = getApp();

    if (!this.data.phone || !/^1\d{10}$/.test(this.data.phone)) {
      wx.showToast({
        title: '手机号格式错误',
        icon: 'none'
      });
      return;
    }

    this.setData({
      start: true
    });

    var intervalCounts = 60;

    this.setData({
      startText: intervalCounts-- + 's'
    });

    var interval = setInterval(function (x) {
      _this.setData({
        startText: intervalCounts-- + 's'
      });

      if (intervalCounts == -1) {
        clearInterval(interval);
        _this.setData({
          start: false,
          startText: '发送验证码'
        });
      }
    }, 1000);

    app.get('sms/send/' + this.data.phone).then(function (data) {
      wx.showToast({ title: '验证码已发送，请注意查收', icon: 'none' });
    }).catch(function (error) {
      return wx.showToast({ title: error.detail || '登录失败，请重试', icon: 'none' });
    });
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4Lnd4cCJdLCJuYW1lcyI6WyJkYXRhIiwicGhvbmUiLCJzbXNDb2RlIiwic3RhcnQiLCJzdGFydFRleHQiLCJ1c2VySW5mbyIsIm9uTG9hZCIsInNlbGYiLCJ3eCIsImdldFVzZXJJbmZvIiwic3VjY2VzcyIsInJlcyIsInVzZXIiLCJzZXREYXRhIiwiZmFpbCIsIm9wZW5TZXR0aW5nIiwiYXV0aFNldHRpbmciLCJyZUxhdW5jaCIsInVybCIsImhhbmRsZXJQaG9uZSIsImV2ZW50IiwidmFsdWUiLCJkZXRhaWwiLCJoYW5kbGVyU21zQ29kZSIsImxvZ2luIiwiYXBwIiwiZ2V0QXBwIiwidGVzdCIsInNob3dUb2FzdCIsInRpdGxlIiwiaWNvbiIsImdldCIsImNvZGUiLCJ1c2VyX2luZm8iLCJ0aGVuIiwic2V0VGltZW91dCIsInN3aXRjaFRhYiIsImNhdGNoIiwiZXJyb3IiLCJzZW5kQ29kZSIsImludGVydmFsQ291bnRzIiwiaW50ZXJ2YWwiLCJzZXRJbnRlcnZhbCIsImNsZWFySW50ZXJ2YWwiXSwibWFwcGluZ3MiOiI7Ozs7OztBQU9JQSxRQUFNO0FBQUE7QUFBQTtBQUFBOztBQUNKQyxXQUFPLEVBREg7QUFFSkMsYUFBUyxFQUZMO0FBR0pDLFdBQU8sS0FISDtBQUlKQyxlQUFXLE9BSlA7QUFLSkMsY0FBVTtBQUxOLEc7QUFPTkMsVUFBUSxrQkFBWTtBQUNsQixRQUFJQyxPQUFPLElBQVg7QUFDQUMsT0FBR0MsV0FBSCxDQUFlO0FBQ2JDLGVBQVMsaUJBQVVDLEdBQVYsRUFBZTtBQUN0QixZQUFJQyxPQUFPRCxJQUFJTixRQUFmO0FBQ0FFLGFBQUtNLE9BQUwsQ0FBYTtBQUNYUixvQkFBVU87QUFEQyxTQUFiO0FBR0QsT0FOWTtBQU9iRSxZQUFNLGdCQUFZO0FBQ2hCTixXQUFHTyxXQUFILENBQWU7QUFDYkwsbUJBQVMsaUJBQVVDLEdBQVYsRUFBZTtBQUN0QixnQkFBSUssY0FBY0wsSUFBSUssV0FBdEI7QUFDQSxnQkFBSUEsZUFBZUEsWUFB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QU0sTUFBMUMsRUFBYixDQUFUO0FBQUEsS0FKVDtBQUtEIiwiZmlsZSI6ImluZGV4Lnd4cCIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IHtcbiAgICBjb25maWc6IHtcbiAgICAgIG5hdmlnYXRpb25CYXJUaXRsZVRleHQ6ICfnu5HlrprmiYvmnLrlj7cnLFxuICAgICAgdXNpbmdDb21wb25lbnRzOiB7XG4gICAgICAgICd3eGMtYXZhdGFyJzogJ0BtaW51aS93eGMtYXZhdGFyJyxcbiAgICAgIH1cbiAgICB9LFxuICAgIGRhdGE6IHtcbiAgICAgIHBob25lOiAnJyxcbiAgICAgIHNtc0NvZGU6ICcnLFxuICAgICAgc3RhcnQ6IGZhbHNlLFxuICAgICAgc3RhcnRUZXh0OiAn6I635Y+W6aqM6K+B56CBJyxcbiAgICAgIHVzZXJJbmZvOiAnJyxcbiAgICB9LFxuICAgIG9uTG9hZDogZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IHNlbGYgPSB0aGlzXG4gICAgICB3eC5nZXRVc2VySW5mbyh7XG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICBsZXQgdXNlciA9IHJlcy51c2VySW5mb1xuICAgICAgICAgIHNlbGYuc2V0RGF0YSh7XG4gICAgICAgICAgICB1c2VySW5mbzogdXNlclxuICAgICAgICAgIH0pXG4gICAgICAgIH0sXG4gICAgICAgIGZhaWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB3eC5vcGVuU2V0dGluZyh7XG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICAgIGxldCBhdXRoU2V0dGluZyA9IHJlcy5hdXRoU2V0dGluZ1xuICAgICAgICAgICAgICBpZiAoYXV0aFNldHRpbmcgJiYgYXV0aFNldHRpbmdbJ3Njb3BlLnVzZXJJbmZvJ10gJiYgYXV0aFNldHRpbmdbJ3Njb3BlLnVzZXJJbmZvJ10gPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICB3eC5yZUxhdW5jaCh7XG4gICAgICAgICAgICAgICAgICB1cmw6ICcvcGFnZXMvYmluZC9pbmRleCdcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9LFxuICAgIGhhbmRsZXJQaG9uZTogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBsZXQgdmFsdWUgPSBldmVudC5kZXRhaWwudmFsdWVcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIHBob25lOiB2YWx1ZVxuICAgICAgfSlcbiAgICB9LFxuICAgIGhhbmRsZXJTbXNDb2RlOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGxldCB2YWx1ZSA9IGV2ZW50LmRldGFpbC52YWx1ZVxuICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgc21zQ29kZTogdmFsdWVcbiAgICAgIH0pXG4gICAgfSxcbiAgICBsb2dpbjogZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IGFwcCA9IGdldEFwcCgpXG4gICAgICBpZiAoIXRoaXMuZGF0YS5zbXNDb2RlIHx8ICEvXlxcZHs2fSQvLnRlc3QodGhpcy5kYXRhLnNtc0NvZGUpKSB7XG4gICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgdGl0bGU6ICfpqozor4HnoIHplJnor68nLFxuICAgICAgICAgIGljb246ICdub25lJ1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuXG4gICAgICB9XG5cbiAgICAgIGFwcC5nZXQoJ2JpbmQvYmluZE1lJywge2NvZGU6IHRoaXMuZGF0YS5zbXNDb2RlLCBwaG9uZTogdGhpcy5kYXRhLnBob25lLCB1c2VyX2luZm86IHRoaXMuZGF0YS51c2VySW5mb30pXG4gICAgICAgIC50aGVuKGRhdGEgPT4gc2V0VGltZW91dCgoKSA9PlxuICAgICAgICAgICAgd3guc3dpdGNoVGFiKHtcbiAgICAgICAgICAgICAgdXJsOiAnL3BhZ2VzL2FwcG9pbnRtZW50L2luZGV4J1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAsIDUwMCkpXG4gICAgICAgIC5jYXRjaChlcnJvciA9PlxuICAgICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgICB0aXRsZTogZXJyb3IuZGV0YWlsIHx8ICfnmbvlvZXlpLHotKXvvIzor7fph43or5UnLFxuICAgICAgICAgICAgaWNvbjogJ25vbmUnXG4gICAgICAgICAgfSkpXG4gICAgfSxcbiAgICBzZW5kQ29kZTogZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IGFwcCA9IGdldEFwcCgpXG5cbiAgICAgIGlmICghdGhpcy5kYXRhLnBob25lIHx8ICEvXjFcXGR7MTB9JC8udGVzdCh0aGlzLmRhdGEucGhvbmUpKSB7XG4gICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgdGl0bGU6ICfmiYvmnLrlj7fmoLzlvI/plJnor68nLFxuICAgICAgICAgIGljb246ICdub25lJ1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuXG4gICAgICB9XG5cbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIHN0YXJ0OiB0cnVlXG4gICAgICB9KVxuXG4gICAgICBsZXQgaW50ZXJ2YWxDb3VudHMgPSA2MFxuXG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICBzdGFydFRleHQ6IGAke2ludGVydmFsQ291bnRzLS19c2BcbiAgICAgIH0pXG5cbiAgICAgIGxldCBpbnRlcnZhbCA9IHNldEludGVydmFsKHggPT4ge1xuICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgIHN0YXJ0VGV4dDogYCR7aW50ZXJ2YWxDb3VudHMtLX1zYFxuICAgICAgICB9KVxuXG4gICAgICAgIGlmIChpbnRlcnZhbENvdW50cyA9PSAtMSkge1xuICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpXG4gICAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICAgIHN0YXJ0OiBmYWxzZSxcbiAgICAgICAgICAgIHN0YXJ0VGV4dDogJ+WPkemAgemqjOivgeeggSdcbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICB9LCAxMDAwKVxuXG4gICAgICBhcHAuZ2V0KGBzbXMvc2VuZC8ke3RoaXMuZGF0YS5waG9uZX1gKVxuICAgICAgICAudGhlbihkYXRhID0+IHtcbiAgICAgICAgICB3eC5zaG93VG9hc3Qoe3RpdGxlOiAn6aqM6K+B56CB5bey5Y+R6YCB77yM6K+35rOo5oSP5p+l5pS2JywgaWNvbjogJ25vbmUnfSlcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGVycm9yID0+IHd4LnNob3dUb2FzdCh7dGl0bGU6IGVycm9yLmRldGFpbCB8fCAn55m75b2V5aSx6LSl77yM6K+36YeN6K+VJywgaWNvbjogJ25vbmUnfSkpXG4gICAgfSxcbiAgfSJdfQ==