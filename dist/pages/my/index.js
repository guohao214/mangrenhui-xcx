'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = Page({
  data: {
    '__code__': {
      readme: ''
    },

    toastText: '',
    showToast: false,
    shopList: [],
    cpShopList: [],
    showShopListPop: 'hide',
    currentShop: {},
    beauticianList: [],
    currentBeautician: {}
  },

  handlerSearch: function handlerSearch(event) {
    var value = event.detail.value;
    var shopList = this.data.shopList;
    var cpShopList = shopList.filter(function (item) {
      return item.shop_name.match(new RegExp(value));
    });

    this.setData({
      cpShopList: cpShopList
    });
  },

  showShopList: function showShopList() {
    this.setData({
      showShopListPop: 'show'
    });
  },

  chooseShop: function chooseShop(event) {
    var index = event.currentTarget.dataset.index;
    var currentShop = this.data.shopList[index];
    this.setData({
      currentShop: currentShop,
      showShopListPop: 'hide'
    });

    this.getBeauticianAndProject(currentShop.shop_id);
  },

  chooseBeautician: function chooseBeautician(event) {
    var app = getApp();
    var _currentBeautician = this.data.currentBeautician;

    var index = event.currentTarget.dataset.index;
    var currentBeautician = this.data.beauticianList[index];
    if (currentBeautician.beautician_id === this.data.currentBeautician.beautician_id) return;

    this.setData({
      currentBeautician: currentBeautician
    });
  },

  _toast: function _toast(text) {
    wx.showToast({
      title: text,
      duration: 2000,
      icon: 'none'
    });
  },


  getBeauticianAndProject: function getBeauticianAndProject(shopId) {
    var app = getApp();
    var self = this;
    app.get('appointment/getBeauticianAndProject/' + shopId).then(function (data) {
      var content = data.data && data.data.content || {};
      var currentBeautician = {};

      var defaultBeautician = (content.defaultBeautician || 0) / 1;
      if (defaultBeautician > 0) {
        currentBeautician = content.beauticians.filter(function (item) {
          return item.beautician_id == defaultBeautician;
        }).pop();
      }

      self.setData({
        beauticianList: content.beauticians,
        currentBeautician: currentBeautician
      });
    }).catch(function (e) {
      console.log(e);
    });
  },

  setBeauticion: function setBeauticion() {
    var app = getApp();

    var beauticianId = this.data.currentBeautician.beautician_id;

    // 设置默认管家
    app.post('center/setBeautician/' + beauticianId).then(function (data) {
      wx.message('专属管家设置成功');
    }).catch(function (e) {
      wx.message('专属管家设置失败，请重试.');
    });
  },


  init: function init() {
    var app = getApp();
    var self = this;

    wx.getLocation({
      complete: function complete(data) {
        if (Object.prototype.toString.call(data) !== '[object Object]') data = {};

        app.get('shop/getList', { latitude: data.latitude || '', longitude: data.longitude || '' }).then(function (data) {
          var result = data.data;
          var currentShop = result.content[0] || {};
          self.setData({
            shopList: result.content,
            cpShopList: result.content
          });

          // 判断shop_id是否存在
          if (self.data.currentShop.shop_id) {
            currentShop = self.data.currentShop;
            self.setData({
              currentShop: currentShop
            });
          } else {
            self.setData({
              currentShop: currentShop
            });
          }

          // self.getPets()

          if (currentShop) self.getBeauticianAndProject(currentShop.shop_id);
        }).catch(function (e) {
          return console.log(e);
        });
      },
      fail: function fail() {
        wx.openSetting({
          success: function success(res) {},
          fail: function fail() {}
        });
      }
    });
  },
  onShow: function onShow() {
    this.init();
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4Lnd4cCJdLCJuYW1lcyI6WyJkYXRhIiwidG9hc3RUZXh0Iiwic2hvd1RvYXN0Iiwic2hvcExpc3QiLCJjcFNob3BMaXN0Iiwic2hvd1Nob3BMaXN0UG9wIiwiY3VycmVudFNob3AiLCJiZWF1dGljaWFuTGlzdCIsImN1cnJlbnRCZWF1dGljaWFuIiwiaGFuZGxlclNlYXJjaCIsImV2ZW50IiwidmFsdWUiLCJkZXRhaWwiLCJmaWx0ZXIiLCJpdGVtIiwic2hvcF9uYW1lIiwibWF0Y2giLCJSZWdFeHAiLCJzZXREYXRhIiwic2hvd1Nob3BMaXN0IiwiY2hvb3NlU2hvcCIsImluZGV4IiwiY3VycmVudFRhcmdldCIsImRhdGFzZXQiLCJnZXRCZWF1dGljaWFuQW5kUHJvamVjdCIsInNob3BfaWQiLCJjaG9vc2VCZWF1dGljaWFuIiwiYXBwIiwiZ2V0QXBwIiwiX2N1cnJlbnRCZWF1dGljaWFuIiwiYmVhdXRpY2lhbl9pZCIsIl90b2FzdCIsInRleHQiLCJ3eCIsInRpdGxlIiwiZHVyYXRpb24iLCJpY29uIiwic2hvcElkIiwic2VsZiIsImdldCIsInRoZW4iLCJjb250ZW50IiwiZGVmYXVsdEJlYXV0aWNpYW4iLCJiZWF1dGljaWFucyIsInBvcCIsImNhdGNoIiwiY29uc29sZSIsImxvZyIsImUiLCJzZXRCZWF1dGljaW9uIiwiYmVhdXRpY2lhbklkIiwicG9zdCIsIm1lc3NhZ2UiLCJpbml0IiwiZ2V0TG9jYXRpb24iLCJjb21wbGV0ZSIsIk9iamVjdCIsInByb3RvdHlwZSIsInRvU3RyaW5nIiwiY2FsbCIsImxhdGl0dWRlIiwibG9uZ2l0dWRlIiwicmVzdWx0IiwiZmFpbCIsIm9wZW5TZXR0aW5nIiwic3VjY2VzcyIsInJlcyIsIm9uU2hvdyJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBY0lBLFFBQU07QUFBQTtBQUFBO0FBQUE7O0FBQ0pDLGVBQVcsRUFEUDtBQUVKQyxlQUFXLEtBRlA7QUFHSkMsY0FBVSxFQUhOO0FBSUpDLGdCQUFZLEVBSlI7QUFL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LENBQWE7QUFDWFo7QUFEVyxhQUFiO0FBR0Q7O0FBRUQ7O0FBRUEsY0FBSUEsV0FBSixFQUNFZ0MsS0FBS2QsdUJBQUwsQ0FBNkJsQixZQUFZbUIsT0FBekM7QUFDSCxTQXhCRCxFQXdCR29CLEtBeEJILENBd0JTO0FBQUEsaUJBQUtDLFFBQVFDLEdBQVIsQ0FBWUMsQ0FBWixDQUFMO0FBQUEsU0F4QlQ7QUF5QkQsT0E5Qlk7QUErQmJlLFlBQU0sZ0JBQVk7QUFDaEI5QixXQUFHK0IsV0FBSCxDQUFlO0FBQ2JDLG1CQUFTLGlCQUFVQyxHQUFWLEVBQWUsQ0FDdkIsQ0FGWTtBQUdiSCxnQkFBTSxnQkFBWSxDQUNqQjtBQUpZLFNBQWY7QUFNRDtBQXRDWSxLQUFmO0FBd0NILEc7QUFDREksUSxvQkFBUztBQUNQLFNBQUtkLElBQUw7QUFDRCIsImZpbGUiOiJpbmRleC53eHAiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCB7XG4gICAgY29uZmlnOiB7XG4gICAgICBuYXZpZ2F0aW9uQmFyVGl0bGVUZXh0OiAn5oiR55qE566h5a62JyxcbiAgICAgIG5hdmlnYXRpb25CYXJCYWNrZ3JvdW5kQ29sb3I6ICcjRThFOEU4JyxcbiAgICAgIG5hdmlnYXRpb25CYXJUZXh0U3R5bGU6ICdibGFjaycsXG4gICAgICB1c2luZ0NvbXBvbmVudHM6IHtcbiAgICAgICAgJ3d4Yy1mbGV4JzogJ0BtaW51aS93eGMtZmxleCcsXG4gICAgICAgICd3eGMtaWNvbic6ICdAbWludWkvd3hjLWljb24nLFxuICAgICAgICAnd3hjLWF2YXRhcic6ICdAbWludWkvd3hjLWF2YXRhcicsXG4gICAgICAgICd3eGMtbWFzayc6ICdAbWludWkvd3hjLW1hc2snLFxuICAgICAgICAnd3hjLXBvcHVwJzogJ0BtaW51aS93eGMtcG9wdXAnLFxuICAgICAgICAnd3hjLWVsaXAnOiAnQG1pbnVpL3d4Yy1lbGlwJyxcbiAgICAgIH1cbiAgICB9LFxuICAgIGRhdGE6IHtcbiAgICAgIHRvYXN0VGV4dDogJycsXG4gICAgICBzaG93VG9hc3Q6IGZhbHNlLFxuICAgICAgc2hvcExpc3Q6IFtdLFxuICAgICAgY3BTaG9wTGlzdDogW10sXG4gICAgICBzaG93U2hvcExpc3RQb3A6ICdoaWRlJyxcbiAgICAgIGN1cnJlbnRTaG9wOiB7fSxcbiAgICAgIGJlYXV0aWNpYW5MaXN0OiBbXSxcbiAgICAgIGN1cnJlbnRCZWF1dGljaWFuOiB7fSxcbiAgICB9LFxuXG4gICAgaGFuZGxlclNlYXJjaDogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBsZXQgdmFsdWUgPSBldmVudC5kZXRhaWwudmFsdWVcbiAgICAgIGxldCBzaG9wTGlzdCA9IHRoaXMuZGF0YS5zaG9wTGlzdFxuICAgICAgbGV0IGNwU2hvcExpc3QgPSBzaG9wTGlzdC5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgcmV0dXJuIGl0ZW0uc2hvcF9uYW1lLm1hdGNoKG5ldyBSZWdFeHAodmFsdWUpKVxuICAgICAgfSlcblxuICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgY3BTaG9wTGlzdDogY3BTaG9wTGlzdFxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgc2hvd1Nob3BMaXN0OiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICBzaG93U2hvcExpc3RQb3A6ICdzaG93J1xuICAgICAgfSlcbiAgICB9LFxuXG4gICAgY2hvb3NlU2hvcDogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBsZXQgaW5kZXggPSBldmVudC5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaW5kZXhcbiAgICAgIGxldCBjdXJyZW50U2hvcCA9IHRoaXMuZGF0YS5zaG9wTGlzdFtpbmRleF1cbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIGN1cnJlbnRTaG9wOiBjdXJyZW50U2hvcCxcbiAgICAgICAgc2hvd1Nob3BMaXN0UG9wOiAnaGlkZScsXG4gICAgICB9KVxuXG4gICAgICB0aGlzLmdldEJlYXV0aWNpYW5BbmRQcm9qZWN0KGN1cnJlbnRTaG9wLnNob3BfaWQpXG4gICAgfSxcblxuICAgIGNob29zZUJlYXV0aWNpYW46IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgbGV0IGFwcCA9IGdldEFwcCgpXG4gICAgICBsZXQgX2N1cnJlbnRCZWF1dGljaWFuID0gdGhpcy5kYXRhLmN1cnJlbnRCZWF1dGljaWFuXG5cbiAgICAgIGxldCBpbmRleCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pbmRleFxuICAgICAgbGV0IGN1cnJlbnRCZWF1dGljaWFuID0gdGhpcy5kYXRhLmJlYXV0aWNpYW5MaXN0W2luZGV4XVxuICAgICAgaWYgKGN1cnJlbnRCZWF1dGljaWFuLmJlYXV0aWNpYW5faWQgPT09IHRoaXMuZGF0YS5jdXJyZW50QmVhdXRpY2lhbi5iZWF1dGljaWFuX2lkKVxuICAgICAgICByZXR1cm5cblxuICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgY3VycmVudEJlYXV0aWNpYW46IGN1cnJlbnRCZWF1dGljaWFuLFxuICAgICAgfSlcblxuICAgICBcbiAgICB9LFxuXG4gICAgX3RvYXN0KHRleHQpIHtcbiAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgIHRpdGxlOiB0ZXh0LFxuICAgICAgICBkdXJhdGlvbjogMjAwMCxcbiAgICAgICAgaWNvbjogJ25vbmUnXG4gICAgICB9KVxuICAgIH0sXG5cbiAgICBnZXRCZWF1dGljaWFuQW5kUHJvamVjdDogZnVuY3Rpb24gKHNob3BJZCkge1xuICAgICAgbGV0IGFwcCA9IGdldEFwcCgpXG4gICAgICBsZXQgc2VsZiA9IHRoaXNcbiAgICAgIGFwcC5nZXQoYGFwcG9pbnRtZW50L2dldEJlYXV0aWNpYW5BbmRQcm9qZWN0LyR7c2hvcElkfWApLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgIGxldCBjb250ZW50ID0gKGRhdGEuZGF0YSAmJiBkYXRhLmRhdGEuY29udGVudCkgfHwge31cbiAgICAgICAgbGV0IGN1cnJlbnRCZWF1dGljaWFuID0ge31cblxuICAgICAgICBsZXQgZGVmYXVsdEJlYXV0aWNpYW4gPSAoY29udGVudC5kZWZhdWx0QmVhdXRpY2lhbiB8fCAwKSAvIDFcbiAgICAgICAgaWYgKGRlZmF1bHRCZWF1dGljaWFuID4gMCkge1xuICAgICAgICAgIGN1cnJlbnRCZWF1dGljaWFuID0gY29udGVudC5iZWF1dGljaWFucy5maWx0ZXIoaXRlbSA9PiBpdGVtLmJlYXV0aWNpYW5faWQgPT0gZGVmYXVsdEJlYXV0aWNpYW4pLnBvcCgpXG4gICAgICAgIH1cblxuICAgICAgICBzZWxmLnNldERhdGEoe1xuICAgICAgICAgIGJlYXV0aWNpYW5MaXN0OiBjb250ZW50LmJlYXV0aWNpYW5zLFxuICAgICAgICAgIGN1cnJlbnRCZWF1dGljaWFuLFxuICAgICAgICB9KVxuXG5cbiAgICAgIH0pLmNhdGNoKGUgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhlKVxuICAgICAgfSlcblxuICAgIH0sXG5cblxuICAgIHNldEJlYXV0aWNpb24oKSB7XG4gICAgICBsZXQgYXBwID0gZ2V0QXBwKClcblxuICAgICAgbGV0IGJlYXV0aWNpYW5JZCA9IHRoaXMuZGF0YS5jdXJyZW50QmVhdXRpY2lhbi5iZWF1dGljaWFuX2lkXG5cbiAgICAgICAgLy8g6K6+572u6buY6K6k566h5a62XG4gICAgICAgIGFwcC5wb3N0KCdjZW50ZXIvc2V0QmVhdXRpY2lhbi8nICsgYmVhdXRpY2lhbklkKS50aGVuKGRhdGEgPT4ge1xuICAgICAgICAgIHd4Lm1lc3NhZ2UoJ+S4k+WxnueuoeWutuiuvue9ruaIkOWKnycpXG4gICAgICAgIH0pLmNhdGNoKGUgPT4ge1xuICAgICAgICAgIHd4Lm1lc3NhZ2UoJ+S4k+WxnueuoeWutuiuvue9ruWksei0pe+8jOivt+mHjeivlS4nKVxuICAgICAgICB9KVxuICAgIH0sXG5cblxuICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgIGxldCBhcHAgPSBnZXRBcHAoKVxuICAgICAgbGV0IHNlbGYgPSB0aGlzXG5cbiAgICBcbiAgICAgIHd4LmdldExvY2F0aW9uKHtcbiAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChkYXRhKSAhPT0gJ1tvYmplY3QgT2JqZWN0XScpXG4gICAgICAgICAgICBkYXRhID0ge31cblxuICAgICAgICAgIGFwcC5nZXQoJ3Nob3AvZ2V0TGlzdCcsIHtsYXRpdHVkZTogZGF0YS5sYXRpdHVkZSB8fCAnJywgbG9uZ2l0dWRlOiBkYXRhLmxvbmdpdHVkZSB8fCAnJ30pLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gZGF0YS5kYXRhXG4gICAgICAgICAgICBsZXQgY3VycmVudFNob3AgPSByZXN1bHQuY29udGVudFswXSB8fCB7fVxuICAgICAgICAgICAgc2VsZi5zZXREYXRhKHtcbiAgICAgICAgICAgICAgc2hvcExpc3Q6IHJlc3VsdC5jb250ZW50LFxuICAgICAgICAgICAgICBjcFNob3BMaXN0OiByZXN1bHQuY29udGVudCxcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIC8vIOWIpOaWrXNob3BfaWTmmK/lkKblrZjlnKhcbiAgICAgICAgICAgIGlmKHNlbGYuZGF0YS5jdXJyZW50U2hvcC5zaG9wX2lkKSB7XG4gICAgICAgICAgICAgIGN1cnJlbnRTaG9wID0gc2VsZi5kYXRhLmN1cnJlbnRTaG9wXG4gICAgICAgICAgICAgIHNlbGYuc2V0RGF0YSh7XG4gICAgICAgICAgICAgICAgY3VycmVudFNob3BcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHNlbGYuc2V0RGF0YSh7XG4gICAgICAgICAgICAgICAgY3VycmVudFNob3BcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gc2VsZi5nZXRQZXRzKClcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKGN1cnJlbnRTaG9wKVxuICAgICAgICAgICAgICBzZWxmLmdldEJlYXV0aWNpYW5BbmRQcm9qZWN0KGN1cnJlbnRTaG9wLnNob3BfaWQpXG4gICAgICAgICAgfSkuY2F0Y2goZSA9PiBjb25zb2xlLmxvZyhlKSlcbiAgICAgICAgfSxcbiAgICAgICAgZmFpbDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHd4Lm9wZW5TZXR0aW5nKHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmYWlsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgfSlcbiAgfSxcbiAgb25TaG93KCkge1xuICAgIHRoaXMuaW5pdCgpXG4gIH0sXG4gIH0iXX0=