'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = Page({
  data: {
    '__code__': {
      readme: ''
    },

    toastText: '',
    showToast: false,
    shopList: [],
    cpShopList: [],
    showShopListPop: 'hide',
    currentShop: {},
    beauticianList: [],
    currentBeautician: {},
    projectList: [],
    currentProject: {},
    appointmentDayList: [],
    currentAppointmentDay: '',
    appointmentTimeList: [],
    currentAppointmentTimes: [] // 预约的时间
  },
  handlerSearch: function handlerSearch(event) {
    var value = event.detail.value;
    var shopList = this.data.shopList;
    var cpShopList = shopList.filter(function (item) {
      return item.shop_name.match(new RegExp(value));
    });

    this.setData({
      cpShopList: cpShopList
    });
  },
  showShopList: function showShopList() {
    this.setData({
      showShopListPop: 'show'
    });
  },
  chooseShop: function chooseShop(event) {
    var index = event.currentTarget.dataset.index;
    var currentShop = this.data.shopList[index];
    this.setData({
      currentShop: currentShop,
      showShopListPop: 'hide'
    });

    this.getBeauticianAndProject(currentShop.shop_id);
  },
  chooseProject: function chooseProject(event) {
    var index = event.currentTarget.dataset.index;
    var currentProject = this.data.projectList[index];
    this.setData({
      currentProject: currentProject
    });

    var timeList = this.data.appointmentTimeList;
    timeList.forEach(function (item) {
      return item.checked = false;
    });
    this.setData({
      currentAppointmentTimes: [],
      appointmentTimeList: timeList
    });
  },
  chooseBeautician: function chooseBeautician(event) {
    var index = event.currentTarget.dataset.index;
    var currentBeautician = this.data.beauticianList[index];
    if (currentBeautician.beautician_id === this.data.currentBeautician.beautician_id) return;

    this.setData({
      currentBeautician: currentBeautician
    });

    var beauticianId = currentBeautician.beautician_id;
    var day = this.data.currentAppointmentDay.day;
    this.getAppointmentTimes(beauticianId, day);
  },
  chooseDay: function chooseDay(event) {
    var index = event.currentTarget.dataset.index;
    var currentAppointmentDay = this.data.appointmentDayList[index];

    if (currentAppointmentDay.day === this.data.currentAppointmentDay.day) return;

    this.setData({
      currentAppointmentDay: currentAppointmentDay
    });

    var beauticianId = this.data.currentBeautician.beautician_id;
    var day = currentAppointmentDay.day;
    this.getAppointmentTimes(beauticianId, day);
  },
  _toast: function _toast(text) {
    wx.showToast({
      title: text,
      duration: 2000,
      icon: 'none'
    });
  },

  chooseTime: function chooseTime(event) {
    var everyTime = 30;
    var index = event.currentTarget.dataset.index;
    var time = this.data.appointmentTimeList[index];
    if (!time.valid) return false;

    var timeList = this.data.appointmentTimeList;
    timeList.forEach(function (item) {
      return item.checked = false;
    });

    var projectUseTime = this.data.currentProject.use_time;
    var useTimeNum = Math.ceil(projectUseTime / everyTime);
    var timeListLength = this.data.appointmentTimeList.length;
    if (index + useTimeNum > timeListLength) {
      this.setData({
        currentAppointmentTimes: [],
        appointmentTimeList: timeList
      });

      this._toast('预约时间不足');

      return;
    }
    var start = 0;
    var useTime = [];
    while (start < useTimeNum) {
      var item = timeList[index + start++];
      if (!item.valid) {
        timeList.forEach(function (item) {
          return item.checked = false;
        });
        useTime = [];
        this.setData({
          currentAppointmentTimes: useTime,
          appointmentTimeList: timeList
        });
        this._toast('预约时间不足');
        break;
      }
      item.checked = true;
      useTime.push(item.time);
    }

    this.setData({
      currentAppointmentTimes: useTime,
      appointmentTimeList: timeList
    });
  },

  getBeauticianAndProject: function getBeauticianAndProject(shopId) {
    var app = getApp();
    var self = this;
    app.get('appointment/getBeauticianAndProject/' + shopId).then(function (data) {
      var content = data.data && data.data.content || {};

      content.days = content.days.map(function (item) {
        var day = item.split('#');
        return {
          date: day[0],
          week: day[1],
          day: day[2]
        };
      });

      var currentProject = content.projects[0] || {};
      var currentBeautician = content.beauticians[0] || {};
      var currentAppointmentDay = content.days[0] || {};

      self.setData({
        beauticianList: content.beauticians,
        projectList: content.projects,
        appointmentDayList: content.days,
        currentProject: currentProject,
        currentBeautician: currentBeautician,
        currentAppointmentDay: currentAppointmentDay
      });

      self.getAppointmentTimes(currentBeautician.beautician_id, currentAppointmentDay.day);
    }).catch(function (e) {
      console.log(e);
    });
  },

  getAppointmentTimes: function getAppointmentTimes(beauticianId, day) {
    var app = getApp();
    var self = this;
    this.setData({
      currentAppointmentTimes: []
    });

    app.get('appointment/getAppointmentTime/' + beauticianId + '/' + day).then(function (data) {
      var content = data.data && data.data.content || [];
      // for (var i in [0, 0, 0, 0])
      //   content.push({})

      self.setData({
        appointmentTimeList: content
      });
    });
  },

  appointment: function appointment(event) {
    var _this = this;

    var app = getApp();
    var formId = event.detail.formId;

    // 预约
    var data = {
      shop_id: this.data.currentShop.shop_id,
      beautician_id: this.data.currentBeautician.beautician_id,
      project_id: this.data.currentProject.project_id,
      appointment_day: this.data.currentAppointmentDay.day,
      appointment_time: this.data.currentAppointmentTimes.join(','),
      from: 'xcx',
      formId: formId
    };
    app.post('cart/appointment', data).then(function () {
      _this._toast('预约成功!');
      setTimeout(function (x) {
        return _this.getAppointmentTimes(data.beautician_id, data.appointment_day);
      }, 1000);
    }).catch(function (error) {
      _this._toast(error.detail || '预约失败!');
    });
  },

  init: function init() {
    var app = getApp();
    var self = this;

    wx.getLocation({
      success: function success(data) {
        var _this2 = this;

        app.get('shop/getList', { latitude: data.latitude, longitude: data.longitude }).then(function (data) {
          var result = data.data;
          var currentShop = result.content[0] || {};
          self.setData({
            shopList: result.content,
            cpShopList: result.content
          });

          // 判断shop_id是否存在
          if (self.data.currentShop.shop_id) {
            currentShop = _this2.data.currentShop;
            self.setData({
              currentShop: currentShop
            });
          } else {
            self.setData({
              currentShop: currentShop
            });
          }

          if (currentShop) self.getBeauticianAndProject(currentShop.shop_id);
        }).catch(function (e) {
          return console.log(e);
        });
      },
      fail: function fail() {
        wx.openSetting({
          success: function success(res) {},
          fail: function fail() {}
        });
      }
    });
  },

  onLoad: function onLoad() {
    this.init();
  },

  onTabItemTap: function onTabItemTap() {
    this.init();
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4Lnd4cCJdLCJuYW1lcyI6WyJkYXRhIiwidG9hc3RUZXh0Iiwic2hvd1RvYXN0Iiwic2hvcExpc3QiLCJjcFNob3BMaXN0Iiwic2hvd1Nob3BMaXN0UG9wIiwiY3VycmVudFNob3AiLCJiZWF1dGljaWFuTGlzdCIsImN1cnJlbnRCZWF1dGljaWFuIiwicHJvamVjdExpc3QiLCJjdXJyZW50UHJvamVjdCIsImFwcG9pbnRtZW50RGF5TGlzdCIsImN1cnJlbnRBcHBvaW50bWVudERheSIsImFwcG9pbnRtZW50VGltZUxpc3QiLCJjdXJyZW50QXBwb2ludG1lbnRUaW1lcyIsImhhbmRsZXJTZWFyY2giLCJldmVudCIsInZhbHVlIiwiZGV0YWlsIiwiZmlsdGVyIiwiaXRlbSIsInNob3BfbmFtZSIsIm1hdGNoIiwiUmVnRXhwIiwic2V0RGF0YSIsInNob3dTaG9wTGlzdCIsImNob29zZVNob3AiLCJpbmRleCIsImN1cnJlbnRUYXJnZXQiLCJkYXRhc2V0IiwiZ2V0QmVhdXRpY2lhbkFuZFByb2plY3QiLCJzaG9wX2lkIiwiY2hvb3NlUHJvamVjdCIsInRpbWVMaXN0IiwiZm9yRWFjaCIsImNoZWNrZWQiLCJjaG9vc2VCZWF1dGljaWFuIiwiYmVhdXRpY2lhbl9pZCIsImJlYXV0aWNpYW5JZCIsImRheSIsImdldEFwcG9pbnRtZW50VGltZXMiLCJjaG9vc2VEYXkiLCJfdG9hc3QiLCJ0ZXh0Iiwid3giLCJ0aXRsZSIsImR1cmF0aW9uIiwiaWNvbiIsImNob29zZVRpbWUiLCJldmVyeVRpbWUiLCJ0aW1lIiwidmFsaWQiLCJwcm9qZWN0VXNlVGltZSIsInVzZV90aW1lIiwidXNlVGltZU51bSIsIk1hdGgiLCJjZWlsIiwidGltZUxpc3RMZW5ndGgiLCJsZW5ndGgiLCJzdGFydCIsInVzZVRpbWUiLCJwdXNoIiwic2hvcElkIiwiYXBwIiwiZ2V0QXBwIiwic2VsZiIsImdldCIsInRoZW4iLCJjb250ZW50IiwiZGF5cyIsIm1hcCIsInNwbGl0IiwiZGF0ZSIsIndlZWsiLCJwcm9qZWN0cyIsImJlYXV0aWNpYW5zIiwiY2F0Y2giLCJjb25zb2xlIiwibG9nIiwiZSIsImFwcG9pbnRtZW50IiwiZm9ybUlkIiwicHJvamVjdF9pZCIsImFwcG9pbnRtZW50X2RheSIsImFwcG9pbnRtZW50X3RpbWUiLCJqb2luIiwiZnJvbSIsInBvc3QiLCJzZXRUaW1lb3V0IiwiZXJyb3IiLCJpbml0IiwiZ2V0TG9jYXRpb24iLCJzdWNjZXNzIiwibGF0aXR1ZGUiLCJsb25naXR1ZGUiLCJyZXN1bHQiLCJmYWlsIiwib3BlblNldHRpbmciLCJyZXMiLCJvbkxvYWQiLCJvblRhYkl0ZW1UYXAiXSwibWFwcGluZ3MiOiI7Ozs7OztBQWFJQSxRQUFNO0FBQUE7QUFBQTtBQUFBOztBQUNKQyxlQUFXLEVBRFA7QUFFSkMsZUFBVyxLQUZQO0FBR0pDLGNBQVUsRUFITjtBQUlKQyxnQkFBWSxFQUpSO0FBS0pDLHFCQUFpQixNQUxiO0FBTUpDLGlCQUFhLEVBTlQ7QUFPSkMsb0JBQWdCLEVBUFo7QUFRSkMsdUJBQW1CLEVBUmY7QUFTSkMsaUJBQWEsRUFUVDtBQVVKQyxvQkFBZ0IsRUFWWjtBQVdKQyx3QkFBb0IsRUFYaEI7QUFZSkMsMkJBQXVCLEVBWm5CO0FBYUpDLHlCQUFxQixFQWJqQjtBQWNKQyw2QkFBeUIsRUFkckIsQ0FjeUI7QUFkekIsRztBQWdCTkMsaUJBQWUsdUJBQVVDLEtBQVYsRUFBaUI7QUFDOUIsUUFBSUMsUUFBUUQsTUFBTUUsTUFBTixDQUFhRCxLQUF6QjtBQUNBLFFBQUlkLFdBQVcsS0FBS0gsSUFBTCxDQUFVRyxRQUF6QjtBQUNBLFFBQUlDLGFBQWFELFNBQVNnQixNQUFULENBQWdCLFVBQVVDLElBQVYsRUFBZ0I7QUFDL0MsYUFBT0EsS0FBS0MsU0FBTCxDQUFlQyxLQUFmLENBQXFCLElBQUlDLE1BQUosQ0FBV04sS0FBWCxDQUFyQixDQUFQO0FBQ0QsS0FGZ0IsQ0FBakI7O0FBSUEsU0FBS08sT0FBTCxDQUFhO0FBQ1hwQixrQkFBWUE7QUFERCxLQUFiO0FBR0Qs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LENBQTZCeEIsWUFBWXlCLE9BQXpDO0FBQ0gsU0F0QkQsRUFzQkc2QyxLQXRCSCxDQXNCUztBQUFBLGlCQUFLQyxRQUFRQyxHQUFSLENBQVlDLENBQVosQ0FBTDtBQUFBLFNBdEJUO0FBdUJELE9BekJZO0FBMEJiaUIsWUFBTSxnQkFBWTtBQUNoQnBELFdBQUdxRCxXQUFILENBQWU7QUFDYkwsbUJBQVMsaUJBQVVNLEdBQVYsRUFBZSxDQUN2QixDQUZZO0FBR2JGLGdCQUFNLGdCQUFZLENBQ2pCO0FBSlksU0FBZjtBQU1EO0FBakNZLEtBQWY7QUFtQ0QsRzs7QUFFSEcsVUFBUSxrQkFBWTtBQUNsQixTQUFLVCxJQUFMO0FBQ0QsRzs7QUFFRFUsZ0JBQWMsd0JBQVc7QUFDdkIsU0FBS1YsSUFBTDtBQUNEIiwiZmlsZSI6ImluZGV4Lnd4cCIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IHtcbiAgICBjb25maWc6IHtcbiAgICAgIG5hdmlnYXRpb25CYXJUaXRsZVRleHQ6ICfpooTnuqYnLFxuICAgICAgbmF2aWdhdGlvbkJhckJhY2tncm91bmRDb2xvcjogJyNGRkRDRTQnLFxuICAgICAgdXNpbmdDb21wb25lbnRzOiB7XG4gICAgICAgICd3eGMtZmxleCc6ICdAbWludWkvd3hjLWZsZXgnLFxuICAgICAgICAnd3hjLWljb24nOiAnQG1pbnVpL3d4Yy1pY29uJyxcbiAgICAgICAgJ3d4Yy1hdmF0YXInOiAnQG1pbnVpL3d4Yy1hdmF0YXInLFxuICAgICAgICAnd3hjLW1hc2snOiAnQG1pbnVpL3d4Yy1tYXNrJyxcbiAgICAgICAgJ3d4Yy1wb3B1cCc6ICdAbWludWkvd3hjLXBvcHVwJyxcbiAgICAgICAgJ3d4Yy1lbGlwJzogJ0BtaW51aS93eGMtZWxpcCcsXG4gICAgICB9XG4gICAgfSxcbiAgICBkYXRhOiB7XG4gICAgICB0b2FzdFRleHQ6ICcnLFxuICAgICAgc2hvd1RvYXN0OiBmYWxzZSxcbiAgICAgIHNob3BMaXN0OiBbXSxcbiAgICAgIGNwU2hvcExpc3Q6IFtdLFxuICAgICAgc2hvd1Nob3BMaXN0UG9wOiAnaGlkZScsXG4gICAgICBjdXJyZW50U2hvcDoge30sXG4gICAgICBiZWF1dGljaWFuTGlzdDogW10sXG4gICAgICBjdXJyZW50QmVhdXRpY2lhbjoge30sXG4gICAgICBwcm9qZWN0TGlzdDogW10sXG4gICAgICBjdXJyZW50UHJvamVjdDoge30sXG4gICAgICBhcHBvaW50bWVudERheUxpc3Q6IFtdLFxuICAgICAgY3VycmVudEFwcG9pbnRtZW50RGF5OiAnJyxcbiAgICAgIGFwcG9pbnRtZW50VGltZUxpc3Q6IFtdLFxuICAgICAgY3VycmVudEFwcG9pbnRtZW50VGltZXM6IFtdLCAvLyDpooTnuqbnmoTml7bpl7RcbiAgICB9LFxuICAgIGhhbmRsZXJTZWFyY2g6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgbGV0IHZhbHVlID0gZXZlbnQuZGV0YWlsLnZhbHVlXG4gICAgICBsZXQgc2hvcExpc3QgPSB0aGlzLmRhdGEuc2hvcExpc3RcbiAgICAgIGxldCBjcFNob3BMaXN0ID0gc2hvcExpc3QuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIHJldHVybiBpdGVtLnNob3BfbmFtZS5tYXRjaChuZXcgUmVnRXhwKHZhbHVlKSlcbiAgICAgIH0pXG5cbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIGNwU2hvcExpc3Q6IGNwU2hvcExpc3RcbiAgICAgIH0pXG4gICAgfSxcbiAgICBzaG93U2hvcExpc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIHNob3dTaG9wTGlzdFBvcDogJ3Nob3cnXG4gICAgICB9KVxuICAgIH0sXG4gICAgY2hvb3NlU2hvcDogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBsZXQgaW5kZXggPSBldmVudC5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaW5kZXhcbiAgICAgIGxldCBjdXJyZW50U2hvcCA9IHRoaXMuZGF0YS5zaG9wTGlzdFtpbmRleF1cbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIGN1cnJlbnRTaG9wOiBjdXJyZW50U2hvcCxcbiAgICAgICAgc2hvd1Nob3BMaXN0UG9wOiAnaGlkZScsXG4gICAgICB9KVxuXG4gICAgICB0aGlzLmdldEJlYXV0aWNpYW5BbmRQcm9qZWN0KGN1cnJlbnRTaG9wLnNob3BfaWQpXG4gICAgfSxcbiAgICBjaG9vc2VQcm9qZWN0OiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGxldCBpbmRleCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pbmRleFxuICAgICAgbGV0IGN1cnJlbnRQcm9qZWN0ID0gdGhpcy5kYXRhLnByb2plY3RMaXN0W2luZGV4XVxuICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgY3VycmVudFByb2plY3Q6IGN1cnJlbnRQcm9qZWN0LFxuICAgICAgfSlcblxuICAgICAgbGV0IHRpbWVMaXN0ID0gdGhpcy5kYXRhLmFwcG9pbnRtZW50VGltZUxpc3RcbiAgICAgIHRpbWVMaXN0LmZvckVhY2goaXRlbSA9PiBpdGVtLmNoZWNrZWQgPSBmYWxzZSlcbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIGN1cnJlbnRBcHBvaW50bWVudFRpbWVzOiBbXSxcbiAgICAgICAgYXBwb2ludG1lbnRUaW1lTGlzdDogdGltZUxpc3RcbiAgICAgIH0pXG4gICAgfSxcbiAgICBjaG9vc2VCZWF1dGljaWFuOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGxldCBpbmRleCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pbmRleFxuICAgICAgbGV0IGN1cnJlbnRCZWF1dGljaWFuID0gdGhpcy5kYXRhLmJlYXV0aWNpYW5MaXN0W2luZGV4XVxuICAgICAgaWYgKGN1cnJlbnRCZWF1dGljaWFuLmJlYXV0aWNpYW5faWQgPT09IHRoaXMuZGF0YS5jdXJyZW50QmVhdXRpY2lhbi5iZWF1dGljaWFuX2lkKVxuICAgICAgICByZXR1cm5cblxuICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgY3VycmVudEJlYXV0aWNpYW46IGN1cnJlbnRCZWF1dGljaWFuLFxuICAgICAgfSlcblxuICAgICAgbGV0IGJlYXV0aWNpYW5JZCA9IGN1cnJlbnRCZWF1dGljaWFuLmJlYXV0aWNpYW5faWRcbiAgICAgIGxldCBkYXkgPSB0aGlzLmRhdGEuY3VycmVudEFwcG9pbnRtZW50RGF5LmRheVxuICAgICAgdGhpcy5nZXRBcHBvaW50bWVudFRpbWVzKGJlYXV0aWNpYW5JZCwgZGF5KVxuICAgIH0sXG4gICAgY2hvb3NlRGF5OiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGxldCBpbmRleCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pbmRleFxuICAgICAgbGV0IGN1cnJlbnRBcHBvaW50bWVudERheSA9IHRoaXMuZGF0YS5hcHBvaW50bWVudERheUxpc3RbaW5kZXhdXG5cbiAgICAgIGlmIChjdXJyZW50QXBwb2ludG1lbnREYXkuZGF5ID09PSB0aGlzLmRhdGEuY3VycmVudEFwcG9pbnRtZW50RGF5LmRheSlcbiAgICAgICAgcmV0dXJuXG5cbiAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgIGN1cnJlbnRBcHBvaW50bWVudERheTogY3VycmVudEFwcG9pbnRtZW50RGF5LFxuICAgICAgfSlcblxuICAgICAgbGV0IGJlYXV0aWNpYW5JZCA9IHRoaXMuZGF0YS5jdXJyZW50QmVhdXRpY2lhbi5iZWF1dGljaWFuX2lkXG4gICAgICBsZXQgZGF5ID0gY3VycmVudEFwcG9pbnRtZW50RGF5LmRheVxuICAgICAgdGhpcy5nZXRBcHBvaW50bWVudFRpbWVzKGJlYXV0aWNpYW5JZCwgZGF5KVxuICAgIH0sXG4gICAgX3RvYXN0KHRleHQpIHtcbiAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgIHRpdGxlOiB0ZXh0LFxuICAgICAgICBkdXJhdGlvbjogMjAwMCxcbiAgICAgICAgaWNvbjogJ25vbmUnXG4gICAgICB9KVxuICAgIH0sXG4gICAgY2hvb3NlVGltZTogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBsZXQgZXZlcnlUaW1lID0gMzBcbiAgICAgIGxldCBpbmRleCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pbmRleFxuICAgICAgbGV0IHRpbWUgPSB0aGlzLmRhdGEuYXBwb2ludG1lbnRUaW1lTGlzdFtpbmRleF1cbiAgICAgIGlmICghdGltZS52YWxpZClcbiAgICAgICAgcmV0dXJuIGZhbHNlXG5cbiAgICAgIGxldCB0aW1lTGlzdCA9IHRoaXMuZGF0YS5hcHBvaW50bWVudFRpbWVMaXN0XG4gICAgICB0aW1lTGlzdC5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5jaGVja2VkID0gZmFsc2UpXG5cbiAgICAgIGxldCBwcm9qZWN0VXNlVGltZSA9IHRoaXMuZGF0YS5jdXJyZW50UHJvamVjdC51c2VfdGltZVxuICAgICAgbGV0IHVzZVRpbWVOdW0gPSBNYXRoLmNlaWwocHJvamVjdFVzZVRpbWUgLyBldmVyeVRpbWUpXG4gICAgICBsZXQgdGltZUxpc3RMZW5ndGggPSB0aGlzLmRhdGEuYXBwb2ludG1lbnRUaW1lTGlzdC5sZW5ndGhcbiAgICAgIGlmIChpbmRleCArIHVzZVRpbWVOdW0gPiB0aW1lTGlzdExlbmd0aCkge1xuICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgIGN1cnJlbnRBcHBvaW50bWVudFRpbWVzOiBbXSxcbiAgICAgICAgICBhcHBvaW50bWVudFRpbWVMaXN0OiB0aW1lTGlzdCxcbiAgICAgICAgfSlcblxuICAgICAgICB0aGlzLl90b2FzdCgn6aKE57qm5pe26Ze05LiN6LazJylcblxuICAgICAgICByZXR1cm5cbiAgICAgIH1cbiAgICAgIGxldCBzdGFydCA9IDBcbiAgICAgIGxldCB1c2VUaW1lID0gW11cbiAgICAgIHdoaWxlIChzdGFydCA8IHVzZVRpbWVOdW0pIHtcbiAgICAgICAgbGV0IGl0ZW0gPSB0aW1lTGlzdFtpbmRleCArIHN0YXJ0KytdXG4gICAgICAgIGlmKCFpdGVtLnZhbGlkKSB7XG4gICAgICAgICAgdGltZUxpc3QuZm9yRWFjaChpdGVtID0+IGl0ZW0uY2hlY2tlZCA9IGZhbHNlKVxuICAgICAgICAgIHVzZVRpbWUgPSBbXVxuICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgICBjdXJyZW50QXBwb2ludG1lbnRUaW1lczogdXNlVGltZSxcbiAgICAgICAgICAgIGFwcG9pbnRtZW50VGltZUxpc3Q6IHRpbWVMaXN0LFxuICAgICAgICAgIH0pXG4gICAgICAgICAgdGhpcy5fdG9hc3QoJ+mihOe6puaXtumXtOS4jei2sycpXG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaXRlbS5jaGVja2VkID0gdHJ1ZVxuICAgICAgICB1c2VUaW1lLnB1c2goaXRlbS50aW1lKVxuICAgICAgfVxuXG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICBjdXJyZW50QXBwb2ludG1lbnRUaW1lczogdXNlVGltZSxcbiAgICAgICAgYXBwb2ludG1lbnRUaW1lTGlzdDogdGltZUxpc3RcbiAgICAgIH0pXG5cbiAgICB9LFxuXG4gICAgZ2V0QmVhdXRpY2lhbkFuZFByb2plY3Q6IGZ1bmN0aW9uIChzaG9wSWQpIHtcbiAgICAgIGxldCBhcHAgPSBnZXRBcHAoKVxuICAgICAgbGV0IHNlbGYgPSB0aGlzXG4gICAgICBhcHAuZ2V0KGBhcHBvaW50bWVudC9nZXRCZWF1dGljaWFuQW5kUHJvamVjdC8ke3Nob3BJZH1gKS50aGVuKGRhdGEgPT4ge1xuICAgICAgICBsZXQgY29udGVudCA9IChkYXRhLmRhdGEgJiYgZGF0YS5kYXRhLmNvbnRlbnQpIHx8IHt9XG5cbiAgICAgICAgY29udGVudC5kYXlzID0gY29udGVudC5kYXlzLm1hcChpdGVtID0+IHtcbiAgICAgICAgICBsZXQgZGF5ID0gaXRlbS5zcGxpdCgnIycpXG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGRhdGU6IGRheVswXSxcbiAgICAgICAgICAgIHdlZWs6IGRheVsxXSxcbiAgICAgICAgICAgIGRheTogZGF5WzJdXG4gICAgICAgICAgfVxuICAgICAgICB9KVxuXG4gICAgICAgIGxldCBjdXJyZW50UHJvamVjdCA9IGNvbnRlbnQucHJvamVjdHNbMF0gfHwge31cbiAgICAgICAgbGV0IGN1cnJlbnRCZWF1dGljaWFuID0gY29udGVudC5iZWF1dGljaWFuc1swXSB8fCB7fVxuICAgICAgICBsZXQgY3VycmVudEFwcG9pbnRtZW50RGF5ID0gY29udGVudC5kYXlzWzBdIHx8IHt9XG5cbiAgICAgICAgc2VsZi5zZXREYXRhKHtcbiAgICAgICAgICBiZWF1dGljaWFuTGlzdDogY29udGVudC5iZWF1dGljaWFucyxcbiAgICAgICAgICBwcm9qZWN0TGlzdDogY29udGVudC5wcm9qZWN0cyxcbiAgICAgICAgICBhcHBvaW50bWVudERheUxpc3Q6IGNvbnRlbnQuZGF5cyxcbiAgICAgICAgICBjdXJyZW50UHJvamVjdCxcbiAgICAgICAgICBjdXJyZW50QmVhdXRpY2lhbixcbiAgICAgICAgICBjdXJyZW50QXBwb2ludG1lbnREYXksXG4gICAgICAgIH0pXG5cbiAgICAgICAgc2VsZi5nZXRBcHBvaW50bWVudFRpbWVzKGN1cnJlbnRCZWF1dGljaWFuLmJlYXV0aWNpYW5faWQsIGN1cnJlbnRBcHBvaW50bWVudERheS5kYXkpXG4gICAgICB9KS5jYXRjaChlID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coZSlcbiAgICAgIH0pXG5cbiAgICB9LFxuXG4gICAgZ2V0QXBwb2ludG1lbnRUaW1lczogZnVuY3Rpb24gKGJlYXV0aWNpYW5JZCwgZGF5KSB7XG4gICAgICBsZXQgYXBwID0gZ2V0QXBwKClcbiAgICAgIGxldCBzZWxmID0gdGhpc1xuICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgY3VycmVudEFwcG9pbnRtZW50VGltZXM6IFtdXG4gICAgICB9KVxuXG4gICAgICBhcHAuZ2V0KCdhcHBvaW50bWVudC9nZXRBcHBvaW50bWVudFRpbWUvJyArIGJlYXV0aWNpYW5JZCArICcvJyArIGRheSlcbiAgICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICBsZXQgY29udGVudCA9IChkYXRhLmRhdGEgJiYgZGF0YS5kYXRhLmNvbnRlbnQpIHx8IFtdXG4gICAgICAgICAgLy8gZm9yICh2YXIgaSBpbiBbMCwgMCwgMCwgMF0pXG4gICAgICAgICAgLy8gICBjb250ZW50LnB1c2goe30pXG5cbiAgICAgICAgICBzZWxmLnNldERhdGEoe1xuICAgICAgICAgICAgYXBwb2ludG1lbnRUaW1lTGlzdDogY29udGVudFxuICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgfSxcblxuXG4gICAgYXBwb2ludG1lbnQ6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgbGV0IGFwcCA9IGdldEFwcCgpXG4gICAgICBsZXQgZm9ybUlkID0gZXZlbnQuZGV0YWlsLmZvcm1JZFxuXG4gICAgICAvLyDpooTnuqZcbiAgICAgIGxldCBkYXRhID0ge1xuICAgICAgICBzaG9wX2lkOiB0aGlzLmRhdGEuY3VycmVudFNob3Auc2hvcF9pZCxcbiAgICAgICAgYmVhdXRpY2lhbl9pZDogdGhpcy5kYXRhLmN1cnJlbnRCZWF1dGljaWFuLmJlYXV0aWNpYW5faWQsXG4gICAgICAgIHByb2plY3RfaWQ6IHRoaXMuZGF0YS5jdXJyZW50UHJvamVjdC5wcm9qZWN0X2lkLFxuICAgICAgICBhcHBvaW50bWVudF9kYXk6IHRoaXMuZGF0YS5jdXJyZW50QXBwb2ludG1lbnREYXkuZGF5LFxuICAgICAgICBhcHBvaW50bWVudF90aW1lOiB0aGlzLmRhdGEuY3VycmVudEFwcG9pbnRtZW50VGltZXMuam9pbignLCcpLFxuICAgICAgICBmcm9tOiAneGN4JyxcbiAgICAgICAgZm9ybUlkOiBmb3JtSWQsXG4gICAgICB9XG4gICAgICBhcHAucG9zdCgnY2FydC9hcHBvaW50bWVudCcsIGRhdGEpXG4gICAgICAgIC50aGVuKCgpID0+ICAge1xuICAgICAgICAgIHRoaXMuX3RvYXN0KCfpooTnuqbmiJDlip8hJylcbiAgICAgICAgICBzZXRUaW1lb3V0KHggPT4gdGhpcy5nZXRBcHBvaW50bWVudFRpbWVzKGRhdGEuYmVhdXRpY2lhbl9pZCwgZGF0YS5hcHBvaW50bWVudF9kYXkpLCAxMDAwKVxuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgIHRoaXMuX3RvYXN0KGVycm9yLmRldGFpbCB8fCAn6aKE57qm5aSx6LSlIScpXG4gICAgICAgIH0pXG4gICAgfSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgbGV0IGFwcCA9IGdldEFwcCgpXG4gICAgICBsZXQgc2VsZiA9IHRoaXNcblxuICAgICAgd3guZ2V0TG9jYXRpb24oe1xuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgIGFwcC5nZXQoJ3Nob3AvZ2V0TGlzdCcsIHtsYXRpdHVkZTogZGF0YS5sYXRpdHVkZSwgbG9uZ2l0dWRlOiBkYXRhLmxvbmdpdHVkZX0pLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gZGF0YS5kYXRhXG4gICAgICAgICAgICBsZXQgY3VycmVudFNob3AgPSByZXN1bHQuY29udGVudFswXSB8fCB7fVxuICAgICAgICAgICAgc2VsZi5zZXREYXRhKHtcbiAgICAgICAgICAgICAgc2hvcExpc3Q6IHJlc3VsdC5jb250ZW50LFxuICAgICAgICAgICAgICBjcFNob3BMaXN0OiByZXN1bHQuY29udGVudCxcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIC8vIOWIpOaWrXNob3BfaWTmmK/lkKblrZjlnKhcbiAgICAgICAgICAgIGlmKHNlbGYuZGF0YS5jdXJyZW50U2hvcC5zaG9wX2lkKSB7XG4gICAgICAgICAgICAgIGN1cnJlbnRTaG9wID0gdGhpcy5kYXRhLmN1cnJlbnRTaG9wXG4gICAgICAgICAgICAgIHNlbGYuc2V0RGF0YSh7XG4gICAgICAgICAgICAgICAgY3VycmVudFNob3BcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHNlbGYuc2V0RGF0YSh7XG4gICAgICAgICAgICAgICAgY3VycmVudFNob3BcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKGN1cnJlbnRTaG9wKVxuICAgICAgICAgICAgICBzZWxmLmdldEJlYXV0aWNpYW5BbmRQcm9qZWN0KGN1cnJlbnRTaG9wLnNob3BfaWQpXG4gICAgICAgICAgfSkuY2F0Y2goZSA9PiBjb25zb2xlLmxvZyhlKSlcbiAgICAgICAgfSxcbiAgICAgICAgZmFpbDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHd4Lm9wZW5TZXR0aW5nKHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmYWlsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9LFxuXG4gIG9uTG9hZDogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuaW5pdCgpXG4gIH0sXG5cbiAgb25UYWJJdGVtVGFwOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmluaXQoKVxuICB9XG4gIH0iXX0=