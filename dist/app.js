'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
wx.message = function (message) {
  wx.showToast({
    title: message || '发生错误了',
    icon: 'none',
    duration: 1500
  });
};

wx.onNetworkStatusChange(function (res) {
  var status = res.isConnected;
  if (!status) {
    wx.message('网络连接失败，请检查网络...');
  }
});

wx.callTel = function (telephone) {
  wx.makePhoneCall({
    phoneNumber: telephone
  });
};

wx.copyText = function (data) {
  wx.setClipboardData({
    data: data,
    success: function success(res) {
      wx.getClipboardData({
        success: function success(res) {
          wx.message('复制成功');
        }
      });
    }
  });
};

exports.default = App({

  // 错误
  onError: function onError() {
    var msg = JSON.stringify(arguments);
    var logger = wx.getRealtimeLogManager();
    logger.error(msg);

    console.log(logger);
  },


  globalData: {
    baseUrl: "https://api.mdshijie.com/",
    // baseUrl: "http://127.0.0.1/",
    userInfo: {},
    session_id: '',
    noPhone: true,
    version: '2.3'
  },

  showToast: function showToast(text) {
    wx.showToast({
      title: text,
      duration: 2000,
      icon: 'none'
    });
  },
  setSessionId: function setSessionId(sid) {
    try {
      this.globalData.session_id = sid;
      return wx.setStorageSync("session_id", sid);
    } catch (e) {
      return;
    }
  },
  getSessionId: function getSessionId() {
    return wx.getStorageSync("session_id") ? wx.getStorageSync("session_id") : this.globalData.session_id;
  },
  setUserInfo: function setUserInfo(user) {
    try {
      this.globalData.userInfo = user;
      return wx.setStorageSync("user_info", user);
    } catch (e) {}
  },
  getUserInfo: function getUserInfo() {
    var user = wx.getStorageSync("user_info") ? wx.getStorageSync("user_info") : this.globalData.userInfo;
    this.globalData.userInfo = user;

    return user;
  },
  toLogin: function toLogin() {
    wx.navigateTo({
      url: '/pages/bind/index'
    });
  },
  goLogin: function goLogin() {
    var self = this;
    if (self.goLogin.show) return;

    var authorize = self.getSessionId();
    console.log('authorize', authorize);
    var noPhone = this.globalData.userInfo.noPhone;
    if (authorize && !noPhone) return true;

    if (!authorize || noPhone) {
      self.goLogin.show = true;
      // loginTool.setGoLogin()
      var message = '您还未登录，是否登录？';

      if (authorize && noPhone) message = '猫的世界需要获取您的手机号';

      wx.showModal({
        content: message,
        success: function success(e) {
          if (e.confirm) {
            self.toLogin();
          } else {
            var pages = getCurrentPages();
            console.log(pages.length);
            if (pages.length >= 2) {
              wx.navigateBack({
                delta: 2,
                complete: function complete(res) {}
              });
            } else {
              wx.switchTab({
                url: '/pages/appointment/index'
              });
            }
          }
        },
        complete: function complete(e) {
          self.goLogin.show = false;
        }
      });
    }
  },


  login: function login() {
    var authData = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';

    var self = this;
    return new Promise(function (res, rej) {
      wx.login({
        success: function success(data) {
          self.post("xcxLogin/authorize", { code: data.code, authData: authData }).then(function (data) {
            self.setSessionId(data.data.session_id);
            res(data.data);
          }).catch(function (e) {
            return rej(e);
          });
        },
        fail: function fail(e) {
          rej(e);
        }
      });
    });
  },
  onLaunch: function onLaunch() {
    // this.login();
  },
  onShow: function onShow() {},
  onHide: function onHide() {},
  askNotice: function askNotice() {
    wx.getSetting({
      withSubscriptions: true,
      success: function success(res) {
        // console.log(res.authSetting)
        // console.log(res.subscriptionsSetting)
        var setting = res.subscriptionsSetting;
        var allowSuccessNotice = 'jGKjvM16MxrmUH24w4XZq7B30cH8wIyqWxFQPf1ypcc';
        var allowCancelNotice = 'Jev9yHgi1xl08Wd80PpDfsifQeT8-e__bssbFF00j9A';
        var tmplIds = [];
        // if (setting.mainSwitch == true) {
        var itemSettings = setting.itemSettings || {};
        console.log(setting);
        console.log(itemSettings);
        if (typeof itemSettings[allowSuccessNotice] === 'undefined' || itemSettings[allowSuccessNotice] !== 'accept') {
          tmplIds.push(allowSuccessNotice);
        }

        if (typeof itemSettings[allowCancelNotice] === 'undefined' || itemSettings[allowCancelNotice] !== 'accept') {
          tmplIds.push(allowCancelNotice);
        }

        console.log(tmplIds);

        if (tmplIds.length) {
          wx.requestSubscribeMessage({
            tmplIds: tmplIds,
            success: function success(res) {
              console.log(res);
            },
            fail: function fail(e) {
              console.log(e);
              setTimeout(function () {
                wx.showToast({
                  title: '请在小程序设置里打开订阅消息总开关',
                  icon: 'none'
                });
              }, 3000);
            }
          });
        }
        // }
      },
      fail: function fail(e) {
        console.log(e);
      }
    });
  },


  request: function request(method, url, data) {
    var showLoading = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;

    var self = this;
    return new Promise(function (res, rej) {
      if (showLoading) wx.showLoading({
        title: "加载中..."
      });

      wx.request({
        method: method,
        header: {
          "x-requested-with": "xmlhttprequest",
          "Content-Type": "application/x-www-form-urlencoded",
          "x-xcx": "xcx",
          token: self.getSessionId()
        },
        url: self.globalData.baseUrl + url,
        data: data,
        success: function success(result) {
          var data = result.data;
          if (data.status == 1) res(result.data);else if (data.status == -999) {
            self.setSessionId('');
            self.setUserInfo({});

            // 跳转到绑定页
            self.goLogin();
          } else {
            rej(data);
          }
        },
        fail: function fail(error) {
          return rej(error);
        },
        complete: function complete() {
          setTimeout(function () {
            return wx.hideLoading();
          }, 500);
        }
      });
    });
  },
  get: function get(url) {
    var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    var showLoading = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;

    return this.request("GET", url, data, showLoading);
  },
  post: function post(url) {
    var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    var showLoading = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;

    return this.request("POST", url, data, showLoading);
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC53eGEiXSwibmFtZXMiOlsid3giLCJtZXNzYWdlIiwic2hvd1RvYXN0IiwidGl0bGUiLCJpY29uIiwiZHVyYXRpb24iLCJvbk5ldHdvcmtTdGF0dXNDaGFuZ2UiLCJyZXMiLCJzdGF0dXMiLCJpc0Nvbm5lY3RlZCIsImNhbGxUZWwiLCJ0ZWxlcGhvbmUiLCJtYWtlUGhvbmVDYWxsIiwicGhvbmVOdW1iZXIiLCJjb3B5VGV4dCIsImRhdGEiLCJzZXRDbGlwYm9hcmREYXRhIiwic3VjY2VzcyIsImdldENsaXBib2FyZERhdGEiLCJvbkVycm9yIiwibXNnIiwiSlNPTiIsInN0cmluZ2lmeSIsImFyZ3VtZW50cyIsImxvZ2dlciIsImdldFJlYWx0aW1lTG9nTWFuYWdlciIsImVycm9yIiwiY29uc29sZSIsImxvZyIsImdsb2JhbERhdGEiLCJiYXNlVXJsIiwidXNlckluZm8iLCJzZXNzaW9uX2lkIiwibm9QaG9uZSIsInZlcnNpb24iLCJ0ZXh0Iiwic2V0U2Vzc2lvbklkIiwic2lkIiwic2V0U3RvcmFnZVN5bmMiLCJlIiwiZ2V0U2Vzc2lvbklkIiwiZ2V0U3RvcmFnZVN5bmMiLCJzZXRVc2VySW5mbyIsInVzZXIiLCJnZXRVc2VySW5mbyIsInRvTG9naW4iLCJuYXZpZ2F0ZVRvIiwidXJsIiwiZ29Mb2dpbiIsInNlbGYiLCJzaG93IiwiYXV0aG9yaXplIiwic2hvd01vZGFsIiwiY29udGVudCIsImNvbmZpcm0iLCJwYWdlcyIsImdldEN1cnJlbnRQYWdlcyIsImxlbmd0aCIsIm5hdmlnYXRlQmFjayIsImRlbHRhIiwiY29tcGxldGUiLCJzd2l0Y2hUYWIiLCJsb2dpbiIsImF1dGhEYXRhIiwiUHJvbWlzZSIsInJlaiIsInBvc3QiLCJjb2RlIiwidGhlbiIsImNhdGNoIiwiZmFpbCIsIm9uTGF1bmNoIiwib25TaG93Iiwib25IaWRlIiwiYXNrTm90aWNlIiwiZ2V0U2V0dGluZyIsIndpdGhTdWJzY3JpcHRpb25zIiwic2V0dGluZyIsInN1YnNjcmlwdGlvbnNTZXR0aW5nIiwiYWxsb3dTdWNjZXNzTm90aWNlIiwiYWxsb3dDYW5jZWxOb3RpY2UiLCJ0bXBsSWRzIiwiaXRlbVNldHRpbmdzIiwicHVzaCIsInJlcXVlc3RTdWJzY3JpYmVNZXNzYWdlIiwic2V0VGltZW91dCIsInJlcXVlc3QiLCJtZXRob2QiLCJzaG93TG9hZGluZyIsImhlYWRlciIsInRva2VuIiwicmVzdWx0IiwiaGlkZUxvYWRpbmciLCJnZXQiXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUFBLEdBQUdDLE9BQUgsR0FBYSxVQUFVQSxPQUFWLEVBQW1CO0FBQzVCRCxLQUFHRSxTQUFILENBQWE7QUFDWEMsV0FBT0YsV0FBVyxPQURQO0FBRVhHLFVBQU0sTUFGSztBQUdYQyxjQUFVO0FBSEMsR0FBYjtBQUtELENBTkg7O0FBUUVMLEdBQUdNLHFCQUFILENBQXlCLFVBQVVDLEdBQVYsRUFBZTtBQUN0QyxNQUFNQyxTQUFTRCxJQUFJRSxXQUFuQjtBQUNBLE1BQUksQ0FBQ0QsTUFBTCxFQUFhO0FBQ1hSLE9BQUdDLE9BQUgsQ0FBVyxpQkFBWDtBQUNEO0FBQ0YsQ0FMRDs7QUFPQUQsR0FBR1UsT0FBSCxHQUFhLFVBQVVDLFNBQVYsRUFBcUI7QUFDaENYLEtBQUdZLGFBQUgsQ0FBaUI7QUFDZkMsaUJBQWFGO0FBREUsR0FBakI7QUFHRCxDQUpEOztBQU1BWCxHQUFHYyxRQUFILEdBQWMsVUFBVUMsSUFBVixFQUFnQjtBQUM1QmYsS0FBR2dCLGdCQUFILENBQW9CO0FBQ2xCRCxVQUFNQSxJQURZO0FBRWxCRSxhQUFTLGlCQUFVVixHQUFWLEVBQWU7QUFDdEJQLFNBQUdrQixnQkFBSCxDQUFvQjtBQUNsQkQsaUJBQVMsaUJBQVVWLEdBQVYsRUFBZTtBQUN0QlAsYUFBR0MsT0FBSCxDQUFXLE1BQVg7QUFDRDtBQUhpQixPQUFwQjtBQUtEO0FBUmlCLEdBQXBCO0FBVUQsQ0FYRDs7OztBQTJFQTtBQUNBa0IsUyxxQkFBVTtBQUNSLFFBQU9DLE1BQU1DLEtBQUtDLFNBQUwsQ0FBZUMsU0FBZixDQUFiO0FB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OUMsR0FBVCxFQUE2QztBQUFBLFFBQS9CaEMsSUFBK0IsdUVBQXhCLEVBQXdCO0FBQUEsUUFBcEJ5RSxXQUFvQix1RUFBTixJQUFNOztBQUNoRCxXQUFPLEtBQUtGLE9BQUwsQ0FBYSxLQUFiLEVBQW9CdkMsR0FBcEIsRUFBeUJoQyxJQUF6QixFQUErQnlFLFdBQS9CLENBQVA7QUFDRCxHO0FBQ0R0QixRQUFNLGNBQVNuQixHQUFULEVBQTZDO0FBQUEsUUFBL0JoQyxJQUErQix1RUFBeEIsRUFBd0I7QUFBQSxRQUFwQnlFLFdBQW9CLHVFQUFOLElBQU07O0FBQ2pELFdBQU8sS0FBS0YsT0FBTCxDQUFhLE1BQWIsRUFBcUJ2QyxHQUFyQixFQUEwQmhDLElBQTFCLEVBQWdDeUUsV0FBaEMsQ0FBUDtBQUNEIiwiZmlsZSI6ImFwcC53eGEiLCJzb3VyY2VzQ29udGVudCI6WyJ3eC5tZXNzYWdlID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgdGl0bGU6IG1lc3NhZ2UgfHwgJ+WPkeeUn+mUmeivr+S6hicsXG4gICAgICBpY29uOiAnbm9uZScsXG4gICAgICBkdXJhdGlvbjogMTUwMFxuICAgIH0pXG4gIH1cblxuICB3eC5vbk5ldHdvcmtTdGF0dXNDaGFuZ2UoZnVuY3Rpb24gKHJlcykge1xuICAgIGNvbnN0IHN0YXR1cyA9IHJlcy5pc0Nvbm5lY3RlZFxuICAgIGlmICghc3RhdHVzKSB7XG4gICAgICB3eC5tZXNzYWdlKCfnvZHnu5zov57mjqXlpLHotKXvvIzor7fmo4Dmn6XnvZHnu5wuLi4nKVxuICAgIH1cbiAgfSlcblxuICB3eC5jYWxsVGVsID0gZnVuY3Rpb24gKHRlbGVwaG9uZSkge1xuICAgIHd4Lm1ha2VQaG9uZUNhbGwoe1xuICAgICAgcGhvbmVOdW1iZXI6IHRlbGVwaG9uZSxcbiAgICB9KVxuICB9XG5cbiAgd3guY29weVRleHQgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgIHd4LnNldENsaXBib2FyZERhdGEoe1xuICAgICAgZGF0YTogZGF0YSxcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgd3guZ2V0Q2xpcGJvYXJkRGF0YSh7XG4gICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgd3gubWVzc2FnZSgn5aSN5Yi25oiQ5YqfJylcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgY29uZmlnOiB7XG4gICAgcGVybWlzc2lvbjoge1xuICAgICAgLy8gXCJzY29wZS51c2VySW5mb1wiOiB7XG4gICAgICAvLyAgIGRlc2M6IFwi6I635Y+W5oKo55qE5Z+65pys5L+h5oGvXCJcbiAgICAgIC8vIH0sXG4gICAgICBcInNjb3BlLnVzZXJMb2NhdGlvblwiOiB7XG4gICAgICAgIGRlc2M6IFwi5L2g55qE5L2N572u5L+h5oGv5bCG55So5LqO6K6h566X5LiO6Zeo5bqX55qE6Led56a7XCJcbiAgICAgIH1cbiAgICB9LFxuICAgIHVzaW5nQ29tcG9uZW50czoge1xuICAgICAgXCJsYXlvdXQtaGVhZFwiOiBcImxheW91dC9oZWFkXCJcbiAgICAgIC8vICdsYXlvdXQtZm9vdCc6ICdsYXlvdXQvZm9vdCdcbiAgICB9LFxuICAgIHBhZ2VzOiBbXSxcbiAgICB3aW5kb3c6IHtcbiAgICAgIGJhY2tncm91bmRUZXh0U3R5bGU6IFwibGlnaHRcIixcbiAgICAgIGJhY2tncm91bmRDb2xvcjogXCIjZmZmZmZmXCIsXG4gICAgICBuYXZpZ2F0aW9uQmFyQmFja2dyb3VuZENvbG9yOiBcIiNmZmZmZmZcIixcbiAgICAgIG5hdmlnYXRpb25CYXJUaXRsZVRleHQ6IFwi54yr55qE5LiW55WMXCIsXG4gICAgICBuYXZpZ2F0aW9uQmFyVGV4dFN0eWxlOiBcIndoaXRlXCJcbiAgICB9LFxuICAgIHRhYkJhcjoge1xuICAgICAgXCJjdXN0b21cIjogZmFsc2UsXG4gICAgICBjb2xvcjogXCIjOGE4YThhXCIsXG4gICAgICBzZWxlY3RlZENvbG9yOiBcIiNFMDNCNThcIixcbiAgICAgIGJvcmRlclN0eWxlOiBcImJsYWNrXCIsXG4gICAgICBiYWNrZ3JvdW5kQ29sb3I6IFwiI2ZmZmZmZlwiLFxuICAgICAgbGlzdDogW1xuICAgICAgICAgIHtcbiAgICAgICAgICBwYWdlUGF0aDogXCJwYWdlcy9hcnRpY2xlL2luZGV4XCIsXG4gICAgICAgICAgaWNvblBhdGg6IFwiY29tbW9uL2Fzc2V0cy90YWIvMDEucG5nXCIsXG4gICAgICAgICAgc2VsZWN0ZWRJY29uUGF0aDogXCJjb21tb24vYXNzZXRzL3RhYi8wMTEucG5nXCIsXG4gICAgICAgICAgdGV4dDogXCLllYblk4HorqLpmIVcIlxuICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICBwYWdlUGF0aDogXCJwYWdlcy9hcHBvaW50bWVudC9pbmRleFwiLFxuICAgICAgICAgIGljb25QYXRoOiBcImNvbW1vbi9hc3NldHMvdGFiLzAyLnBuZ1wiLFxuICAgICAgICAgIHNlbGVjdGVkSWNvblBhdGg6IFwiY29tbW9uL2Fzc2V0cy90YWIvMDIxLnBuZ1wiLFxuICAgICAgICAgIHRleHQ6IFwi6aKE57qmXCJcbiAgICAgICAgfSxcbiAgIFxuICAgICAgICB7XG4gICAgICAgICAgcGFnZVBhdGg6IFwicGFnZXMvcGF5L2luZGV4XCIsXG4gICAgICAgICAgaWNvblBhdGg6IFwiY29tbW9uL2Fzc2V0cy90YWIvMDMucG5nXCIsXG4gICAgICAgICAgc2VsZWN0ZWRJY29uUGF0aDogXCJjb21tb24vYXNzZXRzL3RhYi8wMzEucG5nXCIsXG4gICAgICAgICAgdGV4dDogXCLkubDljZVcIlxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcGFnZVBhdGg6IFwicGFnZXMvY2VudGVyL2luZGV4XCIsXG4gICAgICAgICAgaWNvblBhdGg6IFwiY29tbW9uL2Fzc2V0cy90YWIvMDQucG5nXCIsXG4gICAgICAgICAgc2VsZWN0ZWRJY29uUGF0aDogXCJjb21tb24vYXNzZXRzL3RhYi8wNDEucG5nXCIsXG4gICAgICAgICAgdGV4dDogXCLmiJHnmoRcIlxuICAgICAgICB9XG4gICAgICBdXG4gICAgfSxcbiAgICBuZXR3b3JrVGltZW91dDoge1xuICAgICAgcmVxdWVzdDogMTAwMDBcbiAgICB9XG4gIH0sXG5cbiAgLy8g6ZSZ6K+vXG4gIG9uRXJyb3IoKSB7XG4gICAgY29uc3QgIG1zZyA9IEpTT04uc3RyaW5naWZ5KGFyZ3VtZW50cylcbiAgICBsZXQgbG9nZ2VyID0gd3guZ2V0UmVhbHRpbWVMb2dNYW5hZ2VyKClcbiAgICBsb2dnZXIuZXJyb3IobXNnKVxuXG4gICAgY29uc29sZS5sb2cobG9nZ2VyKVxuICB9LFxuXG5cbiAgZ2xvYmFsRGF0YToge1xuICAgIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcGkubWRzaGlqaWUuY29tL1wiLFxuICAgIC8vIGJhc2VVcmw6IFwiaHR0cDovLzEyNy4wLjAuMS9cIixcbiAgICB1c2VySW5mbzoge30sXG4gICAgc2Vzc2lvbl9pZDogJycsXG4gICAgbm9QaG9uZTogdHJ1ZSxcbiAgICB2ZXJzaW9uOiAnMi4zJyxcbiAgfSxcblxuICBzaG93VG9hc3QodGV4dCkge1xuICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgdGl0bGU6IHRleHQsXG4gICAgICAgIGR1cmF0aW9uOiAyMDAwLFxuICAgICAgICBpY29uOiAnbm9uZSdcbiAgICB9KVxuICB9LFxuXG4gIHNldFNlc3Npb25JZChzaWQpIHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5nbG9iYWxEYXRhLnNlc3Npb25faWQgPSBzaWRcbiAgICAgIHJldHVybiB3eC5zZXRTdG9yYWdlU3luYyhcInNlc3Npb25faWRcIiwgc2lkKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG4gIH0sXG5cbiAgZ2V0U2Vzc2lvbklkKCkge1xuICAgIHJldHVybiB3eC5nZXRTdG9yYWdlU3luYyhcInNlc3Npb25faWRcIikgPyB3eC5nZXRTdG9yYWdlU3luYyhcInNlc3Npb25faWRcIikgOiB0aGlzLmdsb2JhbERhdGEuc2Vzc2lvbl9pZDtcbiAgfSxcblxuICBzZXRVc2VySW5mbyh1c2VyKSB7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMuZ2xvYmFsRGF0YS51c2VySW5mbyA9IHVzZXJcbiAgICAgIHJldHVybiB3eC5zZXRTdG9yYWdlU3luYyhcInVzZXJfaW5mb1wiLCB1c2VyKTtcbiAgICB9IGNhdGNoIChlKSB7fVxuICB9LFxuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIGNvbnN0IHVzZXIgPSB3eC5nZXRTdG9yYWdlU3luYyhcInVzZXJfaW5mb1wiKSA/IHd4LmdldFN0b3JhZ2VTeW5jKFwidXNlcl9pbmZvXCIpIDogdGhpcy5nbG9iYWxEYXRhLnVzZXJJbmZvO1xuICAgIHRoaXMuZ2xvYmFsRGF0YS51c2VySW5mbyA9IHVzZXJcblxuICAgIHJldHVybiB1c2VyXG4gIH0sXG5cbiAgdG9Mb2dpbigpIHtcbiAgICB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgIHVybDogJy9wYWdlcy9iaW5kL2luZGV4JyxcbiAgICB9KVxuXG4gIH0sXG5cbiAgZ29Mb2dpbigpIHtcbiAgICBjb25zdCBzZWxmID0gdGhpc1xuICAgIGlmIChzZWxmLmdvTG9naW4uc2hvdylcbiAgICAgIHJldHVyblxuXG4gICAgY29uc3QgYXV0aG9yaXplID0gc2VsZi5nZXRTZXNzaW9uSWQoKVxuICAgIGNvbnNvbGUubG9nKCdhdXRob3JpemUnLCBhdXRob3JpemUpXG4gICAgY29uc3Qgbm9QaG9uZSA9IHRoaXMuZ2xvYmFsRGF0YS51c2VySW5mby5ub1Bob25lXG4gICAgaWYgKGF1dGhvcml6ZSAmJiAhbm9QaG9uZSlcbiAgICAgIHJldHVybiB0cnVlXG5cbiAgICBpZiAoIWF1dGhvcml6ZSB8fCBub1Bob25lKSB7XG4gICAgICBzZWxmLmdvTG9naW4uc2hvdyA9IHRydWVcbiAgICAgIC8vIGxvZ2luVG9vbC5zZXRHb0xvZ2luKClcbiAgICAgIGxldCBtZXNzYWdlID0gJ+aCqOi/mOacqueZu+W9le+8jOaYr+WQpueZu+W9le+8nydcblxuICAgICAgaWYgKGF1dGhvcml6ZSAmJiBub1Bob25lKVxuICAgICAgICBtZXNzYWdlID0gJ+eMq+eahOS4lueVjOmcgOimgeiOt+WPluaCqOeahOaJi+acuuWPtydcblxuICAgICAgd3guc2hvd01vZGFsKHtcbiAgICAgICAgY29udGVudDogbWVzc2FnZSxcbiAgICAgICAgc3VjY2VzcyhlKSB7XG4gICAgICAgICAgaWYgKGUuY29uZmlybSkge1xuICAgICAgICAgICAgc2VsZi50b0xvZ2luKClcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgcGFnZXMgPSBnZXRDdXJyZW50UGFnZXMoKVxuICAgICAgICAgICAgY29uc29sZS5sb2cocGFnZXMubGVuZ3RoKVxuICAgICAgICAgICAgaWYgKHBhZ2VzLmxlbmd0aCA+PSAyKSB7XG4gICAgICAgICAgICAgIHd4Lm5hdmlnYXRlQmFjayh7XG4gICAgICAgICAgICAgICAgZGVsdGE6IDIsXG4gICAgICAgICAgICAgICAgY29tcGxldGU6IChyZXMpID0+IHt9LFxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgd3guc3dpdGNoVGFiKHtcbiAgICAgICAgICAgICAgICB1cmw6ICcvcGFnZXMvYXBwb2ludG1lbnQvaW5kZXgnLFxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgY29tcGxldGUoZSkge1xuICAgICAgICAgIHNlbGYuZ29Mb2dpbi5zaG93ID0gZmFsc2VcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG4gIH0sXG5cbiAgbG9naW46IGZ1bmN0aW9uKGF1dGhEYXRhID0gJycpIHtcbiAgICBsZXQgc2VsZiA9IHRoaXM7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXMsIHJlaikgPT4ge1xuICAgICAgd3gubG9naW4oe1xuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgc2VsZi5wb3N0KFwieGN4TG9naW4vYXV0aG9yaXplXCIsIHsgY29kZTogZGF0YS5jb2RlLCBhdXRoRGF0YTogYXV0aERhdGEgfSkudGhlbihkYXRhID0+IHtcbiAgICAgICAgICAgIHNlbGYuc2V0U2Vzc2lvbklkKGRhdGEuZGF0YS5zZXNzaW9uX2lkKVxuICAgICAgICAgICAgcmVzKGRhdGEuZGF0YSlcbiAgICAgICAgICB9KS5jYXRjaChlID0+IHJlaihlKSlcbiAgICAgICAgfSxcbiAgICAgICAgZmFpbDogZnVuY3Rpb24oZSkge1xuICAgICAgICAgIHJlaihlKVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KVxuICAgXG4gIH0sXG4gIG9uTGF1bmNoKCkge1xuICAgIC8vIHRoaXMubG9naW4oKTtcbiAgfSxcbiAgb25TaG93KCkge30sXG4gIG9uSGlkZSgpIHt9LFxuXG4gIGFza05vdGljZSgpIHtcbiAgICB3eC5nZXRTZXR0aW5nKHtcbiAgICAgIHdpdGhTdWJzY3JpcHRpb25zOiB0cnVlLFxuICAgICAgc3VjY2VzcyAocmVzKSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHJlcy5hdXRoU2V0dGluZylcbiAgICAgICAgLy8gY29uc29sZS5sb2cocmVzLnN1YnNjcmlwdGlvbnNTZXR0aW5nKVxuICAgICAgICBjb25zdCBzZXR0aW5nID0gcmVzLnN1YnNjcmlwdGlvbnNTZXR0aW5nXG4gICAgICAgIGNvbnN0IGFsbG93U3VjY2Vzc05vdGljZSA9ICdqR0tqdk0xNk14cm1VSDI0dzRYWnE3QjMwY0g4d0l5cVd4RlFQZjF5cGNjJ1xuICAgICAgICBjb25zdCBhbGxvd0NhbmNlbE5vdGljZSA9ICdKZXY5eUhnaTF4bDA4V2Q4MFBwRGZzaWZRZVQ4LWVfX2Jzc2JGRjAwajlBJ1xuICAgICAgICBsZXQgdG1wbElkcyA9IFtdXG4gICAgICAgIC8vIGlmIChzZXR0aW5nLm1haW5Td2l0Y2ggPT0gdHJ1ZSkge1xuICAgICAgICBjb25zdCBpdGVtU2V0dGluZ3MgPSBzZXR0aW5nLml0ZW1TZXR0aW5ncyB8fCB7fVxuICAgICAgICBjb25zb2xlLmxvZyhzZXR0aW5nKVxuICAgICAgICBjb25zb2xlLmxvZyhpdGVtU2V0dGluZ3MpXG4gICAgICAgIGlmICh0eXBlb2YgaXRlbVNldHRpbmdzW2FsbG93U3VjY2Vzc05vdGljZV0gPT09ICd1bmRlZmluZWQnIHx8IGl0ZW1TZXR0aW5nc1thbGxvd1N1Y2Nlc3NOb3RpY2VdICE9PSAnYWNjZXB0Jyl7XG4gICAgICAgICAgdG1wbElkcy5wdXNoKGFsbG93U3VjY2Vzc05vdGljZSlcbiAgICAgICAgfVxuXG5cbiAgICAgICAgaWYgKHR5cGVvZiBpdGVtU2V0dGluZ3NbYWxsb3dDYW5jZWxOb3RpY2VdID09PSAndW5kZWZpbmVkJyB8fCBpdGVtU2V0dGluZ3NbYWxsb3dDYW5jZWxOb3RpY2VdICE9PSAnYWNjZXB0Jyl7XG4gICAgICAgICAgdG1wbElkcy5wdXNoKGFsbG93Q2FuY2VsTm90aWNlKVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc29sZS5sb2codG1wbElkcylcblxuICAgICAgICBpZiAodG1wbElkcy5sZW5ndGgpIHtcbiAgICAgICAgICB3eC5yZXF1ZXN0U3Vic2NyaWJlTWVzc2FnZSh7XG4gICAgICAgICAgICB0bXBsSWRzLFxuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcylcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmYWlsKGUpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coZSlcbiAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICAgICAgICAgIHRpdGxlOiAn6K+35Zyo5bCP56iL5bqP6K6+572u6YeM5omT5byA6K6i6ZiF5raI5oGv5oC75byA5YWzJywgXG4gICAgICAgICAgICAgICAgICBpY29uOiAnbm9uZSdcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICB9LCAzMDAwKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgICAgLy8gfVxuICAgICAgfSxcbiAgICAgIGZhaWwoZSkge1xuICAgICAgICBjb25zb2xlLmxvZyhlKVxuICAgICAgfVxuICAgIH0pXG4gIH0sXG5cbiAgcmVxdWVzdDogZnVuY3Rpb24obWV0aG9kLCB1cmwsIGRhdGEsIHNob3dMb2FkaW5nID0gdHJ1ZSkge1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXMsIHJlaikgPT4ge1xuICAgICAgaWYgKHNob3dMb2FkaW5nKVxuICAgICAgICB3eC5zaG93TG9hZGluZyh7XG4gICAgICAgICAgdGl0bGU6IFwi5Yqg6L295LitLi4uXCJcbiAgICAgICAgfSk7XG4gICAgICBcbiAgICAgIHd4LnJlcXVlc3Qoe1xuICAgICAgICBtZXRob2Q6IG1ldGhvZCxcbiAgICAgICAgaGVhZGVyOiB7XG4gICAgICAgICAgXCJ4LXJlcXVlc3RlZC13aXRoXCI6IFwieG1saHR0cHJlcXVlc3RcIixcbiAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiLFxuICAgICAgICAgIFwieC14Y3hcIjogXCJ4Y3hcIixcbiAgICAgICAgICB0b2tlbjogc2VsZi5nZXRTZXNzaW9uSWQoKVxuICAgICAgICB9LFxuICAgICAgICB1cmw6IHNlbGYuZ2xvYmFsRGF0YS5iYXNlVXJsICsgdXJsLFxuICAgICAgICBkYXRhLFxuICAgICAgICBzdWNjZXNzOiByZXN1bHQgPT4ge1xuICAgICAgICAgIGxldCBkYXRhID0gcmVzdWx0LmRhdGE7XG4gICAgICAgICAgaWYgKGRhdGEuc3RhdHVzID09IDEpIHJlcyhyZXN1bHQuZGF0YSk7XG4gICAgICAgICAgZWxzZSBpZiAoZGF0YS5zdGF0dXMgPT0gLTk5OSkge1xuICAgICAgICAgICAgc2VsZi5zZXRTZXNzaW9uSWQoJycpXG4gICAgICAgICAgICBzZWxmLnNldFVzZXJJbmZvKHt9KVxuXG4gICAgICAgICAgICAvLyDot7PovazliLDnu5HlrprpobVcbiAgICAgICAgICAgIHNlbGYuZ29Mb2dpbigpXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlaihkYXRhKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGZhaWw6IGVycm9yID0+IHJlaihlcnJvciksXG4gICAgICAgIGNvbXBsZXRlOiAoKSA9PiB7XG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB3eC5oaWRlTG9hZGluZygpLCA1MDApO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSxcbiAgZ2V0OiBmdW5jdGlvbih1cmwsIGRhdGEgPSB7fSwgc2hvd0xvYWRpbmcgPSB0cnVlKSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdChcIkdFVFwiLCB1cmwsIGRhdGEsIHNob3dMb2FkaW5nKTtcbiAgfSxcbiAgcG9zdDogZnVuY3Rpb24odXJsLCBkYXRhID0ge30sIHNob3dMb2FkaW5nID0gdHJ1ZSkge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3QoXCJQT1NUXCIsIHVybCwgZGF0YSwgc2hvd0xvYWRpbmcpO1xuICB9XG59OyJdfQ==